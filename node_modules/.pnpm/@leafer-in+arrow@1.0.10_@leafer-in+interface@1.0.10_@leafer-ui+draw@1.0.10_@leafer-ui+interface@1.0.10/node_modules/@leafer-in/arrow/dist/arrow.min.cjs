"use strict";var e=require("@leafer-ui/draw");function t(e,t,r,o){var n,a=arguments.length,s=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var c=e.length-1;c>=0;c--)(n=e[c])&&(s=(a<3?n(s):a>3?n(t,r,s):n(t,r))||s);return a>3&&s&&Object.defineProperty(t,r,s),s}"function"==typeof SuppressedError&&SuppressedError;class r extends e.LineData{}exports.Arrow=class extends e.Line{get __tag(){return"Arrow"}constructor(e){super(e),this.__.__useArrow=!0}},t([e.dataProcessor(r)],exports.Arrow.prototype,"__",void 0),t([e.strokeType("angle")],exports.Arrow.prototype,"endArrow",void 0),exports.Arrow=t([e.registerUI()],exports.Arrow);const{M:o,L:n,C:a,Q:s,O:c}=e.PathCommandMap,{rotate:p,copyFrom:i,scale:l}=e.PointHelper,f={},u={layout(e,t,r,p,i,l,f){let u,d,x=0,b=e.length;for(;x<b;)switch(u=e[x],u){case o:case n:h(e,x+1,t,r,p,i,l,f),x+=3;break;case a:for(d=1;d<6;d+=2)h(e,x+d,t,r,p,i,l,f);x+=7;break;case s:for(d=1;d<4;d+=2)h(e,x+d,t,r,p,i,l,f);x+=5;break;case c:e[x+1]+=t,e[x+2]+=r,p&&(e[x+3]*=p),l&&(e[x+4]+=l,e[x+5]+=l),x+=7}},rotate(e,t,r){u.layout(e,0,0,1,1,t,r)}};function h(e,t,r,o,n,a,s,c){i(f,e[t],e[t+1]),s&&p(f,s,c),n&&l(f,n,a),e[t]=r+f.x,e[t+1]=o+f.y}const{layout:d,rotate:x}=u,{getAngle:b}=e.PointHelper,w={x:-.5},_={connect:w,offset:{x:-.71,bevelJoin:.36,roundJoin:.22},path:[1,-3,-3,2,0,0,2,-3,3]},y={connect:w,offset:{x:-1.207,bevelJoin:.854,roundJoin:.707},path:[1,-3,-3,2,0,0,2,-1,0]},k={connect:w,offset:{x:-.9,bevelJoin:.624,roundJoin:.4},path:[1,-3,0,2,-3,-2,2,0,0,2,-3,2,2,-3,0,1,-2.05,1.1,2,-2.05,-1.1]},A={connect:w,offset:{x:-1.1,bevelJoin:.872,roundJoin:.6},path:[1,-3,0,2,-3.5,-1.8,2,0,0,2,-3.5,1.8,2,-3,0,1,-2.25,.95,2,-2.25,-.95]},g={offset:w,path:[...k.path]};x(g.path,180,{x:-1.5,y:0});const J={connect:{x:-1.3},path:[1,1.8,-.1,2,1.8,0,26,0,0,1.8,0,359,0]},P={connect:{x:.5},path:[...J.path,1,0,0,26,0,0,1,0,360,0]},v={connect:{x:-1.3},path:[1,-1.4,0,2,-1.4,-1.4,2,1.4,-1.4,2,1.4,1.4,2,-1.4,1.4,2,-1.4,0]},m={path:[...v.path,2,-1.4,-.49,2,1,-.49,1,-1.4,.49,2,1,.49]},D=e.DataHelper.clone(v),H=e.DataHelper.clone(m);x(D.path,45),x(H.path,45);const M={angle:_,"angle-side":y,arrow:A,triangle:k,"triangle-flip":g,circle:P,"circle-line":J,square:m,"square-line":v,diamond:H,"diamond-line":D,mark:{offset:w,path:[1,0,-2,2,0,2]}};function O(e,t,r,o,n,a){const{strokeCap:s,strokeJoin:c}=e.__,{offset:p,connect:i,path:l}="object"==typeof t?t:M[t];let f=i?i.x:0,u=p?p.x:0;const h=[...l];return"none"!==s&&(f-=.5),p&&("round"===c&&p.roundJoin?u+=p.roundJoin:"bevel"===c&&p.bevelJoin&&(u+=p.bevelJoin)),u&&d(h,u,0),d(h,o.x,o.y,n,n,b(r,o)),a.x=(f+u)*n,h}const{M:j,L:C,C:F,Q:L,Z:R,N:q,D:S,X:T,G:U,F:E,O:I,P:Q,U:G}=e.PathCommandMap,{copy:N,copyFrom:W,getDistancePoint:X}=e.PointHelper,Z={},z={},B={},K={},V={},Y={list:M,addArrows(e,t){const{startArrow:r,endArrow:o,strokeWidth:n,__pathForRender:a}=e.__;let s,c=0,p=a.length,i=0,l=r&&"none"!==r;for(;c<p;){switch(s=a[c],s){case j:case C:(i<2||c+6>=p)&&(W(V,a[c+1],a[c+2]),!i&&l&&N(z,V)),c+=3;break;case F:1!==i&&c+7!==p||$(a,K,V,c+3),c+=7;break;case L:1!==i&&c+5!==p||$(a,K,V,c+1),c+=5;break;case R:return;case q:c+=5;break;case S:c+=9;break;case T:c+=6;break;case U:c+=9;break;case E:c+=5;break;case I:c+=7;break;case Q:c+=4;break;case G:1!==i&&c+6!==p||$(a,K,V,c+1),c+=6}if(i++,1===i&&s!==j)return;if(2===i&&l&&N(B,s===C?V:K),c===p){const p=e.__.__pathForRender=t?[...a]:a;if(l&&(p.push(...O(e,r,B,z,n,Z)),Z.x&&(X(z,B,-Z.x,!0),p[1]=B.x,p[2]=B.y)),o&&"none"!==o&&(p.push(...O(e,o,K,V,n,Z)),Z.x)){let e;switch(X(V,K,-Z.x,!0),s){case C:e=c-3+1;break;case F:e=c-7+5;break;case L:e=c-5+3;break;case G:e=c-6+3}e&&ee(p,K,e)}}else N(K,V)}}};function $(e,t,r,o){W(t,e[o],e[o+1]),W(r,e[o+2],e[o+3])}function ee(e,t,r){e[r]=t.x,e[r+1]=t.y}function te(t){return e.decorateLeafAttr(t,(t=>e.attr({set(r){if(this.__setAttr(t,r)){const t=this.__;t.__useArrow="none"!==t.startArrow||"none"!==t.endArrow,e.doStrokeType(this)}}})))}const re=e.UI.prototype;te("none")(re,"startArrow"),te("none")(re,"endArrow"),Object.assign(e.PathArrow,Y),exports.ArrowData=r,exports.PathArrowModule=Y,exports.PathMatrixHelper=u,exports.arrowType=te;
