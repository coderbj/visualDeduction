{
  "version": 3,
  "sources": ["../../.pnpm/@leafer-in+text-editor@1.0.10_@leafer-in+editor@1.0.10_@leafer-in+interface@1.0.10_@leafer-ui_zyzeu6ive3vnyol7dgdfy5ry3e/node_modules/@leafer-in/text-editor/dist/text-editor.esm.js"],
  "sourcesContent": ["import { ColorConvert, Text, PointerEvent, Matrix } from '@leafer-ui/core';\nimport { registerInnerEditor, InnerEditor } from '@leafer-in/editor';\n\n/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise, SuppressedError, Symbol */\r\n\r\n\r\nfunction __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\ntypeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\r\n    var e = new Error(message);\r\n    return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\r\n};\n\nconst textCaseMap = {\n    'none': 'none',\n    'title': 'capitalize',\n    'upper': 'uppercase',\n    'lower': 'lowercase',\n    'small-caps': 'small-caps'\n};\nconst verticalAlignMap = {\n    'top': 'flex-start',\n    'middle': 'center',\n    'bottom': 'flex-end'\n};\nfunction updateStyle(textDom, text, textScale) {\n    const { style } = textDom;\n    const { fill, padding, textWrap, textOverflow, textDecoration } = text;\n    style.fontFamily = text.fontFamily;\n    style.fontSize = text.fontSize * textScale + 'px';\n    setFill(style, fill);\n    style.fontStyle = text.italic ? 'italic' : 'normal';\n    style.fontWeight = text.fontWeight;\n    style.textDecoration = textDecoration === 'delete' ? 'line-through' : textDecoration;\n    style.textTransform = textCaseMap[text.textCase];\n    style.textAlign = text.textAlign;\n    style.display = 'flex';\n    style.flexDirection = 'column';\n    style.justifyContent = verticalAlignMap[text.verticalAlign];\n    style.lineHeight = (text.__.__lineHeight || 0) * textScale + 'px';\n    style.letterSpacing = (text.__.__letterSpacing || 0) * textScale + 'px';\n    if (textWrap === 'none') {\n        style.whiteSpace = 'nowrap';\n    }\n    else if (textWrap === 'break') {\n        style.wordBreak = 'break-all';\n    }\n    style.textIndent = (text.paraIndent || 0) * textScale + 'px';\n    style.padding = padding instanceof Array ? padding.map(item => item * textScale + 'px').join(' ') : (padding || 0) * textScale + 'px';\n    style.textOverflow = textOverflow === 'show' ? '' : (textOverflow === 'hide' ? 'clip' : textOverflow);\n}\nfunction setFill(style, fill) {\n    let color = 'black';\n    if (fill instanceof Array)\n        fill = fill[0];\n    if (typeof fill === 'object') {\n        switch (fill.type) {\n            case 'solid':\n                color = ColorConvert.string(fill.color);\n                break;\n            case 'image':\n                break;\n            case 'linear':\n            case 'radial':\n            case 'angular':\n                const stop = fill.stops[0];\n                color = ColorConvert.string(typeof stop === 'string' ? stop : stop.color);\n                break;\n            default:\n                if (fill.r !== undefined)\n                    color = ColorConvert.string(fill);\n        }\n    }\n    else {\n        color = fill;\n    }\n    style.color = color;\n}\n\nlet TextEditor = class TextEditor extends InnerEditor {\n    constructor() {\n        super(...arguments);\n        this.config = {\n            selectAll: true\n        };\n        this.eventIds = [];\n    }\n    get tag() { return 'TextEditor'; }\n    onLoad() {\n        const { editor } = this;\n        const { config } = editor.app;\n        const text = this.editTarget;\n        text.visible = false;\n        this.isHTMLText = !(text instanceof Text);\n        this._keyEvent = config.keyEvent;\n        config.keyEvent = false;\n        const div = this.editDom = document.createElement('div');\n        const { style } = div;\n        div.contentEditable = 'true';\n        style.position = 'fixed';\n        style.transformOrigin = 'left top';\n        style.boxSizing = 'border-box';\n        this.isHTMLText ? div.innerHTML = text.text : div.innerText = text.text;\n        const { view } = editor.app;\n        (this.inBody = view instanceof HTMLCanvasElement) ? document.body.appendChild(div) : view.appendChild(div);\n        this.eventIds = [\n            editor.app.on_(PointerEvent.DOWN, (e) => {\n                let { target } = e.origin, find;\n                while (target) {\n                    if (target === div)\n                        find = true;\n                    target = target.parentElement;\n                }\n                if (!find)\n                    editor.closeInnerEditor();\n            })\n        ];\n        this.onFocus = this.onFocus.bind(this);\n        this.onInput = this.onInput.bind(this);\n        this.onUpdate = this.onUpdate.bind(this);\n        this.onEscape = this.onEscape.bind(this);\n        div.addEventListener(\"focus\", this.onFocus);\n        div.addEventListener(\"input\", this.onInput);\n        window.addEventListener('keydown', this.onEscape);\n        window.addEventListener('scroll', this.onUpdate);\n        const selection = window.getSelection();\n        const range = document.createRange();\n        if (this.config.selectAll) {\n            range.selectNodeContents(div);\n        }\n        else {\n            const node = div.childNodes[0];\n            range.setStartAfter(node);\n            range.setEndAfter(node);\n            range.collapse(true);\n        }\n        selection.removeAllRanges();\n        selection.addRange(range);\n    }\n    onInput() {\n        const { editDom } = this;\n        this.editTarget.text = this.isHTMLText ? editDom.innerHTML : editDom.innerText.replace(/\\n\\n/, '\\n');\n    }\n    onFocus() {\n        this.editDom.style.outline = 'none';\n    }\n    onEscape(e) {\n        if (e.code === 'Escape')\n            this.editor.closeInnerEditor();\n    }\n    onUpdate() {\n        const { editTarget: text } = this;\n        let textScale = 1;\n        if (!this.isHTMLText) {\n            const { scaleX, scaleY } = text.worldTransform;\n            textScale = Math.max(Math.abs(scaleX), Math.abs(scaleY));\n            const fontSize = text.fontSize * textScale;\n            if (fontSize < 12)\n                textScale *= 12 / text.fontSize;\n        }\n        this.textScale = textScale;\n        const { a, b, c, d, e, f } = new Matrix(text.worldTransform).scale(1 / textScale);\n        let { x, y } = this.inBody ? text.app.clientBounds : text.app.tree.clientBounds;\n        if (!this.inBody)\n            x -= window.scrollX, y -= window.scrollY;\n        let { width, height } = text;\n        width *= textScale, height *= textScale;\n        const data = text.__;\n        if (data.__autoWidth && data.autoSizeAlign) {\n            width += 20;\n            switch (data.textAlign) {\n                case 'center':\n                    x -= width / 2;\n                    break;\n                case 'right': x -= width;\n            }\n        }\n        if (data.__autoHeight && data.autoSizeAlign) {\n            height += 20;\n            switch (data.verticalAlign) {\n                case 'middle':\n                    y -= height / 2;\n                    break;\n                case 'bottom': y -= height;\n            }\n        }\n        const { style } = this.editDom;\n        style.transform = `matrix(${a},${b},${c},${d},${e},${f})`;\n        style.left = x + 'px';\n        style.top = y + 'px';\n        style.width = width + 'px';\n        style.height = height + 'px';\n        this.isHTMLText || updateStyle(this.editDom, text, textScale);\n    }\n    onUnload() {\n        const { editTarget: text, editor, editDom: dom } = this;\n        if (text) {\n            this.onInput();\n            text.visible = true;\n            if (editor.app)\n                editor.app.config.keyEvent = this._keyEvent;\n            editor.off_(this.eventIds);\n            dom.removeEventListener(\"focus\", this.onFocus);\n            dom.removeEventListener(\"input\", this.onInput);\n            window.removeEventListener('keydown', this.onEscape);\n            window.removeEventListener('scroll', this.onUpdate);\n            dom.remove();\n            this.editDom = this.eventIds = undefined;\n        }\n    }\n};\nTextEditor = __decorate([\n    registerInnerEditor()\n], TextEditor);\n\nexport { TextEditor };\n"],
  "mappings": "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",
  "names": ["TextEditor"]
}
