import{decorateLeafAttr as e,attr as t,useModule as i,LeafEventer as s,Eventer as r,UnitConvert as o,Platform as n,Transition as a,ColorConvert as l,MathHelper as h,State as u,UI as d,dataType as c}from"@leafer-ui/draw";function m(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n}"function"==typeof SuppressedError&&SuppressedError;const{cos:F,sin:g,pow:f,sqrt:y,abs:p,ceil:b,floor:D,round:E,PI:A}=Math,v=5*A,k=1.70158,w=2.5949095,T=7.5625,B=2.75;function C(e){return t=>f(t,e)}function S(e){return t=>1-f(1-t,e)}function q(e){return t=>t<.5?.5*f(2*t,e):1-.5*f(2-2*t,e)}function x(e){return e<1/B?T*e*e:e<2/B?T*(e-=1.5/B)*e+.75:e<2.5/B?T*(e-=2.25/B)*e+.9375:T*(e-=2.625/B)*e+.984375}function j(e,t,i,s){const r={};return o=>{const n=~~(1e4*o),a=r[n];if(a)return a;let l,h,u,d=o;for(let t=0;t<8&&(l=1-d,u=O(d,e,i)-o,h=3*l*l*e+6*l*d*(i-e)+3*d*d*(1-i),!(p(h)<1e-6));t++)d-=u/h;return r[n]=O(d,t,s)}}function O(e,t,i){const s=1-e;return 3*s*s*e*t+3*s*e*e*i+e*e*e}const R={get(e){const{list:t}=R;return"string"==typeof e?t[e||"ease"]:"object"==typeof e?t[e.name].apply(t,e.value instanceof Array?e.value:[e.value]):t.ease},register(e,t){R.list[e]=t},list:{linear:e=>e,ease:j(.25,.1,.25,1),"ease-in":j(.42,0,1,1),"ease-out":j(0,0,.58,1),"ease-in-out":j(.42,0,.58,1),"sine-in":e=>1-F(e*A*.5),"sine-out":e=>g(e*A*.5),"sine-in-out":e=>.5*(1-F(e*A)),"quad-in":C(2),"quad-out":S(2),"quad-in-out":q(2),"cubic-in":C(3),"cubic-out":S(3),"cubic-in-out":q(3),"quart-in":C(4),"quart-out":S(4),"quart-in-out":q(4),"quint-in":C(5),"quint-out":S(5),"quint-in-out":q(5),"expo-in":e=>e?f(2,10*e-10):0,"expo-out":e=>1===e?1:1-f(2,10*-e),"expo-in-out":e=>0===e||1===e?e:e<.5?.5*f(2,2*e*10-10):.5*(2-f(2,10-2*e*10)),"circ-in":e=>1-y(1-f(e,2)),"circ-out":e=>y(1-f(e-1,2)),"circ-in-out":e=>e<.5?.5*(1-y(1-f(2*e,2))):.5*(y(1-f(2-2*e,2))+1),"back-in":e=>((k+1)*e-k)*e*e,"back-out":e=>(e-=1)*e*((k+1)*e+k)+1,"back-in-out":e=>e<.5?(e*=2)*e*((w+1)*e-w)*.5:.5*((e=2*e-2)*e*((w+1)*e+w)+2),"elastic-in":e=>0===e||1===e?e:-f(2,10*(e-1))*g((e-1.1)*v),"elastic-out":e=>0===e||1===e?e:f(2,-10*e)*g((e-.1)*v)+1,"elastic-in-out":e=>0===e||1===e?e:e<.5?-f(2,10*((e*=2)-1))*g((e-1.1)*v)*.5:f(2,10*(1-(e*=2)))*g((e-1.1)*v)*.5+1,"bounce-in":e=>1-x(1-e),"bounce-out":x,"bounce-in-out":e=>e<.5?.5*(1-x(1-2*e)):.5*(1+x(2*e-1)),"cubic-bezier":j,steps:function(e,t="floor"){return i=>("floor"===t?D(i*e):"ceil"===t?b(i*e):E(i*e))/e}}};function P(e){return(t,i)=>{Object.defineProperty(t,i,{get(){const t=this.config&&this.config[i];return void 0===t?e:t},set(e){this.config||(this.config={}),this.config[i]=e}})}}class _{}_.CREATED="created",_.PLAY="play",_.PAUSE="pause",_.STOP="stop",_.SEEK="seek",_.UPDATE="update",_.COMPLETED="completed";let M=class extends r{get endingStyle(){return"from"===this.realEnding?this.fromStyle:this.toStyle}get started(){return!!this.requestAnimateTime}get completed(){return this.time>=this.duration&&!this.started}get frame(){return this.frames[this.nowIndex]}get frameTotalTime(){return this.frame.totalTime||this.frame.duration||0}get realEnding(){let e;const{ending:t,reverse:i,loop:s}=this;return"from"===t?e=0:"to"===t?e=1:(e=i?0:1,s&&"number"==typeof s&&(e+=s-1)),e%2?"to":"from"}constructor(e,t,i,s){super(),this.init(e,t,i,s)}init(e,t,i,s){switch(this.target=e,(s||this.isTemp)&&(this.isTemp=s),typeof i){case"number":this.config={duration:i};break;case"string":this.config={easing:i};break;case"object":this.config=i,i.event&&(this.event=i.event)}if(!t)return;this.keyframes=t instanceof Array?t:[t];const{easing:r,attrs:o}=this;this.easingFn=R.get(r),(o||this.attrsMap)&&(this.attrsMap=o?o.reduce(((e,t)=>(e[t]=!0,e)),{}):void 0),this.frames=[],this.create(),this.autoplay&&(this.timer=setTimeout((()=>{this.timer=0,this.play()}),0))}play(){this.destroyed||(this.running=!0,this.started?this.timer||this.requestAnimate():(this.clearTimer(),this.start()),this.emit(_.PLAY,this))}pause(){this.destroyed||(this.running=!1,this.clearTimer(),this.emit(_.PAUSE,this))}stop(){this.destroyed||(this.end(),this.complete(),this.emit(_.STOP,this))}seek(e){this.destroyed||("object"==typeof e&&(e=o.number(e,this.duration)),e/=this.speed,(!this.started||e<this.time)&&this.start(!0),this.time=e,this.animate(0,!0),this.clearTimer((()=>this.requestAnimate())),this.emit(_.SEEK,this))}kill(){this.destroy(!0)}create(){const{target:e,frames:t,keyframes:i,config:s}=this,{length:r}=i,o=!(r>1)||this.join;let n,a,l,h,u=0,d=0;r>1&&(this.fromStyle={},this.toStyle={});for(let s=0;s<r;s++){if(a=i[s],h=a.style||a,n||(n=o?e:h),l={style:h,beforeStyle:{}},a.style){const{duration:e,autoDuration:t,delay:i,autoDelay:s,easing:r}=a;e?(l.duration=e,u+=e,i&&(l.totalTime=e+i)):t&&(l.autoDuration=t,d+=t),i?(l.delay=i,u+=i):s&&(l.autoDelay=s,d+=s),r&&(l.easingFn=R.get(r))}if(l.autoDuration||void 0!==l.duration||(r>1?s>0||o?d++:l.duration=0:l.duration=this.duration),r>1)this.setBefore(l,h,n);else{for(let t in h)l.beforeStyle[t]=e[t];this.fromStyle=l.beforeStyle,this.toStyle=l.style}n=h,t.push(l)}d?((this.duration<=u||!s||!s.duration)&&this.changeDuration(u+.2*d),this.allocateTime((this.duration-u)/d)):u&&this.changeDuration(u),this.emit(_.CREATED,this)}changeDuration(e){const{config:t}=this;this.config=t?Object.assign(Object.assign({},t),{duration:e}):{duration:e}}setBefore(e,t,i){const{fromStyle:s,toStyle:r,target:o}=this;for(let n in t)void 0===s[n]&&(s[n]=r[n]=t===i?i[n]:o[n]),e.beforeStyle[n]=void 0===i[n]?r[n]:i[n],r[n]=t[n]}allocateTime(e){let t,{frames:i}=this,{length:s}=i;for(let r=0;r<s;r++)t=i[r],void 0===t.duration&&(t.duration=t.autoDuration?e*t.autoDuration:e),t.totalTime||(t.autoDelay&&(t.delay=t.autoDelay*e),t.delay&&(t.totalTime=t.duration,t.totalTime+=t.delay))}requestAnimate(){this.requestAnimateTime=Date.now(),n.requestRender(this.animate.bind(this))}animate(e,t){if(!t){if(!this.running)return;this.time+=(Date.now()-this.requestAnimateTime)/1e3}const{duration:i}=this,s=this.time*this.speed;if(s<i){for(;s-this.playedTotalTime>this.frameTotalTime;)this.transition(1),this.nowReverse?this.reverseNextFrame():this.nextFrame();const e=this.nowReverse?0:this.frame.delay||0,t=s-this.playedTotalTime-e,i=this.frame.duration;if(t>i)this.transition(1);else if(t>=0){const e=i?t/i:1;this.transition(this.frame.easingFn?this.frame.easingFn(e):this.easingFn(e))}}else this.end();if(!t)if(s<i)this.requestAnimate();else{const{loop:e,loopDelay:t,swing:i}=this;if((!1!==e||i)&&(this.looped?this.looped++:this.looped=1,"number"!=typeof e||e&&!(this.looped>=e)))return i&&(this.nowReverse=!this.nowReverse),void(t?this.timer=setTimeout((()=>{this.timer=0,this.begin()}),t/this.speed*1e3):this.begin());this.complete()}}start(e){this.requestAnimateTime=1;const{reverse:t}=this;if((t||this.nowReverse)&&(this.nowReverse=t),this.looped&&(this.looped=0),e)this.begin(!0);else{const{delay:e}=this;e?this.timer=setTimeout((()=>{this.timer=0,this.begin()}),e/this.speed*1e3):this.begin()}}begin(e){this.playedTotalTime=this.time=0,this.nowReverse?this.setTo():this.setFrom(),e||this.requestAnimate()}end(){this.nowReverse?this.setFrom():this.setTo()}complete(){this.requestAnimateTime=0,this.running=!1;const{realEnding:e}=this;"from"===e?this.setFrom():"to"===e&&this.setTo(),this.clearTimer(),this.emit(_.COMPLETED,this)}setFrom(){this.nowIndex=0,this.setStyle(this.fromStyle)}setTo(){this.nowIndex=this.frames.length-1,this.setStyle(this.toStyle)}nextFrame(){this.nowIndex+1>=this.frames.length||(this.playedTotalTime+=this.frameTotalTime,this.nowIndex++)}reverseNextFrame(){this.nowIndex-1<0||(this.playedTotalTime+=this.frameTotalTime,this.nowIndex--)}transition(e){const{style:t,beforeStyle:i}=this.frame,s=this.nowReverse?t:i,r=this.nowReverse?i:t;if(0===e)this.setStyle(s);else if(1===e)this.setStyle(r);else{const{attrsMap:i,target:o}=this;let n,l,h,{betweenStyle:u}=this.frame;u||(u=this.frame.betweenStyle={});for(let d in t)i&&!i[d]||(n=s[d],l=r[d],h=a.list[d]||a.value,n!==l&&(u[d]=h(n,l,e,o)));this.setStyle(u)}this.emit(_.UPDATE,this)}setStyle(e){this.target.set(e,this.isTemp)}clearTimer(e){this.timer&&(clearTimeout(this.timer),this.timer=0,e&&e())}destroy(e){this.destroyed||(super.destroy(),e&&!this.completed?this.stop():this.pause(),this.target=this.config=this.frames=null,this.destroyed=!0)}};m([P("ease")],M.prototype,"easing",void 0),m([P(0)],M.prototype,"delay",void 0),m([P(.2)],M.prototype,"duration",void 0),m([P("auto")],M.prototype,"ending",void 0),m([P(!1)],M.prototype,"reverse",void 0),m([P(!1)],M.prototype,"swing",void 0),m([P(!1)],M.prototype,"loop",void 0),m([P(0)],M.prototype,"loopDelay",void 0),m([P(1)],M.prototype,"speed",void 0),m([P(!0)],M.prototype,"autoplay",void 0),m([P()],M.prototype,"join",void 0),m([P()],M.prototype,"attrs",void 0),M=m([i(s)],M);const I={transparent:"FFF0",aliceblue:"F0F8FF",antiquewhite:"FAEBD7",aqua:"0FF",aquamarine:"7FFFD4",azure:"F0FFFF",beige:"F5F5DC",bisque:"FFE4C4",black:"0",blanchedalmond:"FFEBCD",blue:"00F",blueviolet:"8A2BE2",brown:"A52A2A",burlywood:"DEB887",cadetblue:"5F9EA0",chartreuse:"7FFF00",chocolate:"D2691E",coral:"FF7F50",cornflowerblue:"6495ED",cornsilk:"FFF8DC",crimson:"DC143C",cyan:"0FF",darkblue:"00008B",darkcyan:"008B8B",darkgoldenrod:"B8860B",darkgray:"A9",darkgreen:"006400",darkgrey:"A9",darkkhaki:"BDB76B",darkmagenta:"8B008B",darkolivegreen:"556B2F",darkorange:"FF8C00",darkorchid:"9932CC",darkred:"8B0000",darksalmon:"E9967A",darkseagreen:"8FBC8F",darkslateblue:"483D8B",darkslategray:"2F4F4F",darkslategrey:"2F4F4F",darkturquoise:"00CED1",darkviolet:"9400D3",deeppink:"FF1493",deepskyblue:"00BFFF",dimgray:"69",dimgrey:"69",dodgerblue:"1E90FF",firebrick:"B22222",floralwhite:"FFFAF0",forestgreen:"228B22",fuchsia:"F0F",gainsboro:"DC",ghostwhite:"F8F8FF",gold:"FFD700",goldenrod:"DAA520",gray:"80",green:"008000",greenyellow:"ADFF2F",grey:"80",honeydew:"F0FFF0",hotpink:"FF69B4",indianred:"CD5C5C",indigo:"4B0082",ivory:"FFFFF0",khaki:"F0E68C",lavender:"E6E6FA",lavenderblush:"FFF0F5",lawngreen:"7CFC00",lemonchiffon:"FFFACD",lightblue:"ADD8E6",lightcoral:"F08080",lightcyan:"E0FFFF",lightgoldenrodyellow:"FAFAD2",lightgray:"D3",lightgreen:"90EE90",lightgrey:"D3",lightpink:"FFB6C1",lightsalmon:"FFA07A",lightseagreen:"20B2AA",lightskyblue:"87CEFA",lightslategray:"789",lightslategrey:"789",lightsteelblue:"B0C4DE",lightyellow:"FFFFE0",lime:"00FF00",limegreen:"32CD32",linen:"FAF0E6",magenta:"FF00FF",maroon:"800000",mediumaquamarine:"66CDAA",mediumblue:"0000CD",mediumorchid:"BA55D3",mediumpurple:"9370DB",mediumseagreen:"3CB371",mediumslateblue:"7B68EE",mediumspringgreen:"00FA9A",mediumturquoise:"48D1CC",mediumvioletred:"C71585",midnightblue:"191970",mintcream:"F5FFFA",mistyrose:"FFE4E1",moccasin:"FFE4B5",navajowhite:"FFDEAD",navy:"000080",oldlace:"FDF5E6",olive:"808000",olivedrab:"6B8E23",orange:"FFA500",orangered:"FF4500",orchid:"DA70D6",palegoldenrod:"EEE8AA",palegreen:"98FB98",paleturquoise:"AFEEEE",palevioletred:"D87093",papayawhip:"FFEFD5",peachpuff:"FFDAB9",peru:"CD853F",pink:"FFC0CB",plum:"DDA0DD",powderblue:"B0E0E6",purple:"800080",rebeccapurple:"639",red:"F00",rosybrown:"BC8F8F",royalblue:"4169E1",saddlebrown:"8B4513",salmon:"FA8072",sandybrown:"F4A460",seagreen:"2E8B57",seashell:"FFF5EE",sienna:"A0522D",silver:"C0",skyblue:"87CEEB",slateblue:"6A5ACD",slategray:"708090",slategrey:"708090",snow:"FFFAFA",springgreen:"00FF7F",steelblue:"4682B4",tan:"D2B48C",teal:"008080",thistle:"D8BFD8",tomato:"FF6347",turquoise:"40E0D0",violet:"EE82EE",wheat:"F5DEB3",white:"F",whitesmoke:"F5",yellow:"FF0",yellowgreen:"9ACD32"},L=/^rgb\((\d+),\s*(\d+),\s*(\d+)/i,U=/^rgba\((\d+),\s*(\d+),\s*(\d+),\s*(\d*\.?\d+)/i,N=/^hsl\((\d+),\s*(\d+)%\s*,\s*(\d+)%/i,z=/^hsla\((\d+),\s*(\d+)%\s*,\s*(\d+)%\s*,\s*(\d*\.?\d+)/i,K=parseInt,Y=parseFloat,{round:H}=Math;let G={},J=0;function Q(e){let t,i,s,r=1;switch(e.length){case 9:t=K(e.slice(1,3),16),i=K(e.slice(3,5),16),s=K(e.slice(5,7),16),r=K(e.slice(7,9),16)/255;break;case 7:t=K(e.slice(1,3),16),i=K(e.slice(3,5),16),s=K(e.slice(5,7),16);break;case 5:t=K(e[1]+e[1],16),i=K(e[2]+e[2],16),s=K(e[3]+e[3],16),r=K(e[4]+e[4],16)/255;break;case 4:t=K(e[1]+e[1],16),i=K(e[2]+e[2],16),s=K(e[3]+e[3],16);break;case 3:t=i=s=K(e[1]+e[2],16);break;case 2:t=i=s=K(e[1]+e[1],16)}return{r:t,g:i,b:s,a:r}}const V=1/6,W=.5,X=2/3,Z=1/3;function $(e,t,i){return i<0?i++:i>1&&i--,i<V?e+6*(t-e)*i:i<W?t:i<X?e+(t-e)*(X-i)*6:e}function ee(e,t,i,s=1){let r,o,n;if(e/=360,i/=100,0===(t/=100))r=o=n=i;else{let s=i<.5?i*(1+t):i+t-i*t,a=2*i-s;r=$(a,s,e+Z),o=$(a,s,e),n=$(a,s,e-Z)}return{r:H(255*r),g:H(255*o),b:H(255*n),a:s}}l.object=function(e,t){let i,s=void 0!==t&&1!==t;if("string"==typeof e){const t=G[e];if(t)i=Object.assign({},t);else{switch(e[0]){case"#":i=Q(e);break;case"R":case"r":"("===e[4]&&U.test(e)?i=function(e){const t=U.exec(e);return{r:K(t[1]),g:K(t[2]),b:K(t[3]),a:Y(t[4])}}(e):"("===e[3]&&L.test(e)&&(i=function(e){const t=L.exec(e);return{r:K(t[1]),g:K(t[2]),b:K(t[3]),a:1}}(e));break;case"H":case"h":"("===e[4]&&z.test(e)?i=function(e){const t=z.exec(e);return ee(Y(t[1]),Y(t[2]),Y(t[3]),Y(t[4]))}(e):"("===e[3]&&N.test(e)&&(i=function(e){const t=N.exec(e);return ee(Y(t[1]),Y(t[2]),Y(t[3]),1)}(e))}if(!i){const t=I[e.toLowerCase()];t&&(i=Q("#"+t))}i&&(J++,J>1e4&&(G={},J=0),G[e]=Object.assign({},i))}}else"object"==typeof e&&(void 0===e.a&&(e.a=1),s&&(e=Object.assign({},e)),i=e);return i||(i={r:255,g:255,b:255,a:1}),s&&(i.a*=t),i};const{round:te}=Math,{fourNumber:ie}=h,se={fill:ae,stroke:ae,cornerRadius:(e,t,i)=>"number"==typeof e&&"number"==typeof t?oe(e,t,i):(e=ie(e),t=ie(t),e.map(((e,s)=>oe(e,t[s],i)))),shadow:le,innerShadow:le},re={value:function(e,t,i){return"number"==typeof e&&"number"==typeof t?e+(t-e)*i:t},number:oe,color:ne};function oe(e,t,i,s){e||(e=0),t||(t=0);const r=e+(t-e)*i;return s?te(r):r}function ne(e,t,i){e=l.object(e),t=l.object(t);const s=oe(e.r,t.r,i,1)+","+oe(e.g,t.g,i,1)+","+oe(e.b,t.b,i,1),r=oe(e.a,t.a,i);return 1===r?"rgb("+s+")":"rgba("+s+","+r+")"}function ae(e,t,i){return"string"==typeof e&&"string"==typeof t?ne(e,t,i):t}function le(e,t,i){return e instanceof Array||t instanceof Array?t:(t=t||{},{x:oe((e=e||{}).x,t.x,i),y:oe(e.y,t.y,i),blur:oe(e.blur,t.blur,i),spread:oe(e.spread,t.spread,i),color:ne(e.color||"#FFFFFF00",t.color||"#FFFFFF00",i),visible:t.visible,blendMode:t.blendMode,box:t.box||e.box})}u.canAnimate=!0,Object.assign(a,re),Object.assign(a.list,se);const he=d.prototype;var ue;e(ue,(e=>t({set(t){this.__setAttr(e,t),this.leafer&&(t?this.animate(t,void 0,"animation"):this.killAnimate("animation"))}})))(he,"animation"),c()(he,"animationOut"),c(!0)(he,"transition"),c()(he,"transitionOut"),he.animate=function(e,t,i,s){return void 0===e?this.__animate:("object"==typeof e&&(e.keyframes?(t=e,e=e.keyframes):e.style&&(t=e,e=e.style)),this.killAnimate(i),this.__animate=new M(this,e,t,s))},he.killAnimate=function(e){const t=this.__animate;t&&(t.kill(),this.__animate=null)},he.__runAnimation=function(e,t){this.animate("in"===e?this.animation:this.animationOut),t&&this.__animate.on(_.COMPLETED,t)};export{M as Animate,R as AnimateEasing,_ as AnimateEvent};
