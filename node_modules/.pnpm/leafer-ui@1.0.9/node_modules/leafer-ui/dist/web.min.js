var LeaferUI=function(t){"use strict";const e={toURL(t,e){let i=encodeURIComponent(t);return"text"===e?i="data:text/plain;charset=utf-8,"+i:"svg"===e&&(i="data:image/svg+xml,"+i),i},image:{hitCanvasSize:100,maxCacheSize:4096e3,maxPatternSize:8847360,crossOrigin:"anonymous",getRealURL(t){const{prefix:i,suffix:s}=e.image;return!s||t.startsWith("data:")||t.startsWith("blob:")||(t+=(t.includes("?")?"&":"?")+s),i&&"/"===t[0]&&(t=i+t),t}}},i={},s={RUNTIME:"runtime",LEAF:"leaf",TASK:"task",CNAVAS:"canvas",IMAGE:"image",types:{},create(t){const{types:e}=n;return e[t]?e[t]++:(e[t]=1,0)}},n=s,{round:r,pow:o,PI:a}=Math,h={within:(t,e,i)=>("object"==typeof e&&(i=e.max,e=e.min),void 0!==e&&t<e&&(t=e),void 0!==i&&t>i&&(t=i),t),fourNumber(t,e){let i;if(t instanceof Array)switch(t.length){case 4:i=void 0===e?t:[...t];break;case 2:i=[t[0],t[1],t[0],t[1]];break;case 3:i=[t[0],t[1],t[2],t[1]];break;case 1:t=t[0];break;default:t=0}if(i||(i=[t,t,t,t]),e)for(let t=0;t<4;t++)i[t]>e&&(i[t]=e);return i},formatRotation:(t,e)=>(t%=360,e?t<0&&(t+=360):(t>180&&(t-=360),t<-180&&(t+=360)),h.float(t)),getGapRotation(t,e,i=0){let s=t+i;if(e>1){const t=Math.abs(s%e);(t<1||t>e-1)&&(s=Math.round(s/e)*e)}return s-i},float(t,e){const i=e?o(10,e):1e12;return-0===(t=r(t*i)/i)?0:t},getScaleData:(t,e,i,s)=>(s||(s={}),e?(s.scaleX=("number"==typeof e?e:e.width)/i.width,s.scaleY=("number"==typeof e?e:e.height)/i.height):t&&h.assignScale(s,t),s),assignScale(t,e){"number"==typeof e?t.scaleX=t.scaleY=e:(t.scaleX=e.x,t.scaleY=e.y)}},l=a/180,d=2*a,c=a/2;function u(){return{x:0,y:0}}function _(){return{x:0,y:0,width:0,height:0}}function p(){return{a:1,b:0,c:0,d:1,e:0,f:0}}const{sin:g,cos:f,acos:y,sqrt:v}=Math,{float:m}=h,w={};function x(){return Object.assign(Object.assign(Object.assign({},{a:1,b:0,c:0,d:1,e:0,f:0}),{x:0,y:0,width:0,height:0}),{scaleX:1,scaleY:1,rotation:0,skewX:0,skewY:0})}const b={defaultMatrix:{a:1,b:0,c:0,d:1,e:0,f:0},defaultWorld:x(),tempMatrix:{},set(t,e=1,i=0,s=0,n=1,r=0,o=0){t.a=e,t.b=i,t.c=s,t.d=n,t.e=r,t.f=o},get:p,getWorld:x,copy(t,e){t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t.e=e.e,t.f=e.f},translate(t,e,i){t.e+=e,t.f+=i},translateInner(t,e,i,s){t.e+=t.a*e+t.c*i,t.f+=t.b*e+t.d*i,s&&(t.e-=e,t.f-=i)},scale(t,e,i=e){t.a*=e,t.b*=e,t.c*=i,t.d*=i},scaleOfOuter(t,e,i,s){E.toInnerPoint(t,e,w),E.scaleOfInner(t,w,i,s)},scaleOfInner(t,e,i,s=i){E.translateInner(t,e.x,e.y),E.scale(t,i,s),E.translateInner(t,-e.x,-e.y)},rotate(t,e){const{a:i,b:s,c:n,d:r}=t,o=f(e*=l),a=g(e);t.a=i*o-s*a,t.b=i*a+s*o,t.c=n*o-r*a,t.d=n*a+r*o},rotateOfOuter(t,e,i){E.toInnerPoint(t,e,w),E.rotateOfInner(t,w,i)},rotateOfInner(t,e,i){E.translateInner(t,e.x,e.y),E.rotate(t,i),E.translateInner(t,-e.x,-e.y)},skew(t,e,i){const{a:s,b:n,c:r,d:o}=t;i&&(i*=l,t.a=s+r*i,t.b=n+o*i),e&&(e*=l,t.c=r+s*e,t.d=o+n*e)},skewOfOuter(t,e,i,s){E.toInnerPoint(t,e,w),E.skewOfInner(t,w,i,s)},skewOfInner(t,e,i,s=0){E.translateInner(t,e.x,e.y),E.skew(t,i,s),E.translateInner(t,-e.x,-e.y)},multiply(t,e){const{a:i,b:s,c:n,d:r,e:o,f:a}=t;t.a=e.a*i+e.b*n,t.b=e.a*s+e.b*r,t.c=e.c*i+e.d*n,t.d=e.c*s+e.d*r,t.e=e.e*i+e.f*n+o,t.f=e.e*s+e.f*r+a},multiplyParent(t,e,i,s,n,r){let{e:o,f:a}=t;if(r&&(o+=r.scrollX,a+=r.scrollY),i||(i=t),void 0===s&&(s=1!==t.a||t.b||t.c||1!==t.d),s){const{a:s,b:r,c:o,d:a}=t;i.a=s*e.a+r*e.c,i.b=s*e.b+r*e.d,i.c=o*e.a+a*e.c,i.d=o*e.b+a*e.d,n&&(i.scaleX=e.scaleX*n.scaleX,i.scaleY=e.scaleY*n.scaleY)}else i.a=e.a,i.b=e.b,i.c=e.c,i.d=e.d,n&&(i.scaleX=e.scaleX,i.scaleY=e.scaleY);i.e=o*e.a+a*e.c+e.e,i.f=o*e.b+a*e.d+e.f},divide(t,e){E.multiply(t,E.tempInvert(e))},divideParent(t,e){E.multiplyParent(t,E.tempInvert(e))},tempInvert(t){const{tempMatrix:e}=E;return E.copy(e,t),E.invert(e),e},invert(t){const{a:e,b:i,c:s,d:n,e:r,f:o}=t;if(i||s){const a=1/(e*n-i*s);t.a=n*a,t.b=-i*a,t.c=-s*a,t.d=e*a,t.e=-(r*n-o*s)*a,t.f=-(o*e-r*i)*a}else if(1===e&&1===n)t.e=-r,t.f=-o;else{const i=1/(e*n);t.a=n*i,t.d=e*i,t.e=-r*n*i,t.f=-o*e*i}},toOuterPoint(t,e,i,s){const{x:n,y:r}=e;i||(i=e),i.x=n*t.a+r*t.c,i.y=n*t.b+r*t.d,s||(i.x+=t.e,i.y+=t.f)},toInnerPoint(t,e,i,s){const{a:n,b:r,c:o,d:a}=t,h=1/(n*a-r*o),{x:l,y:d}=e;if(i||(i=e),i.x=(l*a-d*o)*h,i.y=(d*n-l*r)*h,!s){const{e:e,f:s}=t;i.x-=(e*a-s*o)*h,i.y-=(s*n-e*r)*h}},setLayout(t,e,i,s,n){const{x:r,y:o,scaleX:a,scaleY:h}=e;if(void 0===n&&(n=e.rotation||e.skewX||e.skewY),n){const{rotation:i,skewX:s,skewY:n}=e,r=i*l,o=f(r),d=g(r);if(s||n){const e=s*l,i=n*l;t.a=(o+i*-d)*a,t.b=(d+i*o)*a,t.c=(e*o-d)*h,t.d=(o+e*d)*h}else t.a=o*a,t.b=d*a,t.c=-d*h,t.d=o*h}else t.a=a,t.b=0,t.c=0,t.d=h;t.e=r,t.f=o,(i=i||s)&&E.translateInner(t,-i.x,-i.y,!s)},getLayout(t,e,i,s){const{a:n,b:r,c:o,d:a,e:h,f:d}=t;let u,_,p,w,x,b=h,E=d;if(r||o){const t=n*a-r*o;if(o&&!s){u=v(n*n+r*r),_=t/u;const e=n/u;p=r>0?y(e):-y(e)}else{_=v(o*o+a*a),u=t/_;const e=o/_;p=c-(a>0?y(-e):-y(e))}const e=m(f(p)),i=g(p);u=m(u),_=m(_),w=e?m((o/_+i)/e/l,9):0,x=e?m((r/u-i)/e/l,9):0,p=m(p/l)}else u=n,_=a,p=w=x=0;return(e=i||e)&&(b+=e.x*n+e.y*o,E+=e.x*r+e.y*a,i||(b-=e.x,E-=e.y)),{x:b,y:E,scaleX:u,scaleY:_,rotation:p,skewX:w,skewY:x}},withScale(t,e,i=e){const s=t;if(!e||!i){const{a:s,b:n,c:r,d:o}=t;n||r?i=(s*o-n*r)/(e=v(s*s+n*n)):(e=s,i=o)}return s.scaleX=e,s.scaleY=i,s},reset(t){E.set(t)}},E=b,{toInnerPoint:B,toOuterPoint:P}=b,{sin:R,cos:C,abs:T,sqrt:k,atan2:L,min:S,PI:O}=Math,D={defaultPoint:{x:0,y:0},tempPoint:{},tempRadiusPoint:{},set(t,e=0,i=0){t.x=e,t.y=i},setRadius(t,e,i){t.radiusX=e,t.radiusY=void 0===i?e:i},copy(t,e){t.x=e.x,t.y=e.y},copyFrom(t,e,i){t.x=e,t.y=i},move(t,e,i){t.x+=e,t.y+=i},scale(t,e,i=e){t.x&&(t.x*=e),t.y&&(t.y*=i)},scaleOf(t,e,i,s=i){t.x+=(t.x-e.x)*(i-1),t.y+=(t.y-e.y)*(s-1)},rotate(t,e,i){i||(i=M.defaultPoint);const s=C(e*=l),n=R(e),r=t.x-i.x,o=t.y-i.y;t.x=i.x+r*s-o*n,t.y=i.y+r*n+o*s},tempToInnerOf(t,e){const{tempPoint:i}=M;return A(i,t),B(e,i,i),i},tempToOuterOf(t,e){const{tempPoint:i}=M;return A(i,t),P(e,i,i),i},tempToInnerRadiusPointOf(t,e){const{tempRadiusPoint:i}=M;return A(i,t),M.toInnerRadiusPointOf(t,e,i),i},toInnerRadiusPointOf(t,e,i){i||(i=t),B(e,t,i),i.radiusX=Math.abs(t.radiusX/e.scaleX),i.radiusY=Math.abs(t.radiusY/e.scaleY)},toInnerOf(t,e,i){B(e,t,i)},toOuterOf(t,e,i){P(e,t,i)},getCenter:(t,e)=>({x:t.x+(e.x-t.x)/2,y:t.y+(e.y-t.y)/2}),getCenterX:(t,e)=>t+(e-t)/2,getCenterY:(t,e)=>t+(e-t)/2,getDistance:(t,e)=>I(t.x,t.y,e.x,e.y),getDistanceFrom(t,e,i,s){const n=T(i-t),r=T(s-e);return k(n*n+r*r)},getMinDistanceFrom:(t,e,i,s,n,r)=>S(I(t,e,i,s),I(i,s,n,r)),getAngle:(t,e)=>W(t,e)/l,getRotation:(t,e,i,s)=>(s||(s=e),M.getRadianFrom(t.x,t.y,e.x,e.y,i.x,i.y,s.x,s.y)/l),getRadianFrom(t,e,i,s,n,r,o,a){void 0===o&&(o=i,a=s);let h=L(e-s,t-i);const l=L(r-a,n-o)-h;return l<-O?l+d:l},getAtan2:(t,e)=>L(e.y-t.y,e.x-t.x),getDistancePoint(t,e,i,s){const n=W(t,e);return(e=s?e:{}).x=t.x+C(n)*i,e.y=t.y+R(n)*i,e},toNumberPoints(t){let e=t;return"object"==typeof t[0]&&(e=[],t.forEach((t=>e.push(t.x,t.y)))),e},reset(t){M.reset(t)}},M=D,{getDistanceFrom:I,copy:A,getAtan2:W}=M;class F{constructor(t,e){this.set(t,e)}set(t,e){return"object"==typeof t?D.copy(this,t):D.set(this,t,e),this}get(){const{x:t,y:e}=this;return{x:t,y:e}}clone(){return new F(this)}move(t,e){return D.move(this,t,e),this}scale(t,e){return D.scale(this,t,e),this}scaleOf(t,e,i){return D.scaleOf(this,t,e,i),this}rotate(t,e){return D.rotate(this,t,e),this}rotateOf(t,e){return D.rotate(this,e,t),this}getRotation(t,e,i){return D.getRotation(this,t,e,i)}toInnerOf(t,e){return D.toInnerOf(this,t,e),this}toOuterOf(t,e){return D.toOuterOf(this,t,e),this}getCenter(t){return new F(D.getCenter(this,t))}getDistance(t){return D.getDistance(this,t)}getDistancePoint(t,e,i){return new F(D.getDistancePoint(this,t,e,i))}getAngle(t){return D.getAngle(this,t)}getAtan2(t){return D.getAtan2(this,t)}reset(){return D.reset(this),this}}const z=new F;class N{constructor(t,e,i,s,n,r){this.set(t,e,i,s,n,r)}set(t,e,i,s,n,r){return"object"==typeof t?b.copy(this,t):b.set(this,t,e,i,s,n,r),this}setWith(t){return b.copy(this,t),this.scaleX=t.scaleX,this.scaleY=t.scaleY,this}get(){const{a:t,b:e,c:i,d:s,e:n,f:r}=this;return{a:t,b:e,c:i,d:s,e:n,f:r}}clone(){return new N(this)}translate(t,e){return b.translate(this,t,e),this}translateInner(t,e){return b.translateInner(this,t,e),this}scale(t,e){return b.scale(this,t,e),this}scaleWith(t,e){return b.scale(this,t,e),this.scaleX*=t,this.scaleY*=e||t,this}scaleOfOuter(t,e,i){return b.scaleOfOuter(this,t,e,i),this}scaleOfInner(t,e,i){return b.scaleOfInner(this,t,e,i),this}rotate(t){return b.rotate(this,t),this}rotateOfOuter(t,e){return b.rotateOfOuter(this,t,e),this}rotateOfInner(t,e){return b.rotateOfInner(this,t,e),this}skew(t,e){return b.skew(this,t,e),this}skewOfOuter(t,e,i){return b.skewOfOuter(this,t,e,i),this}skewOfInner(t,e,i){return b.skewOfInner(this,t,e,i),this}multiply(t){return b.multiply(this,t),this}multiplyParent(t){return b.multiplyParent(this,t),this}divide(t){return b.divide(this,t),this}divideParent(t){return b.divideParent(this,t),this}invert(){return b.invert(this),this}invertWith(){return b.invert(this),this.scaleX=1/this.scaleX,this.scaleY=1/this.scaleY,this}toOuterPoint(t,e,i){b.toOuterPoint(this,t,e,i)}toInnerPoint(t,e,i){b.toInnerPoint(this,t,e,i)}setLayout(t,e,i){return b.setLayout(this,t,e,i),this}getLayout(t,e,i){return b.getLayout(this,t,e,i)}withScale(t,e){return b.withScale(this,t,e)}reset(){b.reset(this)}}const U=new N,Y={tempPointBounds:{},setPoint(t,e,i){t.minX=t.maxX=e,t.minY=t.maxY=i},addPoint(t,e,i){t.minX=e<t.minX?e:t.minX,t.minY=i<t.minY?i:t.minY,t.maxX=e>t.maxX?e:t.maxX,t.maxY=i>t.maxY?i:t.maxY},addBounds(t,e,i,s,n){X(t,e,i),X(t,e+s,i+n)},copy(t,e){t.minX=e.minX,t.minY=e.minY,t.maxX=e.maxX,t.maxY=e.maxY},addPointBounds(t,e){t.minX=e.minX<t.minX?e.minX:t.minX,t.minY=e.minY<t.minY?e.minY:t.minY,t.maxX=e.maxX>t.maxX?e.maxX:t.maxX,t.maxY=e.maxY>t.maxY?e.maxY:t.maxY},toBounds(t,e){e.x=t.minX,e.y=t.minY,e.width=t.maxX-t.minX,e.height=t.maxY-t.minY}},{addPoint:X}=Y,{tempPointBounds:H,setPoint:j,addPoint:V,toBounds:G}=Y,{toOuterPoint:K}=b,{float:q,fourNumber:Z}=h,{floor:Q,ceil:J}=Math;let $,tt,et,it;const st={},nt={},rt={tempBounds:{},set(t,e=0,i=0,s=0,n=0){t.x=e,t.y=i,t.width=s,t.height=n},copy(t,e){t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height},copyAndSpread(t,e,i,s,n){const{x:r,y:o,width:a,height:h}=e;if(i instanceof Array){const e=Z(i);s?ot.set(t,r+e[3],o+e[0],a-e[1]-e[3],h-e[2]-e[0]):ot.set(t,r-e[3],o-e[0],a+e[1]+e[3],h+e[2]+e[0])}else s&&(i=-i),ot.set(t,r-i,o-i,a+2*i,h+2*i);n&&("width"===n?(t.y=o,t.height=h):(t.x=r,t.width=a))},minX:t=>t.width>0?t.x:t.x+t.width,minY:t=>t.height>0?t.y:t.y+t.height,maxX:t=>t.width>0?t.x+t.width:t.x,maxY:t=>t.height>0?t.y+t.height:t.y,move(t,e,i){t.x+=e,t.y+=i},getByMove:(t,e,i)=>(t=Object.assign({},t),ot.move(t,e,i),t),toOffsetOutBounds(t,e,i){e?ht(e,t):e=t,i?(e.offsetX=-(ot.maxX(i)-t.x),e.offsetY=-(ot.maxY(i)-t.y)):(e.offsetX=t.x+t.width,e.offsetY=t.y+t.height),ot.move(e,-e.offsetX,-e.offsetY)},scale(t,e,i=e){D.scale(t,e,i),t.width*=e,t.height*=i},scaleOf(t,e,i,s=i){D.scaleOf(t,e,i,s),t.width*=i,t.height*=s},tempToOuterOf:(t,e)=>(ot.copy(ot.tempBounds,t),ot.toOuterOf(ot.tempBounds,e),ot.tempBounds),getOuterOf:(t,e)=>(t=Object.assign({},t),ot.toOuterOf(t,e),t),toOuterOf(t,e,i){if(i||(i=t),0===e.b&&0===e.c){const{a:s,d:n}=e;s>0?(i.width=t.width*s,i.x=e.e+t.x*s):(i.width=t.width*-s,i.x=e.e+t.x*s-i.width),n>0?(i.height=t.height*n,i.y=e.f+t.y*n):(i.height=t.height*-n,i.y=e.f+t.y*n-i.height)}else st.x=t.x,st.y=t.y,K(e,st,nt),j(H,nt.x,nt.y),st.x=t.x+t.width,K(e,st,nt),V(H,nt.x,nt.y),st.y=t.y+t.height,K(e,st,nt),V(H,nt.x,nt.y),st.x=t.x,K(e,st,nt),V(H,nt.x,nt.y),G(H,i)},toInnerOf(t,e,i){i||(i=t),ot.move(i,-e.e,-e.f),ot.scale(i,1/e.a,1/e.d)},getFitMatrix(t,e,i=1){const s=Math.min(i,Math.min(t.width/e.width,t.height/e.height));return new N(s,0,0,s,-e.x*s,-e.y*s)},getSpread(t,e,i){const s={};return ot.copyAndSpread(s,t,e,!1,i),s},spread(t,e,i){ot.copyAndSpread(t,t,e,!1,i)},shrink(t,e,i){ot.copyAndSpread(t,t,e,!0,i)},ceil(t){const{x:e,y:i}=t;t.x=Q(t.x),t.y=Q(t.y),t.width=e>t.x?J(t.width+e-t.x):J(t.width),t.height=i>t.y?J(t.height+i-t.y):J(t.height)},unsign(t){t.width<0&&(t.x+=t.width,t.width=-t.width),t.height<0&&(t.y+=t.height,t.height=-t.height)},float(t,e){t.x=q(t.x,e),t.y=q(t.y,e),t.width=q(t.width,e),t.height=q(t.height,e)},add(t,e,i){$=t.x+t.width,tt=t.y+t.height,et=e.x,it=e.y,i||(et+=e.width,it+=e.height),$=$>et?$:et,tt=tt>it?tt:it,t.x=t.x<e.x?t.x:e.x,t.y=t.y<e.y?t.y:e.y,t.width=$-t.x,t.height=tt-t.y},addList(t,e){ot.setListWithFn(t,e,void 0,!0)},setList(t,e,i=!1){ot.setListWithFn(t,e,void 0,i)},addListWithFn(t,e,i){ot.setListWithFn(t,e,i,!0)},setListWithFn(t,e,i,s=!1){let n,r=!0;for(let o=0,a=e.length;o<a;o++)n=i?i(e[o]):e[o],n&&(n.width||n.height)&&(r?(r=!1,s||ht(t,n)):at(t,n));r&&ot.reset(t)},setPoints(t,e){e.forEach(((t,e)=>0===e?j(H,t.x,t.y):V(H,t.x,t.y))),G(H,t)},setPoint(t,e){ot.set(t,e.x,e.y)},addPoint(t,e){at(t,e,!0)},getPoints(t){const{x:e,y:i,width:s,height:n}=t;return[{x:e,y:i},{x:e+s,y:i},{x:e+s,y:i+n},{x:e,y:i+n}]},hitRadiusPoint:(t,e,i)=>(i&&(e=D.tempToInnerRadiusPointOf(e,i)),e.x>=t.x-e.radiusX&&e.x<=t.x+t.width+e.radiusX&&e.y>=t.y-e.radiusY&&e.y<=t.y+t.height+e.radiusY),hitPoint:(t,e,i)=>(i&&(e=D.tempToInnerOf(e,i)),e.x>=t.x&&e.x<=t.x+t.width&&e.y>=t.y&&e.y<=t.y+t.height),hit:(t,e,i)=>(i&&(e=ot.tempToOuterOf(e,i)),!(t.y+t.height<e.y||e.y+e.height<t.y||t.x+t.width<e.x||e.x+e.width<t.x)),includes:(t,e,i)=>(i&&(e=ot.tempToOuterOf(e,i)),t.x<=e.x&&t.y<=e.y&&t.x+t.width>=e.x+e.width&&t.y+t.height>=e.y+e.height),getIntersectData(t,e,i){if(i&&(e=ot.tempToOuterOf(e,i)),!ot.hit(t,e))return{x:0,y:0,width:0,height:0};let{x:s,y:n,width:r,height:o}=e;return $=s+r,tt=n+o,et=t.x+t.width,it=t.y+t.height,s=s>t.x?s:t.x,n=n>t.y?n:t.y,$=$<et?$:et,tt=tt<it?tt:it,r=$-s,o=tt-n,{x:s,y:n,width:r,height:o}},intersect(t,e,i){ot.copy(t,ot.getIntersectData(t,e,i))},isSame:(t,e)=>t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height,isEmpty:t=>0===t.x&&0===t.y&&0===t.width&&0===t.height,reset(t){ot.set(t)}},ot=rt,{add:at,copy:ht}=ot;class lt{get minX(){return rt.minX(this)}get minY(){return rt.minY(this)}get maxX(){return rt.maxX(this)}get maxY(){return rt.maxY(this)}constructor(t,e,i,s){this.set(t,e,i,s)}set(t,e,i,s){return"object"==typeof t?rt.copy(this,t):rt.set(this,t,e,i,s),this}get(){const{x:t,y:e,width:i,height:s}=this;return{x:t,y:e,width:i,height:s}}clone(){return new lt(this)}move(t,e){return rt.move(this,t,e),this}scale(t,e){return rt.scale(this,t,e),this}scaleOf(t,e,i){return rt.scaleOf(this,t,e,i),this}toOuterOf(t,e){return rt.toOuterOf(this,t,e),this}toInnerOf(t,e){return rt.toInnerOf(this,t,e),this}getFitMatrix(t,e){return rt.getFitMatrix(this,t,e)}spread(t,e){return rt.spread(this,t,e),this}shrink(t,e){return rt.shrink(this,t,e),this}ceil(){return rt.ceil(this),this}unsign(){return rt.unsign(this),this}float(t){return rt.float(this,t),this}add(t){return rt.add(this,t),this}addList(t){return rt.setList(this,t,!0),this}setList(t){return rt.setList(this,t),this}addListWithFn(t,e){return rt.setListWithFn(this,t,e,!0),this}setListWithFn(t,e){return rt.setListWithFn(this,t,e),this}setPoint(t){return rt.setPoint(this,t),this}setPoints(t){return rt.setPoints(this,t),this}addPoint(t){return rt.addPoint(this,t),this}getPoints(){return rt.getPoints(this)}hitPoint(t,e){return rt.hitPoint(this,t,e)}hitRadiusPoint(t,e){return rt.hitRadiusPoint(this,t,e)}hit(t,e){return rt.hit(this,t,e)}includes(t,e){return rt.includes(this,t,e)}intersect(t,e){return rt.intersect(this,t,e),this}getIntersect(t,e){return new lt(rt.getIntersectData(this,t,e))}isSame(t){return rt.isSame(this,t)}isEmpty(){return rt.isEmpty(this)}reset(){rt.reset(this)}}const dt=new lt;class ct{constructor(t,e,i,s,n,r){"object"==typeof t?this.copy(t):this.set(t,e,i,s,n,r)}set(t=0,e=0,i=0,s=0,n=0,r=0){this.top=t,this.right=e,this.bottom=i,this.left=s,this.width=n,this.height=r}copy(t){const{top:e,right:i,bottom:s,left:n,width:r,height:o}=t;this.set(e,i,s,n,r,o)}getBoundsFrom(t){const{top:e,right:i,bottom:s,left:n,width:r,height:o}=this;return new lt(n,e,r||t.width-n-i,o||t.height-e-s)}}var ut,_t;t.Direction4=void 0,(ut=t.Direction4||(t.Direction4={}))[ut.top=0]="top",ut[ut.right=1]="right",ut[ut.bottom=2]="bottom",ut[ut.left=3]="left",t.Direction9=void 0,(_t=t.Direction9||(t.Direction9={}))[_t.topLeft=0]="topLeft",_t[_t.top=1]="top",_t[_t.topRight=2]="topRight",_t[_t.right=3]="right",_t[_t.bottomRight=4]="bottomRight",_t[_t.bottom=5]="bottom",_t[_t.bottomLeft=6]="bottomLeft",_t[_t.left=7]="left",_t[_t.center=8]="center",_t[_t["top-left"]=0]="top-left",_t[_t["top-right"]=2]="top-right",_t[_t["bottom-right"]=4]="bottom-right",_t[_t["bottom-left"]=6]="bottom-left";const pt=[{x:0,y:0},{x:.5,y:0},{x:1,y:0},{x:1,y:.5},{x:1,y:1},{x:.5,y:1},{x:0,y:1},{x:0,y:.5},{x:.5,y:.5}];pt.forEach((t=>t.type="percent"));const gt={directionData:pt,tempPoint:{},get:ft,toPoint(t,e,i,s,n){const r=ft(t);i.x=r.x,i.y=r.y,"percent"===r.type&&(i.x*=e.width,i.y*=e.height,n&&(i.x-=n.x,i.y-=n.y,r.x&&(i.x-=1===r.x?n.width:.5===r.x?r.x*n.width:0),r.y&&(i.y-=1===r.y?n.height:.5===r.y?r.y*n.height:0))),s||(i.x+=e.x,i.y+=e.y)}};function ft(e){return"string"==typeof e?pt[t.Direction9[e]]:e}const{toPoint:yt}=gt,vt={toPoint(t,e,i,s,n){yt(t,i,s,n,e)}},mt={0:1,1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1,".":1,e:1,E:1};class wt{constructor(t){this.repeatMap={},this.name=t}static get(t){return new wt(t)}static set filter(t){this.filterList=xt(t)}static set exclude(t){this.excludeList=xt(t)}log(...t){if(bt.enable){if(bt.filterList.length&&bt.filterList.every((t=>t!==this.name)))return;if(bt.excludeList.length&&bt.excludeList.some((t=>t===this.name)))return;console.log("%c"+this.name,"color:#21ae62",...t)}}tip(...t){bt.enable&&this.warn(...t)}warn(...t){bt.showWarn&&console.warn(this.name,...t)}repeat(t,...e){this.repeatMap[t]||(this.warn("repeat:"+t,...e),this.repeatMap[t]=!0)}error(...t){try{throw new Error}catch(e){console.error(this.name,...t,e)}}}function xt(t){return t?"string"==typeof t&&(t=[t]):t=[],t}wt.filterList=[],wt.excludeList=[],wt.showWarn=!0;const bt=wt,Et=wt.get("RunTime"),Bt={currentId:0,currentName:"",idMap:{},nameMap:{},nameToIdMap:{},start(t,e){const i=s.create(s.RUNTIME);return Pt.currentId=Pt.idMap[i]=e?performance.now():Date.now(),Pt.currentName=Pt.nameMap[i]=t,Pt.nameToIdMap[t]=i,i},end(t,e){const i=Pt.idMap[t],s=Pt.nameMap[t],n=e?(performance.now()-i)/1e3:Date.now()-i;Pt.idMap[t]=Pt.nameMap[t]=Pt.nameToIdMap[s]=void 0,Et.log(s,n,"ms")},endOfName(t,e){const i=Pt.nameToIdMap[t];void 0!==i&&Pt.end(i,e)}},Pt=Bt;function Rt(t){console.error("need plugin: @leafer-in/"+t)}const Ct=wt.get("UICreator"),Tt={list:{},register(t){const{__tag:e}=t.prototype;kt[e]?Ct.repeat(e):kt[e]=t},get(t,e,i,s,n,r){const o=new kt[t](e);return void 0!==i&&(o.x=i,s&&(o.y=s),n&&(o.width=n),r&&(o.height=r)),o}},{list:kt}=Tt,Lt=wt.get("EventCreator"),St={nameList:{},register(t){let e;Object.keys(t).forEach((i=>{e=t[i],"string"==typeof e&&(Ot[e]?Lt.repeat(e):Ot[e]=t)}))},changeName(t,e){const i=Ot[t];if(i){const s=Object.keys(i).find((e=>i[e]===t));s&&(i[s]=e,Ot[e]=i)}},has(t){return!!this.nameList[t]},get:(t,...e)=>new Ot[t](...e)},{nameList:Ot}=St;class Dt{constructor(){this.list=[]}add(t){t.manager=this,this.list.push(t)}get(t){let e;const{list:s}=this;for(let i=0,n=s.length;i<n;i++)if(e=s[i],e.recycled&&e.isSameSize(t))return e.recycled=!1,e.manager||(e.manager=this),e;const n=i.canvas(t);return this.add(n),n}recycle(t){t.recycled=!0}clearRecycled(){let t;const e=[];for(let i=0,s=this.list.length;i<s;i++)t=this.list[i],t.recycled?t.destroy():e.push(t);this.list=e}clear(){this.list.forEach((t=>{t.destroy()})),this.list.length=0}destroy(){this.clear()}}const Mt={default:(t,e)=>(It(e,t),It(t,e),t),assign(t,e){let i;Object.keys(e).forEach((s=>{var n;i=e[s],(null==i?void 0:i.constructor)===Object&&(null===(n=t[s])||void 0===n?void 0:n.constructor)===Object?It(t[s],e[s]):t[s]=e[s]}))},copyAttrs:(t,e,i)=>(i.forEach((i=>{void 0!==e[i]&&(t[i]=e[i])})),t),clone:t=>JSON.parse(JSON.stringify(t)),toMap(t){const e={};for(let i=0,s=t.length;i<s;i++)e[t[i]]=!0;return e}},{assign:It}=Mt;class At{get __useNaturalRatio(){return!0}get __isLinePath(){const{path:t}=this;return t&&6===t.length&&1===t[0]}get __blendMode(){if(this.eraser&&"path"!==this.eraser)return"destination-out";const{blendMode:t}=this;return"pass-through"===t?null:t}constructor(t){this.__leaf=t}__get(t){if(this.__input){const e=this.__input[t];if(void 0!==e)return e}return this[t]}__getData(){const t={tag:this.__leaf.tag},{__input:e}=this;let i;for(let s in this)"_"!==s[0]&&(i=e?e[s]:void 0,t[s]=void 0===i?this[s]:i);return t}__setInput(t,e){this.__input||(this.__input={}),this.__input[t]=e}__getInput(t){if(this.__input){const e=this.__input[t];if(void 0!==e)return e}if("path"!==t||this.__pathInputed)return this["_"+t]}__removeInput(t){this.__input&&void 0!==this.__input[t]&&(this.__input[t]=void 0)}__getInputData(t,e){const i={};if(t)if(t instanceof Array)for(let e of t)i[e]=this.__getInput(e);else for(let e in t)i[e]=this.__getInput(e);else{let t,e,{__input:s}=this;i.tag=this.__leaf.tag;for(let n in this)if("_"!==n[0]&&(t=this["_"+n],void 0!==t)){if("path"===n&&!this.__pathInputed)continue;e=s?s[n]:void 0,i[n]=void 0===e?t:e}}if(e&&e.matrix){const{a:t,b:e,c:s,d:n,e:r,f:o}=this.__leaf.__localMatrix;i.matrix={a:t,b:e,c:s,d:n,e:r,f:o}}return i}__setMiddle(t,e){this.__middle||(this.__middle={}),this.__middle[t]=e}__getMiddle(t){return this.__middle&&this.__middle[t]}__checkSingle(){const t=this;if("pass-through"===t.blendMode){const e=this.__leaf;t.opacity<1&&e.isBranch||e.__hasEraser||t.eraser?t.__single=!0:t.__single&&(t.__single=!1)}else t.__single=!0}__removeNaturalSize(){this.__naturalWidth=this.__naturalHeight=void 0}destroy(){this.__input=this.__middle=null}}var Wt;t.Answer=void 0,(Wt=t.Answer||(t.Answer={}))[Wt.No=0]="No",Wt[Wt.Yes=1]="Yes",Wt[Wt.NoAndSkip=2]="NoAndSkip",Wt[Wt.YesAndSkip=3]="YesAndSkip";function Ft(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o}function zt(t,e,i,s){return new(i||(i=Promise))((function(n,r){function o(t){try{h(s.next(t))}catch(t){r(t)}}function a(t){try{h(s.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((s=s.apply(t,e||[])).next())}))}function Nt(t){return(e,i)=>{t||(t=i),Object.defineProperty(e,i,{get(){return this.context[t]},set(e){this.context[t]=e}})}}"function"==typeof SuppressedError&&SuppressedError;const Ut=[];function Yt(){return(t,e)=>{Ut.push(e)}}const Xt=[];class Ht{set blendMode(t){"normal"===t&&(t="source-over"),this.context.globalCompositeOperation=t}get blendMode(){return this.context.globalCompositeOperation}set dashPattern(t){this.context.setLineDash(t||Xt)}get dashPattern(){return this.context.getLineDash()}__bindContext(){let t;Ut.forEach((e=>{t=this.context[e],t&&(this[e]=t.bind(this.context))})),this.textBaseline="alphabetic"}setTransform(t,e,i,s,n,r){}resetTransform(){}getTransform(){}save(){}restore(){}transform(t,e,i,s,n,r){"object"==typeof t?this.context.transform(t.a,t.b,t.c,t.d,t.e,t.f):this.context.transform(t,e,i,s,n,r)}translate(t,e){}scale(t,e){}rotate(t){}fill(t,e){}stroke(t){}clip(t,e){}fillRect(t,e,i,s){}strokeRect(t,e,i,s){}clearRect(t,e,i,s){}drawImage(t,e,i,s,n,r,o,a,h){switch(arguments.length){case 9:if(e<0){const t=-e/s*a;s+=e,e=0,r+=t,a-=t}if(i<0){const t=-i/n*h;n+=i,i=0,o+=t,h-=t}this.context.drawImage(t,e,i,s,n,r,o,a,h);break;case 5:this.context.drawImage(t,e,i,s,n);break;case 3:this.context.drawImage(t,e,i)}}beginPath(){}moveTo(t,e){}lineTo(t,e){}bezierCurveTo(t,e,i,s,n,r){}quadraticCurveTo(t,e,i,s){}closePath(){}arc(t,e,i,s,n,r){}arcTo(t,e,i,s,n){}ellipse(t,e,i,s,n,r,o,a){}rect(t,e,i,s){}roundRect(t,e,i,s,n){}createConicGradient(t,e,i){}createLinearGradient(t,e,i,s){}createPattern(t,e){}createRadialGradient(t,e,i,s,n,r){}fillText(t,e,i,s){}measureText(t){}strokeText(t,e,i,s){}destroy(){this.context=null}}Ft([Nt("imageSmoothingEnabled")],Ht.prototype,"smooth",void 0),Ft([Nt("imageSmoothingQuality")],Ht.prototype,"smoothLevel",void 0),Ft([Nt("globalAlpha")],Ht.prototype,"opacity",void 0),Ft([Nt()],Ht.prototype,"fillStyle",void 0),Ft([Nt()],Ht.prototype,"strokeStyle",void 0),Ft([Nt("lineWidth")],Ht.prototype,"strokeWidth",void 0),Ft([Nt("lineCap")],Ht.prototype,"strokeCap",void 0),Ft([Nt("lineJoin")],Ht.prototype,"strokeJoin",void 0),Ft([Nt("lineDashOffset")],Ht.prototype,"dashOffset",void 0),Ft([Nt()],Ht.prototype,"miterLimit",void 0),Ft([Nt()],Ht.prototype,"shadowBlur",void 0),Ft([Nt()],Ht.prototype,"shadowColor",void 0),Ft([Nt()],Ht.prototype,"shadowOffsetX",void 0),Ft([Nt()],Ht.prototype,"shadowOffsetY",void 0),Ft([Nt()],Ht.prototype,"filter",void 0),Ft([Nt()],Ht.prototype,"font",void 0),Ft([Nt()],Ht.prototype,"fontKerning",void 0),Ft([Nt()],Ht.prototype,"fontStretch",void 0),Ft([Nt()],Ht.prototype,"fontVariantCaps",void 0),Ft([Nt()],Ht.prototype,"textAlign",void 0),Ft([Nt()],Ht.prototype,"textBaseline",void 0),Ft([Nt()],Ht.prototype,"textRendering",void 0),Ft([Nt()],Ht.prototype,"wordSpacing",void 0),Ft([Nt()],Ht.prototype,"letterSpacing",void 0),Ft([Nt()],Ht.prototype,"direction",void 0),Ft([Yt()],Ht.prototype,"setTransform",null),Ft([Yt()],Ht.prototype,"resetTransform",null),Ft([Yt()],Ht.prototype,"getTransform",null),Ft([Yt()],Ht.prototype,"save",null),Ft([Yt()],Ht.prototype,"restore",null),Ft([Yt()],Ht.prototype,"translate",null),Ft([Yt()],Ht.prototype,"scale",null),Ft([Yt()],Ht.prototype,"rotate",null),Ft([Yt()],Ht.prototype,"fill",null),Ft([Yt()],Ht.prototype,"stroke",null),Ft([Yt()],Ht.prototype,"clip",null),Ft([Yt()],Ht.prototype,"fillRect",null),Ft([Yt()],Ht.prototype,"strokeRect",null),Ft([Yt()],Ht.prototype,"clearRect",null),Ft([Yt()],Ht.prototype,"beginPath",null),Ft([Yt()],Ht.prototype,"moveTo",null),Ft([Yt()],Ht.prototype,"lineTo",null),Ft([Yt()],Ht.prototype,"bezierCurveTo",null),Ft([Yt()],Ht.prototype,"quadraticCurveTo",null),Ft([Yt()],Ht.prototype,"closePath",null),Ft([Yt()],Ht.prototype,"arc",null),Ft([Yt()],Ht.prototype,"arcTo",null),Ft([Yt()],Ht.prototype,"ellipse",null),Ft([Yt()],Ht.prototype,"rect",null),Ft([Yt()],Ht.prototype,"roundRect",null),Ft([Yt()],Ht.prototype,"createConicGradient",null),Ft([Yt()],Ht.prototype,"createLinearGradient",null),Ft([Yt()],Ht.prototype,"createPattern",null),Ft([Yt()],Ht.prototype,"createRadialGradient",null),Ft([Yt()],Ht.prototype,"fillText",null),Ft([Yt()],Ht.prototype,"measureText",null),Ft([Yt()],Ht.prototype,"strokeText",null);const{copy:jt}=b,Vt={width:1,height:1,pixelRatio:1},Gt=["width","height","pixelRatio"];class Kt extends Ht{get width(){return this.size.width}get height(){return this.size.height}get pixelRatio(){return this.size.pixelRatio}get pixelWidth(){return this.width*this.pixelRatio}get pixelHeight(){return this.height*this.pixelRatio}get allowBackgroundColor(){return this.view&&this.parentView}constructor(t,i){super(),this.size={},this.worldTransform={},t||(t=Vt),t.pixelRatio||(t.pixelRatio=e.devicePixelRatio),this.manager=i,this.innerId=s.create(s.CNAVAS);const{width:n,height:r,pixelRatio:o}=t;this.autoLayout=!n||!r,this.size.pixelRatio=o,this.config=t,this.init()}init(){}__createContext(){const{view:t}=this,{contextSettings:e}=this.config;this.context=e?t.getContext("2d",e):t.getContext("2d"),this.__bindContext()}export(t,e){}toBlob(t,e){}toDataURL(t,e){}saveAs(t,e){}resize(t){if(this.isSameSize(t))return;let e;this.context&&!this.unreal&&this.width&&(e=this.getSameCanvas(),e.copyWorld(this)),Mt.copyAttrs(this.size,t,Gt),this.size.pixelRatio||(this.size.pixelRatio=1),this.bounds=new lt(0,0,this.width,this.height),this.context&&!this.unreal&&(this.updateViewSize(),this.smooth=this.config.smooth),this.updateClientBounds(),this.context&&!this.unreal&&e&&(this.clearWorld(e.bounds),this.copyWorld(e),e.recycle())}updateViewSize(){}updateClientBounds(){}getClientBounds(t){return t&&this.updateClientBounds(),this.clientBounds||this.bounds}startAutoLayout(t,e){}stopAutoLayout(){}setCursor(t){}setWorld(t,e){const{pixelRatio:i}=this,s=this.worldTransform;if(e){const{a:n,b:r,c:o,d:a,e:h,f:l}=e;this.setTransform(s.a=(t.a*n+t.b*o)*i,s.b=(t.a*r+t.b*a)*i,s.c=(t.c*n+t.d*o)*i,s.d=(t.c*r+t.d*a)*i,s.e=(t.e*n+t.f*o+h)*i,s.f=(t.e*r+t.f*a+l)*i)}else this.setTransform(s.a=t.a*i,s.b=t.b*i,s.c=t.c*i,s.d=t.d*i,s.e=t.e*i,s.f=t.f*i)}useWorldTransform(t){t&&(this.worldTransform=t);const e=this.worldTransform;e&&this.setTransform(e.a,e.b,e.c,e.d,e.e,e.f)}setStroke(t,e,i){e&&(this.strokeWidth=e),t&&(this.strokeStyle=t),i&&this.setStrokeOptions(i)}setStrokeOptions(t){this.strokeCap="none"===t.strokeCap?"butt":t.strokeCap,this.strokeJoin=t.strokeJoin,this.dashPattern=t.dashPattern,this.dashOffset=t.dashOffset,this.miterLimit=t.miterLimit}saveBlendMode(t){this.savedBlendMode=this.blendMode,this.blendMode=t}restoreBlendMode(){this.blendMode=this.savedBlendMode}hitFill(t,e){return!0}hitStroke(t,e){return!0}hitPixel(t,e,i=1){return!0}setWorldShadow(t,e,i,s){const{pixelRatio:n}=this;this.shadowOffsetX=t*n,this.shadowOffsetY=e*n,this.shadowBlur=i*n,this.shadowColor=s||"black"}setWorldBlur(t){const{pixelRatio:e}=this;this.filter=`blur(${t*e}px)`}copyWorld(t,e,i,s){if(s&&(this.blendMode=s),e){const{pixelRatio:s}=this;i||(i=e),this.drawImage(t.view,e.x*s,e.y*s,e.width*s,e.height*s,i.x*s,i.y*s,i.width*s,i.height*s)}else this.drawImage(t.view,0,0);s&&(this.blendMode="source-over")}copyWorldToInner(t,e,i,s){if(s&&(this.blendMode=s),e.b||e.c)this.save(),this.resetTransform(),this.copyWorld(t,e,rt.tempToOuterOf(i,e)),this.restore();else{const{pixelRatio:s}=this;this.drawImage(t.view,e.x*s,e.y*s,e.width*s,e.height*s,i.x,i.y,i.width,i.height)}s&&(this.blendMode="source-over")}copyWorldByReset(t,e,i,s,n){this.resetTransform(),this.copyWorld(t,e,i,s),n||this.useWorldTransform()}useMask(t,e,i){this.copyWorld(t,e,i,"destination-in")}useEraser(t,e,i){this.copyWorld(t,e,i,"destination-out")}fillWorld(t,e,i){i&&(this.blendMode=i),this.fillStyle=e,dt.set(t).scale(this.pixelRatio),this.fillRect(dt.x,dt.y,dt.width,dt.height),i&&(this.blendMode="source-over")}strokeWorld(t,e,i){i&&(this.blendMode=i),this.strokeStyle=e,dt.set(t).scale(this.pixelRatio),this.strokeRect(dt.x,dt.y,dt.width,dt.height),i&&(this.blendMode="source-over")}clearWorld(t,e){dt.set(t).scale(this.pixelRatio),e&&dt.ceil(),this.clearRect(dt.x,dt.y,dt.width,dt.height)}clipWorld(t,e){this.beginPath(),dt.set(t).scale(this.pixelRatio),e&&dt.ceil(),this.rect(dt.x,dt.y,dt.width,dt.height),this.clip()}clear(){const{pixelRatio:t}=this;this.clearRect(0,0,this.width*t+2,this.height*t+2)}isSameSize(t){return this.width===t.width&&this.height===t.height&&this.pixelRatio===t.pixelRatio}getSameCanvas(t,e){const s=this.manager?this.manager.get(this.size):i.canvas(Object.assign({},this.size));return s.save(),t&&(jt(s.worldTransform,this.worldTransform),s.useWorldTransform()),e&&(s.smooth=this.smooth),s}recycle(t){this.recycled||(this.restore(),t?this.clearWorld(t,!0):this.clear(),this.manager?this.manager.recycle(this):this.destroy())}updateRender(t){}unrealCanvas(){}destroy(){this.manager=this.view=this.parentView=null}}const qt={creator:{},parse(t,e){},convertToCanvasData(t,e){}},Zt={N:21,D:22,X:23,G:24,F:25,O:26,P:27,U:28},Qt=Object.assign({M:1,m:10,L:2,l:20,H:3,h:30,V:4,v:40,C:5,c:50,S:6,s:60,Q:7,q:70,T:8,t:80,A:9,a:90,Z:11,z:11,R:12},Zt),Jt={M:3,m:3,L:3,l:3,H:2,h:2,V:2,v:2,C:7,c:7,S:5,s:5,Q:5,q:5,T:3,t:3,A:8,a:8,Z:1,z:1,N:5,D:9,X:6,G:9,F:5,O:7,P:4,U:6},$t={m:10,l:20,H:3,h:30,V:4,v:40,c:50,S:6,s:60,q:70,T:8,t:80,A:9,a:90},te=Object.assign(Object.assign({},$t),Zt),ee=Qt,ie={};for(let t in ee)ie[ee[t]]=t;const se={};for(let t in ee)se[ee[t]]=Jt[t];const ne={drawRoundRect(t,e,i,s,n,r){const o=h.fourNumber(r,Math.min(s/2,n/2)),a=e+s,l=i+n;o[0]?t.moveTo(e+o[0],i):t.moveTo(e,i),o[1]?t.arcTo(a,i,a,l,o[1]):t.lineTo(a,i),o[2]?t.arcTo(a,l,e,l,o[2]):t.lineTo(a,l),o[3]?t.arcTo(e,l,e,i,o[3]):t.lineTo(e,l),o[0]?t.arcTo(e,i,a,i,o[0]):t.lineTo(e,i)}},{sin:re,cos:oe,atan2:ae,ceil:he,abs:le,PI:de,sqrt:ce,pow:ue}=Math,{setPoint:_e,addPoint:pe}=Y,{set:ge,toNumberPoints:fe}=D,{M:ye,L:ve,C:me,Q:we,Z:xe}=Qt,be={},Ee={points(t,e,i,s){let n=fe(e);if(t.push(ye,n[0],n[1]),i&&n.length>5){let e,r,o,a,h,l,d,c,u,_,p,g,f,y=n.length;const v=!0===i?.5:i;s&&(n=[n[y-2],n[y-1],...n,n[0],n[1],n[2],n[3]],y=n.length);for(let i=2;i<y-2;i+=2)e=n[i-2],r=n[i-1],o=n[i],a=n[i+1],h=n[i+2],l=n[i+3],p=ce(ue(o-e,2)+ue(a-r,2)),g=ce(ue(h-o,2)+ue(l-a,2)),f=p+g,p=v*p/f,g=v*g/f,h-=e,l-=r,d=o-p*h,c=a-p*l,2===i?s||t.push(we,d,c,o,a):t.push(me,u,_,d,c,o,a),u=o+g*h,_=a+g*l;s||t.push(we,u,_,n[y-2],n[y-1])}else for(let e=2,i=n.length;e<i;e+=2)t.push(ve,n[e],n[e+1]);s&&t.push(xe)},rect(t,e,i,s,n){qt.creator.path=t,qt.creator.moveTo(e,i).lineTo(e+s,i).lineTo(e+s,i+n).lineTo(e,i+n).lineTo(e,i)},roundRect(t,e,i,s,n,r){qt.creator.path=[],ne.drawRoundRect(qt.creator,e,i,s,n,r),t.push(...qt.convertToCanvasData(qt.creator.path,!0))},arcTo(t,e,i,s,n,r,o,a,h,u,_){const p=s-e,g=n-i,f=r-s,y=o-n;let v=ae(g,p),m=ae(y,f),w=m-v;if(w<0&&(w+=d),w===de||le(p+g)<1e-12||le(f+y)<1e-12)return t&&t.push(ve,s,n),h&&(_e(h,e,i),pe(h,s,n)),_&&ge(_,e,i),void(u&&ge(u,s,n));const x=p*y-f*g<0,b=x?-1:1,E=a/oe(w/2),B=s+E*oe(v+w/2+c*b),P=n+E*re(v+w/2+c*b);return v-=c*b,m-=c*b,Re(t,B,P,a,a,0,v/l,m/l,x,h,u,_)},arc:(t,e,i,s,n,r,o,a,h,l)=>Re(t,e,i,s,s,0,n,r,o,a,h,l),ellipse(t,e,i,s,n,r,o,a,h,u,_,p){const g=r*l,f=re(g),y=oe(g);let v=o*l,m=a*l;v>de&&(v-=d),m<0&&(m+=d);let w=m-v;w<0?w+=d:w>d&&(w-=d),h&&(w-=d);const x=he(le(w/c)),b=w/x,E=re(b/4),B=8/3*E*E/re(b/2);m=v+b;let P,R,C,T,k,L,S,O,D=oe(v),M=re(v),I=C=y*s*D-f*n*M,A=T=f*s*D+y*n*M,W=e+C,F=i+T;t&&t.push(t.length?ve:ye,W,F),u&&_e(u,W,F),p&&ge(p,W,F);for(let r=0;r<x;r++)P=oe(m),R=re(m),C=y*s*P-f*n*R,T=f*s*P+y*n*R,k=e+I-B*(y*s*M+f*n*D),L=i+A-B*(f*s*M-y*n*D),S=e+C+B*(y*s*R+f*n*P),O=i+T+B*(f*s*R-y*n*P),t&&t.push(me,k,L,S,O,e+C,i+T),u&&Pe(e+I,i+A,k,L,S,O,e+C,i+T,u,!0),I=C,A=T,D=P,M=R,v=m,m+=b;_&&ge(_,e+C,i+T)},quadraticCurveTo(t,e,i,s,n,r,o){t.push(me,(e+2*s)/3,(i+2*n)/3,(r+2*s)/3,(o+2*n)/3,r,o)},toTwoPointBoundsByQuadraticCurve(t,e,i,s,n,r,o,a){Pe(t,e,(t+2*i)/3,(e+2*s)/3,(n+2*i)/3,(r+2*s)/3,n,r,o,a)},toTwoPointBounds(t,e,i,s,n,r,o,a,h,l){const d=[];let c,u,_,p,g,f,y,v,m=t,w=i,x=n,b=o;for(let t=0;t<2;++t)if(1==t&&(m=e,w=s,x=r,b=a),c=-3*m+9*w-9*x+3*b,u=6*m-12*w+6*x,_=3*w-3*m,Math.abs(c)<1e-12){if(Math.abs(u)<1e-12)continue;p=-_/u,0<p&&p<1&&d.push(p)}else y=u*u-4*_*c,v=Math.sqrt(y),y<0||(g=(-u+v)/(2*c),0<g&&g<1&&d.push(g),f=(-u-v)/(2*c),0<f&&f<1&&d.push(f));l?pe(h,t,e):_e(h,t,e),pe(h,o,a);for(let l=0,c=d.length;l<c;l++)Be(d[l],t,e,i,s,n,r,o,a,be),pe(h,be.x,be.y)},getPointAndSet(t,e,i,s,n,r,o,a,h,l){const d=1-t,c=d*d*d,u=3*d*d*t,_=3*d*t*t,p=t*t*t;l.x=c*e+u*s+_*r+p*a,l.y=c*i+u*n+_*o+p*h},getPoint(t,e,i,s,n,r,o,a,h){const l={};return Be(t,e,i,s,n,r,o,a,h,l),l}},{getPointAndSet:Be,toTwoPointBounds:Pe,ellipse:Re}=Ee,{sin:Ce,cos:Te,sqrt:ke,atan2:Le}=Math,{ellipse:Se}=Ee,Oe={ellipticalArc(t,i,s,n,r,o,a,h,c,u,_){const p=(c-i)/2,g=(u-s)/2,f=o*l,y=Ce(f),v=Te(f),m=-v*p-y*g,w=-v*g+y*p,x=n*n,b=r*r,E=w*w,B=m*m,P=x*b-x*E-b*B;let R=0;if(P<0){const t=ke(1-P/(x*b));n*=t,r*=t}else R=(a===h?-1:1)*ke(P/(x*E+b*B));const C=R*n*w/r,T=-R*r*m/n,k=Le((w-T)/r,(m-C)/n),L=Le((-w-T)/r,(-m-C)/n);let S=L-k;0===h&&S>0?S-=d:1===h&&S<0&&(S+=d);const O=i+p+v*C-y*T,D=s+g+y*C+v*T,M=S<0?1:0;_||e.ellipseToCurve?Se(t,O,D,n,r,o,k/l,L/l,M):n!==r||o?t.push(Qt.G,O,D,n,r,o,k/l,L/l,M):t.push(Qt.O,O,D,n,k/l,L/l,M)}},{M:De,m:Me,L:Ie,l:Ae,H:We,h:Fe,V:ze,v:Ne,C:Ue,c:Ye,S:Xe,s:He,Q:je,q:Ve,T:Ge,t:Ke,A:qe,a:Ze,Z:Qe,z:Je,N:$e,D:ti,X:ei,G:ii,F:si,O:ni,P:ri,U:oi}=Qt,{rect:ai,roundRect:hi,arcTo:li,arc:di,ellipse:ci,quadraticCurveTo:ui}=Ee,{ellipticalArc:_i}=Oe,pi=wt.get("PathConvert"),gi={},fi={current:{dot:0},stringify(t,e){let i,s,n,r=0,o=t.length,a="";for(;r<o;){s=t[r],i=se[s],a+=s===n?" ":ie[s];for(let s=1;s<i;s++)a+=h.float(t[r+s],e),s===i-1||(a+=" ");n=s,r+=i}return a},parse(t,e){let i,s,n,r="";const o=[],a=e?te:$t;for(let e=0,h=t.length;e<h;e++)s=t[e],mt[s]?("."===s&&(yi.dot&&(vi(o,r),r=""),yi.dot++),"0"===r&&"."!==s&&(vi(o,r),r=""),r+=s):Qt[s]?(r&&(vi(o,r),r=""),yi.name=Qt[s],yi.length=Jt[s],yi.index=0,vi(o,yi.name),!i&&a[s]&&(i=!0)):"-"===s||"+"===s?"e"===n||"E"===n?r+=s:(r&&vi(o,r),r=s):r&&(vi(o,r),r=""),n=s;return r&&vi(o,r),i?fi.toCanvasData(o,e):o},toCanvasData(t,e){let i,s,n,r,o,a=0,h=0,l=0,d=0,c=0,u=t.length;const _=[];for(;c<u;){switch(n=t[c],n){case Me:t[c+1]+=a,t[c+2]+=h;case De:a=t[c+1],h=t[c+2],_.push(De,a,h),c+=3;break;case Fe:t[c+1]+=a;case We:a=t[c+1],_.push(Ie,a,h),c+=2;break;case Ne:t[c+1]+=h;case ze:h=t[c+1],_.push(Ie,a,h),c+=2;break;case Ae:t[c+1]+=a,t[c+2]+=h;case Ie:a=t[c+1],h=t[c+2],_.push(Ie,a,h),c+=3;break;case He:t[c+1]+=a,t[c+2]+=h,t[c+3]+=a,t[c+4]+=h,n=Xe;case Xe:o=r===Ue||r===Xe,l=o?2*a-i:t[c+1],d=o?2*h-s:t[c+2],i=t[c+1],s=t[c+2],a=t[c+3],h=t[c+4],_.push(Ue,l,d,i,s,a,h),c+=5;break;case Ye:t[c+1]+=a,t[c+2]+=h,t[c+3]+=a,t[c+4]+=h,t[c+5]+=a,t[c+6]+=h,n=Ue;case Ue:i=t[c+3],s=t[c+4],a=t[c+5],h=t[c+6],_.push(Ue,t[c+1],t[c+2],i,s,a,h),c+=7;break;case Ke:t[c+1]+=a,t[c+2]+=h,n=Ge;case Ge:o=r===je||r===Ge,i=o?2*a-i:t[c+1],s=o?2*h-s:t[c+2],e?ui(_,a,h,i,s,t[c+1],t[c+2]):_.push(je,i,s,t[c+1],t[c+2]),a=t[c+1],h=t[c+2],c+=3;break;case Ve:t[c+1]+=a,t[c+2]+=h,t[c+3]+=a,t[c+4]+=h,n=je;case je:i=t[c+1],s=t[c+2],e?ui(_,a,h,i,s,t[c+3],t[c+4]):_.push(je,i,s,t[c+3],t[c+4]),a=t[c+3],h=t[c+4],c+=5;break;case Ze:t[c+6]+=a,t[c+7]+=h;case qe:_i(_,a,h,t[c+1],t[c+2],t[c+3],t[c+4],t[c+5],t[c+6],t[c+7],e),a=t[c+6],h=t[c+7],c+=8;break;case Je:case Qe:_.push(Qe),c++;break;case $e:a=t[c+1],h=t[c+2],e?ai(_,a,h,t[c+3],t[c+4]):mi(_,t,c,5),c+=5;break;case ti:a=t[c+1],h=t[c+2],e?hi(_,a,h,t[c+3],t[c+4],[t[c+5],t[c+6],t[c+7],t[c+8]]):mi(_,t,c,9),c+=9;break;case ei:a=t[c+1],h=t[c+2],e?hi(_,a,h,t[c+3],t[c+4],t[c+5]):mi(_,t,c,6),c+=6;break;case ii:ci(e?_:mi(_,t,c,9),t[c+1],t[c+2],t[c+3],t[c+4],t[c+5],t[c+6],t[c+7],t[c+8],null,gi),a=gi.x,h=gi.y,c+=9;break;case si:e?ci(_,t[c+1],t[c+2],t[c+3],t[c+4],0,0,360,!1):mi(_,t,c,5),a=t[c+1]+t[c+3],h=t[c+2],c+=5;break;case ni:di(e?_:mi(_,t,c,7),t[c+1],t[c+2],t[c+3],t[c+4],t[c+5],t[c+6],null,gi),a=gi.x,h=gi.y,c+=7;break;case ri:e?di(_,t[c+1],t[c+2],t[c+3],0,360,!1):mi(_,t,c,4),a=t[c+1]+t[c+3],h=t[c+2],c+=4;break;case oi:li(e?_:mi(_,t,c,6),a,h,t[c+1],t[c+2],t[c+3],t[c+4],t[c+5],null,gi),a=gi.x,h=gi.y,c+=6;break;default:return pi.error(`command: ${n} [index:${c}]`,t),_}r=n}return _},objectToCanvasData(t){const e=[];return t.forEach((t=>{switch(t.name){case"M":e.push(De,t.x,t.y);break;case"L":e.push(Ie,t.x,t.y);break;case"C":e.push(Ue,t.x1,t.y1,t.x2,t.y2,t.x,t.y);break;case"Q":e.push(je,t.x1,t.y1,t.x,t.y);break;case"Z":e.push(Qe)}})),e},copyData(t,e,i,s){for(let n=i,r=i+s;n<r;n++)t.push(e[n])},pushData(t,e){yi.index===yi.length&&(yi.index=1,t.push(yi.name)),t.push(Number(e)),yi.index++,yi.dot=0}},{current:yi,pushData:vi,copyData:mi}=fi,{M:wi,L:xi,C:bi,Q:Ei,Z:Bi,N:Pi,D:Ri,X:Ci,G:Ti,F:ki,O:Li,P:Si,U:Oi}=Qt,{getMinDistanceFrom:Di,getRadianFrom:Mi}=D,{tan:Ii,min:Ai,abs:Wi}=Math,Fi={},zi={beginPath(t){t.length=0},moveTo(t,e,i){t.push(wi,e,i)},lineTo(t,e,i){t.push(xi,e,i)},bezierCurveTo(t,e,i,s,n,r,o){t.push(bi,e,i,s,n,r,o)},quadraticCurveTo(t,e,i,s,n){t.push(Ei,e,i,s,n)},closePath(t){t.push(Bi)},rect(t,e,i,s,n){t.push(Pi,e,i,s,n)},roundRect(t,e,i,s,n,r){if("number"==typeof r)t.push(Ci,e,i,s,n,r);else{const o=h.fourNumber(r);o?t.push(Ri,e,i,s,n,...o):t.push(Pi,e,i,s,n)}},ellipse(t,e,i,s,n,r,o,a,h){void 0===r?t.push(ki,e,i,s,n):(void 0===o&&(o=0),void 0===a&&(a=360),t.push(Ti,e,i,s,n,r,o,a,h?1:0))},arc(t,e,i,s,n,r,o){void 0===n?t.push(Si,e,i,s):(void 0===r&&(r=360),t.push(Li,e,i,s,n,r,o?1:0))},arcTo(t,e,i,s,n,r,o,a){if(void 0!==o){const h=Ii(Mi(o,a,e,i,s,n)/2)*(Di(o,a,e,i,s,n)/2);t.push(Oi,e,i,s,n,Ai(r,Wi(h)))}else t.push(Oi,e,i,s,n,r)},drawEllipse(t,e,i,s,n,r,o,a,h){Ee.ellipse(null,e,i,s,n,void 0===r?0:r,void 0===o?0:o,void 0===a?360:a,h,null,null,Fi),t.push(wi,Fi.x,Fi.y),Ni(t,e,i,s,n,r,o,a,h)},drawArc(t,e,i,s,n,r,o){Ee.arc(null,e,i,s,void 0===n?0:n,void 0===r?360:r,o,null,null,Fi),t.push(wi,Fi.x,Fi.y),Ui(t,e,i,s,n,r,o)},drawPoints(t,e,i,s){Ee.points(t,e,i,s)}},{ellipse:Ni,arc:Ui}=zi,{moveTo:Yi,lineTo:Xi,quadraticCurveTo:Hi,bezierCurveTo:ji,closePath:Vi,beginPath:Gi,rect:Ki,roundRect:qi,ellipse:Zi,arc:Qi,arcTo:Ji,drawEllipse:$i,drawArc:ts,drawPoints:es}=zi;class is{set path(t){this.__path=t}get path(){return this.__path}constructor(t){this.set(t)}set(t){return this.__path=t?"string"==typeof t?qt.parse(t):t:[],this}beginPath(){return Gi(this.__path),this.paint(),this}moveTo(t,e){return Yi(this.__path,t,e),this.paint(),this}lineTo(t,e){return Xi(this.__path,t,e),this.paint(),this}bezierCurveTo(t,e,i,s,n,r){return ji(this.__path,t,e,i,s,n,r),this.paint(),this}quadraticCurveTo(t,e,i,s){return Hi(this.__path,t,e,i,s),this.paint(),this}closePath(){return Vi(this.__path),this.paint(),this}rect(t,e,i,s){return Ki(this.__path,t,e,i,s),this.paint(),this}roundRect(t,e,i,s,n){return qi(this.__path,t,e,i,s,n),this.paint(),this}ellipse(t,e,i,s,n,r,o,a){return Zi(this.__path,t,e,i,s,n,r,o,a),this.paint(),this}arc(t,e,i,s,n,r){return Qi(this.__path,t,e,i,s,n,r),this.paint(),this}arcTo(t,e,i,s,n){return Ji(this.__path,t,e,i,s,n),this.paint(),this}drawEllipse(t,e,i,s,n,r,o,a){return $i(this.__path,t,e,i,s,n,r,o,a),this.paint(),this}drawArc(t,e,i,s,n,r){return ts(this.__path,t,e,i,s,n,r),this.paint(),this}drawPoints(t,e,i){return es(this.__path,t,e,i),this.paint(),this}clearPath(){return this.beginPath()}paint(){}}const{M:ss,L:ns,C:rs,Q:os,Z:as,N:hs,D:ls,X:ds,G:cs,F:us,O:_s,P:ps,U:gs}=Qt,fs=wt.get("PathDrawer"),ys={drawPathByData(t,e){if(!e)return;let i,s=0,n=e.length;for(;s<n;)switch(i=e[s],i){case ss:t.moveTo(e[s+1],e[s+2]),s+=3;break;case ns:t.lineTo(e[s+1],e[s+2]),s+=3;break;case rs:t.bezierCurveTo(e[s+1],e[s+2],e[s+3],e[s+4],e[s+5],e[s+6]),s+=7;break;case os:t.quadraticCurveTo(e[s+1],e[s+2],e[s+3],e[s+4]),s+=5;break;case as:t.closePath(),s+=1;break;case hs:t.rect(e[s+1],e[s+2],e[s+3],e[s+4]),s+=5;break;case ls:t.roundRect(e[s+1],e[s+2],e[s+3],e[s+4],[e[s+5],e[s+6],e[s+7],e[s+8]]),s+=9;break;case ds:t.roundRect(e[s+1],e[s+2],e[s+3],e[s+4],e[s+5]),s+=6;break;case cs:t.ellipse(e[s+1],e[s+2],e[s+3],e[s+4],e[s+5]*l,e[s+6]*l,e[s+7]*l,e[s+8]),s+=9;break;case us:t.ellipse(e[s+1],e[s+2],e[s+3],e[s+4],0,0,d,!1),s+=5;break;case _s:t.arc(e[s+1],e[s+2],e[s+3],e[s+4]*l,e[s+5]*l,e[s+6]),s+=7;break;case ps:t.arc(e[s+1],e[s+2],e[s+3],0,d,!1),s+=4;break;case gs:t.arcTo(e[s+1],e[s+2],e[s+3],e[s+4],e[s+5]),s+=6;break;default:return void fs.error(`command: ${i} [index:${s}]`,e)}}},{M:vs,L:ms,C:ws,Q:xs,Z:bs,N:Es,D:Bs,X:Ps,G:Rs,F:Cs,O:Ts,P:ks,U:Ls}=Qt,{toTwoPointBounds:Ss,toTwoPointBoundsByQuadraticCurve:Os,arcTo:Ds,arc:Ms,ellipse:Is}=Ee,{addPointBounds:As,copy:Ws,addPoint:Fs,setPoint:zs,addBounds:Ns,toBounds:Us}=Y,Ys=wt.get("PathBounds");let Xs,Hs,js;const Vs={},Gs={},Ks={},qs={toBounds(t,e){qs.toTwoPointBounds(t,Gs),Us(Gs,e)},toTwoPointBounds(t,e){if(!t||!t.length)return zs(e,0,0);let i,s,n,r,o,a=0,h=0,l=0;const d=t.length;for(;a<d;)switch(o=t[a],0===a&&(o===bs||o===ws||o===xs?zs(e,h,l):zs(e,t[a+1],t[a+2])),o){case vs:case ms:h=t[a+1],l=t[a+2],Fs(e,h,l),a+=3;break;case ws:n=t[a+5],r=t[a+6],Ss(h,l,t[a+1],t[a+2],t[a+3],t[a+4],n,r,Vs),As(e,Vs),h=n,l=r,a+=7;break;case xs:i=t[a+1],s=t[a+2],n=t[a+3],r=t[a+4],Os(h,l,i,s,n,r,Vs),As(e,Vs),h=n,l=r,a+=5;break;case bs:a+=1;break;case Es:h=t[a+1],l=t[a+2],Ns(e,h,l,t[a+3],t[a+4]),a+=5;break;case Bs:case Ps:h=t[a+1],l=t[a+2],Ns(e,h,l,t[a+3],t[a+4]),a+=o===Bs?9:6;break;case Rs:Is(null,t[a+1],t[a+2],t[a+3],t[a+4],t[a+5],t[a+6],t[a+7],t[a+8],Vs,Ks),0===a?Ws(e,Vs):As(e,Vs),h=Ks.x,l=Ks.y,a+=9;break;case Cs:h=t[a+1],l=t[a+2],Hs=t[a+3],js=t[a+4],Ns(e,h-Hs,l-js,2*Hs,2*js),h+=Hs,a+=5;break;case Ts:Ms(null,t[a+1],t[a+2],t[a+3],t[a+4],t[a+5],t[a+6],Vs,Ks),0===a?Ws(e,Vs):As(e,Vs),h=Ks.x,l=Ks.y,a+=7;break;case ks:h=t[a+1],l=t[a+2],Xs=t[a+3],Ns(e,h-Xs,l-Xs,2*Xs,2*Xs),h+=Xs,a+=4;break;case Ls:Ds(null,h,l,t[a+1],t[a+2],t[a+3],t[a+4],t[a+5],Vs,Ks),0===a?Ws(e,Vs):As(e,Vs),h=Ks.x,l=Ks.y,a+=6;break;default:return void Ys.error(`command: ${o} [index:${a}]`,t)}}},{M:Zs,L:Qs,C:Js,Z:$s}=Qt,{getCenterX:tn,getCenterY:en}=D,{arcTo:sn}=zi,nn={smooth(t,e,i){let s,n=0,r=0,o=0,a=0,h=0,l=0,d=0,c=0,u=0;const _=t.length,p=[];for(;n<_;)switch(s=t[n],s){case Zs:a=c=t[n+1],h=u=t[n+2],n+=3,t[n]===Qs?(l=t[n+1],d=t[n+2],p.push(Zs,tn(a,l),en(h,d))):p.push(Zs,a,h);break;case Qs:switch(r=t[n+1],o=t[n+2],n+=3,t[n]){case Qs:sn(p,r,o,t[n+1],t[n+2],e,c,u);break;case $s:sn(p,r,o,a,h,e,c,u);break;default:p.push(Qs,r,o)}c=r,u=o;break;case Js:p.push(Js,t[n+1],t[n+2],t[n+3],t[n+4],t[n+5],t[n+6]),n+=7;break;case $s:sn(p,a,h,l,d,e,c,u),p.push($s),n+=1}return s!==$s&&(p[1]=a,p[2]=h),p}};qt.creator=new is,qt.parse=fi.parse,qt.convertToCanvasData=fi.toCanvasData;const rn=new is,{drawRoundRect:on}=ne;function an(t){!function(t){t&&!t.roundRect&&(t.roundRect=function(t,e,i,s,n){on(this,t,e,i,s,n)})}(t)}const hn={opacityTypes:["png","webp","svg"],upperCaseTypeMap:{},mineType:t=>!t||t.startsWith("image")?t:("jpg"===t&&(t="jpeg"),"image/"+t),fileType(t){const e=t.split(".");return e[e.length-1]},isOpaqueImage(t){const e=ln.fileType(t);return["jpg","jpeg"].some((t=>t===e))},getExportOptions(t){switch(typeof t){case"object":return t;case"number":return{quality:t};case"boolean":return{blob:t};default:return{}}}},ln=hn;ln.opacityTypes.forEach((t=>ln.upperCaseTypeMap[t]=t.toUpperCase()));const dn=wt.get("TaskProcessor");class cn{constructor(t){this.parallel=!0,this.time=1,this.id=s.create(s.TASK),this.task=t}run(){return zt(this,void 0,void 0,(function*(){try{this.task&&!this.isComplete&&this.parent.running&&(yield this.task())}catch(t){dn.error(t)}}))}complete(){this.isComplete=!0,this.parent=null,this.task=null}cancel(){this.isCancel=!0,this.complete()}}class un{get total(){return this.list.length+this.delayNumber}get finishedIndex(){return this.isComplete?0:this.index+this.parallelSuccessNumber}get remain(){return this.isComplete?this.total:this.total-this.finishedIndex}get percent(){const{total:t}=this;let e=0,i=0;for(let s=0;s<t;s++)s<=this.finishedIndex?(i+=this.list[s].time,s===this.finishedIndex&&(e=i)):e+=this.list[s].time;return this.isComplete?1:i/e}constructor(t){this.config={parallel:6},this.list=[],this.running=!1,this.isComplete=!0,this.index=0,this.delayNumber=0,t&&Mt.assign(this.config,t),this.empty()}add(t,e){let i,s,n,r;const o=new cn(t);return o.parent=this,"number"==typeof e?r=e:e&&(s=e.parallel,i=e.start,n=e.time,r=e.delay),n&&(o.time=n),!1===s&&(o.parallel=!1),void 0===r?this.push(o,i):(this.delayNumber++,setTimeout((()=>{this.delayNumber&&(this.delayNumber--,this.push(o,i))}),r)),this.isComplete=!1,o}push(t,e){this.list.push(t),!1===e||this.timer||(this.timer=setTimeout((()=>this.start())))}empty(){this.index=0,this.parallelSuccessNumber=0,this.list=[],this.parallelList=[],this.delayNumber=0}start(){this.running||(this.running=!0,this.isComplete=!1,this.run())}pause(){clearTimeout(this.timer),this.timer=null,this.running=!1}resume(){this.start()}skip(){this.index++,this.resume()}stop(){this.isComplete=!0,this.list.forEach((t=>{t.isComplete||t.cancel()})),this.pause(),this.empty()}run(){this.running&&(this.setParallelList(),this.parallelList.length>1?this.runParallelTasks():this.remain?this.runTask():this.onComplete())}runTask(){const t=this.list[this.index];t?t.run().then((()=>{this.onTask(t),this.index++,this.nextTask()})).catch((t=>{this.onError(t)})):this.nextTask()}runParallelTasks(){this.parallelList.forEach((t=>this.runParallelTask(t)))}runParallelTask(t){t.run().then((()=>{this.onTask(t),this.fillParallelTask()})).catch((t=>{this.onParallelError(t)}))}nextTask(){this.total===this.finishedIndex?this.onComplete():this.timer=setTimeout((()=>this.run()))}setParallelList(){let t;this.parallelList=[],this.parallelSuccessNumber=0;let e=this.index+this.config.parallel;e>this.list.length&&(e=this.list.length);for(let i=this.index;i<e&&(t=this.list[i],t.parallel);i++)this.parallelList.push(t)}fillParallelTask(){let t;const e=this.parallelList;this.parallelSuccessNumber++,e.pop();const i=e.length,s=this.finishedIndex+i;if(e.length){if(!this.running)return;s<this.total&&(t=this.list[s],t&&t.parallel&&(e.push(t),this.runParallelTask(t)))}else this.index+=this.parallelSuccessNumber,this.parallelSuccessNumber=0,this.nextTask()}onComplete(){this.stop(),this.config.onComplete&&this.config.onComplete()}onTask(t){t.complete(),this.config.onTask&&this.config.onTask()}onParallelError(t){this.parallelList.forEach((t=>{t.parallel=!1})),this.parallelList.length=0,this.parallelSuccessNumber=0,this.onError(t)}onError(t){this.pause(),this.config.onError&&this.config.onError(t)}destroy(){this.stop()}}const _n={map:{},recycledList:[],tasker:new un,patternTasker:new un,get isComplete(){return pn.tasker.isComplete},get(t){let e=pn.map[t.url];return e||(e=i.image(t),pn.map[t.url]=e),e.use++,e},recycle(t){t.use--,setTimeout((()=>{t.use||pn.recycledList.push(t)}))},clearRecycled(){const t=pn.recycledList;t.length>100&&(t.forEach((t=>{!t.use&&t.url&&(delete pn.map[t.url],t.destroy())})),t.length=0)},hasOpacityPixel:t=>hn.opacityTypes.some((e=>pn.isFormat(e,t))),isFormat(t,e){if(e.format===t)return!0;const{url:i}=e;if(i.startsWith("data:")){if(i.startsWith("data:"+hn.mineType(t)))return!0}else{if(i.includes("."+t)||i.includes("."+hn.upperCaseTypeMap[t]))return!0;if("png"===t&&!i.includes("."))return!0}return!1},destroy(){pn.map={},pn.recycledList=[]}},pn=_n,{IMAGE:gn,create:fn}=s;class yn{get url(){return this.config.url}get completed(){return this.ready||!!this.error}constructor(t){this.use=0,this.waitComplete=[],this.innerId=fn(gn),this.config=t||{url:""},this.isSVG=_n.isFormat("svg",t),this.hasOpacityPixel=_n.hasOpacityPixel(t)}load(t,i){return this.loading||(this.loading=!0,_n.tasker.add((()=>zt(this,void 0,void 0,(function*(){return yield e.origin.loadImage(this.url).then((t=>{this.ready=!0,this.width=t.naturalWidth||t.width,this.height=t.naturalHeight||t.height,this.view=t,this.onComplete(!0)})).catch((t=>{this.error=t,this.onComplete(!1)}))}))))),this.waitComplete.push(t,i),this.waitComplete.length-2}unload(t,e){const i=this.waitComplete;if(e){const e=i[t+1];e&&e({type:"stop"})}i[t]=i[t+1]=void 0}onComplete(t){let e;this.waitComplete.forEach(((i,s)=>{e=s%2,i&&(t?e||i(this):e&&i(this.error))})),this.waitComplete.length=0,this.loading=!1}getCanvas(t,i,s,n){if(t||(t=this.width),i||(i=this.height),this.cache){let{params:t,data:e}=this.cache;for(let i in t)if(t[i]!==arguments[i]){e=null;break}if(e)return e}const r=e.origin.createCanvas(t,i),o=r.getContext("2d");return s&&(o.globalAlpha=s),o.drawImage(this.view,0,0,t,i),this.cache=this.use>1?{data:r,params:arguments}:null,r}getPattern(t,i,s,n){const r=e.canvas.createPattern(t,i);try{s&&r.setTransform&&(r.setTransform(s),s=null)}catch(t){}return n&&(n.transform=s),r}destroy(){this.config={url:""},this.cache=null,this.waitComplete.length=0}}function vn(t,e,i,s){s||(i.configurable=i.enumerable=!0),Object.defineProperty(t,e,i)}function mn(t,e){return Object.getOwnPropertyDescriptor(t,e)}function wn(t,e){return(i,s)=>bn(i,s,t,e&&e(s))}function xn(t){return t}function bn(t,e,i,s){const n={get(){return this.__getAttr(e)},set(t){this.__setAttr(e,t)}};vn(t,e,Object.assign(n,s||{})),Gn(t,e,i)}function En(t){return wn(t)}function Bn(t,e){return wn(t,(t=>({set(i){this.__setAttr(t,i,e)&&(this.__layout.matrixChanged||this.__layout.matrixChange())}})))}function Pn(t){return wn(t,(t=>({set(e){this.__setAttr(t,e)&&(this.__layout.matrixChanged||this.__layout.matrixChange(),this.__hasAutoLayout=!!(this.origin||this.around||this.flow),this.__local||this.__layout.createLocal())}})))}function Rn(t,e){return wn(t,(t=>({set(i){this.__setAttr(t,i,e)&&(this.__layout.scaleChanged||this.__layout.scaleChange())}})))}function Cn(t,e){return wn(t,(t=>({set(i){this.__setAttr(t,i,e)&&(this.__layout.rotationChanged||this.__layout.rotationChange())}})))}function Tn(t,e){return wn(t,(t=>({set(i){this.__setAttr(t,i,e)&&Ln(this)}})))}function kn(t){return wn(t,(t=>({set(e){this.__setAttr(t,e)&&(Ln(this),this.__.__removeNaturalSize())}})))}function Ln(t){t.__layout.boxChanged||t.__layout.boxChange(),t.__hasAutoLayout&&(t.__layout.matrixChanged||t.__layout.matrixChange())}function Sn(t){return wn(t,(t=>({set(e){const i=this.__;2!==i.__pathInputed&&(i.__pathInputed=e?1:0),e||(i.__pathForRender=void 0),this.__setAttr(t,e),Ln(this)}})))}const On=Tn;function Dn(t){return wn(t,(t=>({set(e){this.__setAttr(t,e)&&Mn(this)}})))}function Mn(t){t.__layout.strokeChanged||t.__layout.strokeChange(),t.__.__useArrow&&Ln(t)}const In=Dn;function An(t){return wn(t,(t=>({set(e){this.__setAttr(t,e),this.__layout.renderChanged||this.__layout.renderChange()}})))}function Wn(t){return wn(t,(t=>({set(e){this.__setAttr(t,e)&&(this.__layout.surfaceChanged||this.__layout.surfaceChange())}})))}function Fn(t){return wn(t,(t=>({set(e){this.__setAttr(t,e)&&(this.__layout.opacityChanged||this.__layout.opacityChange())}})))}function zn(t){return wn(t,(t=>({set(e){const i=this.visible;if(!0===i&&0===e){if(this.animationOut)return this.__runAnimation("out",(()=>Nn(this,t,e,i)))}else 0===i&&!0===e&&this.animation&&this.__runAnimation("in");Nn(this,t,e,i)}})))}function Nn(t,e,i,s){t.__setAttr(e,i)&&(t.__layout.opacityChanged||t.__layout.opacityChange(),0!==s&&0!==i||Ln(t))}function Un(t){return wn(t,(t=>({set(e){this.__setAttr(t,e)&&(this.__layout.surfaceChanged||this.__layout.surfaceChange(),this.waitParent((()=>{this.parent.__layout.childrenSortChange()})))}})))}function Yn(t){return wn(t,(t=>({set(e){this.__setAttr(t,e)&&(this.__layout.boxChanged||this.__layout.boxChange(),this.waitParent((()=>{this.parent.__updateMask(e)})))}})))}function Xn(t){return wn(t,(t=>({set(e){this.__setAttr(t,e)&&this.waitParent((()=>{this.parent.__updateEraser(e)}))}})))}function Hn(t){return wn(t,(t=>({set(e){this.__setAttr(t,e)&&(this.__layout.hitCanvasChanged=!0,wt.showHitView&&(this.__layout.surfaceChanged||this.__layout.surfaceChange()),this.leafer&&this.leafer.updateCursor())}})))}function jn(t){return wn(t,(t=>({set(e){this.__setAttr(t,e),this.leafer&&this.leafer.updateCursor()}})))}function Vn(t){return(e,i)=>{vn(e,"__DataProcessor",{get:()=>t})}}function Gn(t,e,i){const s=t.__DataProcessor.prototype,n="_"+e,r=function(t){return"set"+t.charAt(0).toUpperCase()+t.slice(1)}(e),o={get(){const t=this[n];return void 0===t?i:t},set(t){this[n]=t}};if(void 0===i)o.get=function(){return this[n]};else if("object"==typeof i){const{clone:t}=Mt;o.get=function(){let e=this[n];return void 0===e&&(this[n]=e=t(i)),e}}"width"===e?o.get=function(){const t=this[n];if(void 0===t){const t=this;return t._height&&t.__naturalWidth&&t.__useNaturalRatio?t._height*t.__naturalWidth/t.__naturalHeight:t.__naturalWidth||i}return t}:"height"===e&&(o.get=function(){const t=this[n];if(void 0===t){const t=this;return t._width&&t.__naturalHeight&&t.__useNaturalRatio?t._width*t.__naturalHeight/t.__naturalWidth:t.__naturalHeight||i}return t});let a,h=s;for(;!a&&h;)a=mn(h,e),h=h.__proto__;a&&a.set&&(o.set=a.set),s[r]&&(o.set=s[r],delete s[r]),vn(s,e,o)}const Kn=new wt("rewrite"),qn=[],Zn=["destroy","constructor"];function Qn(t){return(e,i)=>{qn.push({name:e.constructor.name+"."+i,run:()=>{e[i]=t}})}}function Jn(){return t=>{$n()}}function $n(t){qn.length&&(qn.forEach((e=>{t&&Kn.error(e.name,"需在Class上装饰@rewriteAble()"),e.run()})),qn.length=0)}function tr(t,e){return i=>{var s;(t.prototype?(s=t.prototype,Object.getOwnPropertyNames(s)):Object.keys(t)).forEach((s=>{if(!(Zn.includes(s)||e&&e.includes(s)))if(t.prototype){mn(t.prototype,s).writable&&(i.prototype[s]=t.prototype[s])}else i.prototype[s]=t[s]}))}}function er(){return t=>{Tt.register(t)}}function ir(){return t=>{St.register(t)}}setTimeout((()=>$n(!0)));const{copy:sr,toInnerPoint:nr,toOuterPoint:rr,scaleOfOuter:or,rotateOfOuter:ar,skewOfOuter:hr,multiplyParent:lr,divideParent:dr,getLayout:cr}=b,ur={},_r={updateAllMatrix(t,e,i){if(e&&t.__hasAutoLayout&&t.__layout.matrixChanged&&(i=!0),fr(t,e,i),t.isBranch){const{children:s}=t;for(let t=0,n=s.length;t<n;t++)gr(s[t],e,i)}},updateMatrix(t,e,i){const s=t.__layout;e?i&&(s.waitAutoLayout=!0,t.__hasAutoLayout&&(s.matrixChanged=!1)):s.waitAutoLayout&&(s.waitAutoLayout=!1),s.matrixChanged&&t.__updateLocalMatrix(),s.waitAutoLayout||t.__updateWorldMatrix()},updateBounds(t){const e=t.__layout;e.boundsChanged&&t.__updateLocalBounds(),e.waitAutoLayout||t.__updateWorldBounds()},updateAllWorldOpacity(t){if(t.__updateWorldOpacity(),t.isBranch){const{children:e}=t;for(let t=0,i=e.length;t<i;t++)yr(e[t])}},updateAllChange(t){if(yr(t),t.__updateChange(),t.isBranch){const{children:e}=t;for(let t=0,i=e.length;t<i;t++)vr(e[t])}},worldHittable(t){for(;t;){if(!t.__.hittable)return!1;t=t.parent}return!0},moveWorld(t,e,i=0,s){const n="object"==typeof e?Object.assign({},e):{x:e,y:i};s?rr(t.localTransform,n,n,!0):t.parent&&nr(t.parent.worldTransform,n,n,!0),pr.moveLocal(t,n.x,n.y)},moveLocal(t,e,i=0){"object"==typeof e?(t.x+=e.x,t.y+=e.y):(t.x+=e,t.y+=i)},zoomOfWorld(t,e,i,s,n){pr.zoomOfLocal(t,wr(t,e),i,s,n)},zoomOfLocal(t,e,i,s=i,n){sr(ur,t.__localMatrix),or(ur,e,i,s),t.origin||t.around?pr.setTransform(t,ur,n):(mr(t,ur),t.scaleResize(i,s,!0!==n))},rotateOfWorld(t,e,i){pr.rotateOfLocal(t,wr(t,e),i)},rotateOfLocal(t,e,i){sr(ur,t.__localMatrix),ar(ur,e,i),t.origin||t.around?pr.setTransform(t,ur):(mr(t,ur),t.rotation=h.formatRotation(t.rotation+i))},skewOfWorld(t,e,i,s,n){pr.skewOfLocal(t,wr(t,e),i,s,n)},skewOfLocal(t,e,i,s=0,n){sr(ur,t.__localMatrix),hr(ur,e,i,s),pr.setTransform(t,ur,n)},transformWorld(t,e,i){sr(ur,t.worldTransform),lr(ur,e),t.parent&&dr(ur,t.parent.worldTransform),pr.setTransform(t,ur,i)},transform(t,e,i){sr(ur,t.localTransform),lr(ur,e),pr.setTransform(t,ur,i)},setTransform(t,e,i){const s=cr(e,t.origin&&pr.getInnerOrigin(t,t.origin),t.around&&pr.getInnerOrigin(t,t.around));if(i){const e=s.scaleX/t.scaleX,n=s.scaleY/t.scaleY;delete s.scaleX,delete s.scaleY,t.set(s),t.scaleResize(e,n,!0!==i)}else t.set(s)},getFlipTransform(t,e){const i={a:1,b:0,c:0,d:1,e:0,f:0},s="x"===e?1:-1;return or(i,pr.getLocalOrigin(t,"center"),-1*s,1*s),i},getLocalOrigin:(t,e)=>D.tempToOuterOf(pr.getInnerOrigin(t,e),t.localTransform),getInnerOrigin(t,e){const i={};return gt.toPoint(e,t.boxBounds,i),i},getRelativeWorld:(t,e,i)=>(sr(ur,t.worldTransform),dr(ur,e.worldTransform),i?ur:Object.assign({},ur)),drop(t,e,i,s){t.setTransform(pr.getRelativeWorld(t,e,!0),s),e.add(t,i)},hasParent(t,e){if(!e)return!1;for(;t;){if(e===t)return!0;t=t.parent}}},pr=_r,{updateAllMatrix:gr,updateMatrix:fr,updateAllWorldOpacity:yr,updateAllChange:vr}=pr;function mr(t,e){const{e:i,f:s}=t.__localMatrix;t.x+=e.e-i,t.y+=e.f-s}function wr(t,e){return t.__layout.update(),t.parent?D.tempToInnerOf(e,t.parent.__world):e}const xr={worldBounds:t=>t.__world,localBoxBounds:t=>t.__.eraser||0===t.__.visible?null:t.__local||t.__layout,localStrokeBounds:t=>t.__.eraser||0===t.__.visible?null:t.__layout.localStrokeBounds,localRenderBounds:t=>t.__.eraser||0===t.__.visible?null:t.__layout.localRenderBounds,maskLocalBoxBounds:t=>t.__.mask?t.__localBoxBounds:null,maskLocalStrokeBounds:t=>t.__.mask?t.__layout.localStrokeBounds:null,maskLocalRenderBounds:t=>t.__.mask?t.__layout.localRenderBounds:null,excludeRenderBounds:(t,e)=>!(!e.bounds||e.bounds.hit(t.__world,e.matrix))||!(!e.hideBounds||!e.hideBounds.includes(t.__world,e.matrix))},{updateBounds:br}=_r,Er={sort:(t,e)=>t.__.zIndex===e.__.zIndex?t.__tempNumber-e.__tempNumber:t.__.zIndex-e.__.zIndex,pushAllChildBranch(t,e){if(t.__tempNumber=1,t.__.__childBranchNumber){const{children:i}=t;for(let s=0,n=i.length;s<n;s++)(t=i[s]).isBranch&&(t.__tempNumber=1,e.add(t),Br(t,e))}},pushAllParent(t,e){const{keys:i}=e;if(i)for(;t.parent&&void 0===i[t.parent.innerId];)e.add(t.parent),t=t.parent;else for(;t.parent;)e.add(t.parent),t=t.parent},pushAllBranchStack(t,e){let i=e.length;const{children:s}=t;for(let t=0,i=s.length;t<i;t++)s[t].isBranch&&e.push(s[t]);for(let t=i,s=e.length;t<s;t++)Pr(e[t],e)},updateBounds(t,e){const i=[t];Pr(t,i),Rr(i,e)},updateBoundsByBranchStack(t,e){let i,s;for(let n=t.length-1;n>-1;n--){i=t[n],s=i.children;for(let t=0,e=s.length;t<e;t++)br(s[t]);e&&e===i||br(i)}}},{pushAllChildBranch:Br,pushAllBranchStack:Pr,updateBoundsByBranchStack:Rr}=Er,Cr={run(t){if(t&&t.length){const e=t.length;for(let i=0;i<e;i++)t[i]();t.length===e?t.length=0:t.splice(0,e)}}},{getRelativeWorld:Tr}=_r,{toOuterOf:kr,getPoints:Lr,copy:Sr}=rt,Or="_localContentBounds",Dr="_worldContentBounds",Mr="_worldBoxBounds",Ir="_worldStrokeBounds";class Ar{get contentBounds(){return this._contentBounds||this.boxBounds}set contentBounds(t){this._contentBounds=t}get strokeBounds(){return this._strokeBounds||this.boxBounds}get renderBounds(){return this._renderBounds||this.boxBounds}get localContentBounds(){return kr(this.contentBounds,this.leaf.__localMatrix,this[Or]||(this[Or]={})),this[Or]}get localStrokeBounds(){return this._localStrokeBounds||this}get localRenderBounds(){return this._localRenderBounds||this}get worldContentBounds(){return kr(this.contentBounds,this.leaf.__world,this[Dr]||(this[Dr]={})),this[Dr]}get worldBoxBounds(){return kr(this.boxBounds,this.leaf.__world,this[Mr]||(this[Mr]={})),this[Mr]}get worldStrokeBounds(){return kr(this.strokeBounds,this.leaf.__world,this[Ir]||(this[Ir]={})),this[Ir]}get a(){return 1}get b(){return 0}get c(){return 0}get d(){return 1}get e(){return this.leaf.__.x}get f(){return this.leaf.__.y}get x(){return this.e+this.boxBounds.x}get y(){return this.f+this.boxBounds.y}get width(){return this.boxBounds.width}get height(){return this.boxBounds.height}constructor(t){this.leaf=t,this.boxBounds={x:0,y:0,width:0,height:0},this.leaf.__local&&(this._localRenderBounds=this._localStrokeBounds=this.leaf.__local),this.boxChange(),this.matrixChange()}createLocal(){const t=this.leaf.__local={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0};this._localStrokeBounds||(this._localStrokeBounds=t),this._localRenderBounds||(this._localRenderBounds=t)}update(){const{leafer:t}=this.leaf;if(t)t.ready?t.watcher.changed&&t.layouter.layout():t.start();else{let t=this.leaf;for(;t.parent&&!t.parent.leafer;)t=t.parent;e.layout(t)}}getTransform(t="world"){this.update();const{leaf:e}=this;switch(t){case"world":return e.__world;case"local":return e.__localMatrix;case"inner":return b.defaultMatrix;case"page":t=e.zoomLayer;default:return Tr(e,t)}}getBounds(t,e="world"){switch(this.update(),e){case"world":return this.getWorldBounds(t);case"local":return this.getLocalBounds(t);case"inner":return this.getInnerBounds(t);case"page":e=this.leaf.zoomLayer;default:return new lt(this.getInnerBounds(t)).toOuterOf(this.getTransform(e))}}getInnerBounds(t="box"){switch(t){case"render":return this.renderBounds;case"content":if(this.contentBounds)return this.contentBounds;case"box":return this.boxBounds;case"stroke":return this.strokeBounds}}getLocalBounds(t="box"){switch(t){case"render":return this.localRenderBounds;case"stroke":return this.localStrokeBounds;case"content":if(this.contentBounds)return this.localContentBounds;case"box":return this.leaf.__localBoxBounds}}getWorldBounds(t="box"){switch(t){case"render":return this.leaf.__world;case"stroke":return this.worldStrokeBounds;case"content":if(this.contentBounds)return this.worldContentBounds;case"box":return this.worldBoxBounds}}getLayoutBounds(t,e="world",i){const{leaf:s}=this;let n,r,o,a=this.getInnerBounds(t);switch(e){case"world":n=s.getWorldPoint(a),r=s.__world;break;case"local":const{scaleX:t,scaleY:i,rotation:h,skewX:l,skewY:d}=s.__;o={scaleX:t,scaleY:i,rotation:h,skewX:l,skewY:d},n=s.getLocalPointByInner(a);break;case"inner":n=a,r=b.defaultMatrix;break;case"page":e=s.zoomLayer;default:n=s.getWorldPoint(a,e),r=Tr(s,e,!0)}if(o||(o=b.getLayout(r)),Sr(o,a),D.copy(o,n),i){const{scaleX:t,scaleY:e}=o,i=Math.abs(t),s=Math.abs(e);1===i&&1===s||(o.scaleX/=i,o.scaleY/=s,o.width*=i,o.height*=s)}return o}getLayoutPoints(t,e="world"){const{leaf:i}=this,s=Lr(this.getInnerBounds(t));let n;switch(e){case"world":n=null;break;case"local":n=i.parent;break;case"inner":break;case"page":e=i.zoomLayer;default:n=e}return void 0!==n&&s.forEach((t=>i.innerToWorld(t,null,!1,n))),s}shrinkContent(){const{x:t,y:e,width:i,height:s}=this.boxBounds;this._contentBounds={x:t,y:e,width:i,height:s}}spreadStroke(){const{x:t,y:e,width:i,height:s}=this.strokeBounds;this._strokeBounds={x:t,y:e,width:i,height:s},this._localStrokeBounds={x:t,y:e,width:i,height:s},this.renderSpread||this.spreadRenderCancel()}spreadRender(){const{x:t,y:e,width:i,height:s}=this.renderBounds;this._renderBounds={x:t,y:e,width:i,height:s},this._localRenderBounds={x:t,y:e,width:i,height:s}}shrinkContentCancel(){this._contentBounds=void 0}spreadStrokeCancel(){const t=this.renderBounds===this.strokeBounds;this._strokeBounds=this.boxBounds,this._localStrokeBounds=this.leaf.__localBoxBounds,t&&this.spreadRenderCancel()}spreadRenderCancel(){this._renderBounds=this._strokeBounds,this._localRenderBounds=this._localStrokeBounds}boxChange(){this.boxChanged=!0,this.localBoxChanged||this.localBoxChange(),this.hitCanvasChanged=!0}localBoxChange(){this.localBoxChanged=!0,this.boundsChanged=!0}strokeChange(){this.strokeChanged=!0,this.strokeSpread||(this.strokeSpread=1),this.boundsChanged=!0,this.hitCanvasChanged=!0}renderChange(){this.renderChanged=!0,this.renderSpread||(this.renderSpread=1),this.boundsChanged=!0}scaleChange(){this.scaleChanged=!0,this._scaleOrRotationChange()}rotationChange(){this.rotationChanged=!0,this.affectRotation=!0,this._scaleOrRotationChange()}_scaleOrRotationChange(){this.affectScaleOrRotation=!0,this.matrixChange(),this.leaf.__local||this.createLocal()}matrixChange(){this.matrixChanged=!0,this.localBoxChanged||this.localBoxChange()}surfaceChange(){this.surfaceChanged=!0}opacityChange(){this.opacityChanged=!0,this.surfaceChanged||this.surfaceChange()}childrenSortChange(){this.childrenSortChanged||(this.childrenSortChanged=!0,this.leaf.forceUpdate("surface"))}destroy(){}}class Wr{constructor(t,e){this.bubbles=!1,this.type=t,e&&(this.target=e)}stopDefault(){this.isStopDefault=!0,this.origin&&e.event.stopDefault(this.origin)}stopNow(){this.isStopNow=!0,this.isStop=!0,this.origin&&e.event.stopNow(this.origin)}stop(){this.isStop=!0,this.origin&&e.event.stop(this.origin)}}class Fr extends Wr{constructor(t,e,i){super(t,e),this.parent=i,this.child=e}}Fr.ADD="child.add",Fr.REMOVE="child.remove",Fr.CREATED="created",Fr.MOUNTED="mounted",Fr.UNMOUNTED="unmounted",Fr.DESTROY="destroy";class zr extends Wr{constructor(t,e,i,s,n){super(t,e),this.attrName=i,this.oldValue=s,this.newValue=n}}zr.CHANGE="property.change",zr.LEAFER_CHANGE="property.leafer_change";class Nr extends Wr{constructor(t,e){super(t),Object.assign(this,e)}}Nr.LOAD="image.load",Nr.LOADED="image.loaded",Nr.ERROR="image.error";class Ur extends Wr{get bigger(){if(!this.old)return!0;const{width:t,height:e}=this.old;return this.width>=t&&this.height>=e}get smaller(){return!this.bigger}get samePixelRatio(){return!this.old||this.pixelRatio===this.old.pixelRatio}constructor(t,e){"object"==typeof t?(super(Ur.RESIZE),Object.assign(this,t)):super(t),this.old=e}}Ur.RESIZE="resize";class Yr extends Wr{constructor(t,e){super(t),this.data=e}}Yr.REQUEST="watch.request",Yr.DATA="watch.data";class Xr extends Wr{constructor(t,e,i){super(t),e&&(this.data=e,this.times=i)}}Xr.CHECK_UPDATE="layout.check_update",Xr.REQUEST="layout.request",Xr.START="layout.start",Xr.BEFORE="layout.before",Xr.LAYOUT="layout",Xr.AFTER="layout.after",Xr.AGAIN="layout.again",Xr.END="layout.end";class Hr extends Wr{constructor(t,e,i,s){super(t),e&&(this.times=e),i&&(this.renderBounds=i,this.renderOptions=s)}}Hr.REQUEST="render.request",Hr.CHILD_START="render.child_start",Hr.START="render.start",Hr.BEFORE="render.before",Hr.RENDER="render",Hr.AFTER="render.after",Hr.AGAIN="render.again",Hr.END="render.end",Hr.NEXT="render.next";class jr extends Wr{}jr.START="leafer.start",jr.BEFORE_READY="leafer.before_ready",jr.READY="leafer.ready",jr.AFTER_READY="leafer.after_ready",jr.VIEW_READY="leafer.view_ready",jr.VIEW_COMPLETED="leafer.view_completed",jr.STOP="leafer.stop",jr.RESTART="leafer.restart",jr.END="leafer.end";const Vr={};class Gr{set event(t){this.on(t)}on(t,e,i){if(!e){let e,i=t;for(let t in i)e=i[t],e instanceof Array?this.on(t,e[0],e[1]):this.on(t,e);return}let s,n,r;i&&("once"===i?n=!0:"boolean"==typeof i?s=i:(s=i.capture,n=i.once));const o=Kr(this,s,!0),a="string"==typeof t?t.split(" "):t,h=n?{listener:e,once:n}:{listener:e};a.forEach((t=>{t&&(r=o[t],r?-1===r.findIndex((t=>t.listener===e))&&r.push(h):o[t]=[h])}))}off(t,e,i){if(t){const s="string"==typeof t?t.split(" "):t;if(e){let t,n,r;i&&(t="boolean"==typeof i?i:"once"!==i&&i.capture);const o=Kr(this,t);s.forEach((t=>{t&&(n=o[t],n&&(r=n.findIndex((t=>t.listener===e)),r>-1&&n.splice(r,1),n.length||delete o[t]))}))}else{const{__bubbleMap:t,__captureMap:e}=this;s.forEach((i=>{t&&delete t[i],e&&delete e[i]}))}}else this.__bubbleMap=this.__captureMap=void 0}on_(t,e,i,s){return i&&(e=e.bind(i)),this.on(t,e,s),{type:t,current:this,listener:e,options:s}}off_(t){if(!t)return;const e=t instanceof Array?t:[t];e.forEach((t=>t.current.off(t.type,t.listener,t.options))),e.length=0}once(t,e,i){this.on(t,e,{once:!0,capture:i})}emit(t,e,i){!e&&St.has(t)&&(e=St.get(t,{type:t,target:this,current:this}));const s=Kr(this,i)[t];if(s){let n;for(let r=0,o=s.length;r<o&&(n=s[r],n.listener(e),n.once&&(this.off(t,n.listener,i),r--,o--),!e||!e.isStopNow);r++);}this.syncEventer&&this.syncEventer.emitEvent(e,i)}emitEvent(t,e){t.current=this,this.emit(t.type,t,e)}hasEvent(t,e){if(this.syncEventer&&this.syncEventer.hasEvent(t,e))return!0;const{__bubbleMap:i,__captureMap:s}=this,n=i&&i[t],r=s&&s[t];return!!(void 0===e?n||r:e?r:n)}destroy(){this.__captureMap=this.__bubbleMap=this.syncEventer=null}}function Kr(t,e,i){if(e){const{__captureMap:e}=t;return e||(i?t.__captureMap={}:Vr)}{const{__bubbleMap:e}=t;return e||(i?t.__bubbleMap={}:Vr)}}const{on:qr,on_:Zr,off:Qr,off_:Jr,once:$r,emit:to,emitEvent:eo,hasEvent:io,destroy:so}=Gr.prototype,no={on:qr,on_:Zr,off:Qr,off_:Jr,once:$r,emit:to,emitEvent:eo,hasEvent:io,destroyEventer:so},{isFinite:ro}=Number,oo=wt.get("setAttr"),ao={__setAttr(t,e,i){if(this.leaferIsCreated){const s=this.__.__getInput(t);if(i&&!ro(e)&&void 0!==e&&(oo.warn(this.innerName,t,e),e=void 0),"object"==typeof e||s!==e){this.__realSetAttr(t,e);const{CHANGE:i}=zr,n=new zr(i,this,t,s,e);return this.isLeafer?this.emitEvent(new zr(zr.LEAFER_CHANGE,this,t,s,e)):this.hasEvent(i)&&this.emitEvent(n),this.leafer.emitEvent(n),!0}return!1}return this.__realSetAttr(t,e),!0},__realSetAttr(t,e){const i=this.__;i[t]=e,this.__proxyData&&this.setProxyAttr(t,e),i.normalStyle&&(this.lockNormalStyle||void 0===i.normalStyle[t]||(i.normalStyle[t]=e))},__getAttr(t){return this.__proxyData?this.getProxyAttr(t):this.__.__get(t)}},{setLayout:ho,multiplyParent:lo,translateInner:co,defaultWorld:uo}=b,{toPoint:_o,tempPoint:po}=gt,go={__updateWorldMatrix(){lo(this.__local||this.__layout,this.parent?this.parent.__world:uo,this.__world,!!this.__layout.affectScaleOrRotation,this.__,this.parent&&this.parent.__)},__updateLocalMatrix(){if(this.__local){const t=this.__layout,e=this.__local,i=this.__;t.affectScaleOrRotation&&(t.scaleChanged||t.rotationChanged)&&(ho(e,i,null,null,t.affectRotation),t.scaleChanged=t.rotationChanged=!1),e.e=i.x+i.offsetX,e.f=i.y+i.offsetY,(i.around||i.origin)&&(_o(i.around||i.origin,t.boxBounds,po),co(e,-po.x,-po.y,!i.around))}this.__layout.matrixChanged=!1}},{updateMatrix:fo,updateAllMatrix:yo}=_r,{updateBounds:vo}=Er,{toOuterOf:mo,copyAndSpread:wo,copy:xo}=rt,{toBounds:bo}=qs,Eo={__updateWorldBounds(){mo(this.__layout.renderBounds,this.__world,this.__world),this.__layout.resized&&(this.__onUpdateSize(),this.__layout.resized=!1)},__updateLocalBounds(){const t=this.__layout;t.boxChanged&&(this.__.__pathInputed||this.__updatePath(),this.__updateRenderPath(),this.__updateBoxBounds(),t.resized=!0),t.localBoxChanged&&(this.__local&&this.__updateLocalBoxBounds(),t.localBoxChanged=!1,t.strokeSpread&&(t.strokeChanged=!0),t.renderSpread&&(t.renderChanged=!0),this.parent&&this.parent.__layout.boxChange()),t.boxChanged=!1,t.strokeChanged&&(t.strokeSpread=this.__updateStrokeSpread(),t.strokeSpread?(t.strokeBounds===t.boxBounds&&t.spreadStroke(),this.__updateStrokeBounds(),this.__updateLocalStrokeBounds()):t.spreadStrokeCancel(),t.strokeChanged=!1,(t.renderSpread||t.strokeSpread!==t.strokeBoxSpread)&&(t.renderChanged=!0),this.parent&&this.parent.__layout.strokeChange(),t.resized=!0),t.renderChanged&&(t.renderSpread=this.__updateRenderSpread(),t.renderSpread?(t.renderBounds!==t.boxBounds&&t.renderBounds!==t.strokeBounds||t.spreadRender(),this.__updateRenderBounds(),this.__updateLocalRenderBounds()):t.spreadRenderCancel(),t.renderChanged=!1,this.parent&&this.parent.__layout.renderChange()),t.boundsChanged=!1},__updateLocalBoxBounds(){this.__hasMotionPath&&this.__updateMotionPath(),this.__hasAutoLayout&&this.__updateAutoLayout(),mo(this.__layout.boxBounds,this.__local,this.__local)},__updateLocalStrokeBounds(){mo(this.__layout.strokeBounds,this.__localMatrix,this.__layout.localStrokeBounds)},__updateLocalRenderBounds(){mo(this.__layout.renderBounds,this.__localMatrix,this.__layout.localRenderBounds)},__updateBoxBounds(){const t=this.__layout.boxBounds,e=this.__;e.__pathInputed?bo(e.path,t):(t.x=0,t.y=0,t.width=e.width,t.height=e.height)},__updateAutoLayout(){this.__layout.matrixChanged=!0,this.isBranch?(this.leaferIsReady&&this.leafer.layouter.addExtra(this),this.__.flow?(this.__layout.boxChanged&&this.__updateFlowLayout(),yo(this),vo(this,this),this.__.__autoSide&&this.__updateBoxBounds(!0)):(yo(this),vo(this,this))):fo(this)},__updateNaturalSize(){const{__:t,__layout:e}=this;t.__naturalWidth=e.boxBounds.width,t.__naturalHeight=e.boxBounds.height},__updateStrokeBounds(){const t=this.__layout;wo(t.strokeBounds,t.boxBounds,t.strokeBoxSpread)},__updateRenderBounds(){const t=this.__layout;t.renderSpread>0?wo(t.renderBounds,t.boxBounds,t.renderSpread):xo(t.renderBounds,t.strokeBounds)}},Bo={__render(t,e){if(this.__worldOpacity)if(t.setWorld(this.__nowWorld=this.__getNowWorld(e)),t.opacity=this.__.opacity,this.__.__single){if("path"===this.__.eraser)return this.__renderEraser(t,e);const i=t.getSameCanvas(!0,!0);this.__draw(i,e),this.__worldFlipped?t.copyWorldByReset(i,this.__nowWorld,null,this.__.__blendMode,!0):t.copyWorldToInner(i,this.__nowWorld,this.__layout.renderBounds,this.__.__blendMode),i.recycle(this.__nowWorld)}else this.__draw(t,e)},__clip(t,e){this.__worldOpacity&&(t.setWorld(this.__nowWorld=this.__getNowWorld(e)),this.__drawRenderPath(t),this.windingRule?t.clip(this.windingRule):t.clip())},__updateWorldOpacity(){this.__worldOpacity=this.__.visible?this.parent?this.parent.__worldOpacity*this.__.opacity:this.__.opacity:0,this.__layout.opacityChanged&&(this.__layout.opacityChanged=!1)}},{excludeRenderBounds:Po}=xr,Ro={__updateChange(){const{__layout:t}=this;t.childrenSortChanged&&(this.__updateSortChildren(),t.childrenSortChanged=!1),this.__.__checkSingle()},__render(t,e){if(this.__worldOpacity)if(this.__.__single){if("path"===this.__.eraser)return this.__renderEraser(t,e);const i=t.getSameCanvas(!1,!0);this.__renderBranch(i,e);const s=this.__getNowWorld(e);t.opacity=this.__.opacity,t.copyWorldByReset(i,s,s,this.__.__blendMode,!0),i.recycle(s)}else this.__renderBranch(t,e)},__renderBranch(t,e){if(this.__hasMask)this.__renderMask(t,e);else{const{children:i}=this;for(let s=0,n=i.length;s<n;s++)Po(i[s],e)||i[s].__render(t,e)}},__clip(t,e){if(this.__worldOpacity){const{children:i}=this;for(let s=0,n=i.length;s<n;s++)Po(i[s],e)||i[s].__clip(t,e)}}},{LEAF:Co,create:To}=s,{toInnerPoint:ko,toOuterPoint:Lo,multiplyParent:So}=b,{toOuterOf:Oo}=rt,{copy:Do,move:Mo}=D,{moveLocal:Io,zoomOfLocal:Ao,rotateOfLocal:Wo,skewOfLocal:Fo,moveWorld:zo,zoomOfWorld:No,rotateOfWorld:Uo,skewOfWorld:Yo,transform:Xo,transformWorld:Ho,setTransform:jo,getFlipTransform:Vo,getLocalOrigin:Go,getRelativeWorld:Ko,drop:qo}=_r;t.Leaf=class{get tag(){return this.__tag}set tag(t){}get __tag(){return"Leaf"}get innerName(){return this.__.name||this.tag+this.innerId}get __DataProcessor(){return At}get __LayoutProcessor(){return Ar}get leaferIsCreated(){return this.leafer&&this.leafer.created}get leaferIsReady(){return this.leafer&&this.leafer.ready}get isLeafer(){return!1}get isBranch(){return!1}get isBranchLeaf(){return!1}get __localMatrix(){return this.__local||this.__layout}get __localBoxBounds(){return this.__local||this.__layout}get worldTransform(){return this.__layout.getTransform("world")}get localTransform(){return this.__layout.getTransform("local")}get boxBounds(){return this.getBounds("box","inner")}get renderBounds(){return this.getBounds("render","inner")}get worldBoxBounds(){return this.getBounds("box")}get worldStrokeBounds(){return this.getBounds("stroke")}get worldRenderBounds(){return this.getBounds("render")}get worldOpacity(){return this.__layout.update(),this.__worldOpacity}get __worldFlipped(){return this.__world.scaleX<0||this.__world.scaleY<0}get __onlyHitMask(){return this.__hasMask&&!this.__.hitChildren}get __ignoreHitWorld(){return(this.__hasMask||this.__hasEraser)&&this.__.hitChildren}get __inLazyBounds(){const{leafer:t}=this;return t&&t.created&&t.lazyBounds.hit(this.__world)}get pathInputed(){return this.__.__pathInputed}set event(t){this.on(t)}constructor(t){this.innerId=To(Co),this.reset(t),this.__bubbleMap&&this.__emitLifeEvent(Fr.CREATED)}reset(t){this.leafer&&this.leafer.forceRender(this.__world),this.__world={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0,scaleX:1,scaleY:1},null!==t&&(this.__local={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0}),this.__worldOpacity=1,this.__=new this.__DataProcessor(this),this.__layout=new this.__LayoutProcessor(this),this.__level&&this.resetCustom(),t&&(t.__&&(t=t.toJSON()),t.children?this.set(t):Object.assign(this,t))}resetCustom(){this.__hasMask=this.__hasEraser=null,this.forceUpdate()}waitParent(t,e){e&&(t=t.bind(e)),this.parent?t():this.on(Fr.ADD,t,"once")}waitLeafer(t,e){e&&(t=t.bind(e)),this.leafer?t():this.on(Fr.MOUNTED,t,"once")}nextRender(t,e,i){this.leafer?this.leafer.nextRender(t,e,i):this.waitLeafer((()=>this.leafer.nextRender(t,e,i)))}removeNextRender(t){this.nextRender(t,null,"off")}__bindLeafer(t){if(this.isLeafer&&null!==t&&(t=this),this.leafer&&!t&&this.leafer.leafs--,this.leafer=t,t?(t.leafs++,this.__level=this.parent?this.parent.__level+1:1,this.animation&&this.__runAnimation("in"),this.__bubbleMap&&this.__emitLifeEvent(Fr.MOUNTED)):this.__emitLifeEvent(Fr.UNMOUNTED),this.isBranch){const{children:e}=this;for(let i=0,s=e.length;i<s;i++)e[i].__bindLeafer(t)}}set(t,e){}get(t){}setAttr(t,e){this[t]=e}getAttr(t){return this[t]}getComputedAttr(t){return this.__[t]}toJSON(t){return t&&this.__layout.update(),this.__.__getInputData(null,t)}toString(t){return JSON.stringify(this.toJSON(t))}toSVG(){}__SVG(t){}toHTML(){}__setAttr(t,e){return!0}__getAttr(t){}setProxyAttr(t,e){}getProxyAttr(t){}find(t,e){}findTag(t){}findOne(t,e){}findId(t){}focus(t){}updateState(){}updateLayout(){this.__layout.update()}forceUpdate(t){void 0===t?t="width":"surface"===t&&(t="blendMode");const e=this.__.__getInput(t);this.__[t]=void 0===e?null:void 0,this[t]=e}forceRender(t){this.forceUpdate("surface")}__updateWorldMatrix(){}__updateLocalMatrix(){}__updateWorldBounds(){}__updateLocalBounds(){}__updateLocalBoxBounds(){}__updateLocalStrokeBounds(){}__updateLocalRenderBounds(){}__updateBoxBounds(){}__updateContentBounds(){}__updateStrokeBounds(){}__updateRenderBounds(){}__updateAutoLayout(){}__updateFlowLayout(){}__updateNaturalSize(){}__updateStrokeSpread(){return 0}__updateRenderSpread(){return 0}__onUpdateSize(){}__updateEraser(t){this.__hasEraser=!!t||this.children.some((t=>t.__.eraser))}__renderEraser(t,e){t.save(),this.__clip(t,e);const{renderBounds:i}=this.__layout;t.clearRect(i.x,i.y,i.width,i.height),t.restore()}__updateMask(t){this.__hasMask=!!t||this.children.some((t=>t.__.mask))}__renderMask(t,e){}__getNowWorld(t){if(t.matrix){this.__cameraWorld||(this.__cameraWorld={});const e=this.__cameraWorld;return So(this.__world,t.matrix,e,void 0,this.__world),Oo(this.__layout.renderBounds,e,e),e}return this.__world}getTransform(t){return this.__layout.getTransform(t||"local")}getBounds(t,e){return this.__layout.getBounds(t,e)}getLayoutBounds(t,e,i){return this.__layout.getLayoutBounds(t,e,i)}getLayoutPoints(t,e){return this.__layout.getLayoutPoints(t,e)}getWorldBounds(t,e,i){const s=e?Ko(this,e):this.worldTransform,n=i?t:{};return Oo(t,s,n),n}worldToLocal(t,e,i,s){this.parent?this.parent.worldToInner(t,e,i,s):e&&Do(e,t)}localToWorld(t,e,i,s){this.parent?this.parent.innerToWorld(t,e,i,s):e&&Do(e,t)}worldToInner(t,e,i,s){s&&(s.innerToWorld(t,e,i),t=e||t),ko(this.worldTransform,t,e,i)}innerToWorld(t,e,i,s){Lo(this.worldTransform,t,e,i),s&&s.worldToInner(e||t,null,i)}getBoxPoint(t,e,i,s){return this.getBoxPointByInner(this.getInnerPoint(t,e,i,s),null,null,!0)}getBoxPointByInner(t,e,i,s){const n=s?t:Object.assign({},t),{x:r,y:o}=this.boxBounds;return Mo(n,-r,-o),n}getInnerPoint(t,e,i,s){const n=s?t:{};return this.worldToInner(t,n,i,e),n}getInnerPointByBox(t,e,i,s){const n=s?t:Object.assign({},t),{x:r,y:o}=this.boxBounds;return Mo(n,r,o),n}getInnerPointByLocal(t,e,i,s){return this.getInnerPoint(t,this.parent,i,s)}getLocalPoint(t,e,i,s){const n=s?t:{};return this.worldToLocal(t,n,i,e),n}getLocalPointByInner(t,e,i,s){return this.getWorldPoint(t,this.parent,i,s)}getPagePoint(t,e,i,s){return(this.leafer?this.leafer.zoomLayer:this).getInnerPoint(t,e,i,s)}getWorldPoint(t,e,i,s){const n=s?t:{};return this.innerToWorld(t,n,i,e),n}getWorldPointByBox(t,e,i,s){return this.getWorldPoint(this.getInnerPointByBox(t,null,null,s),e,i,!0)}getWorldPointByLocal(t,e,i,s){const n=s?t:{};return this.localToWorld(t,n,i,e),n}getWorldPointByPage(t,e,i,s){return(this.leafer?this.leafer.zoomLayer:this).getWorldPoint(t,e,i,s)}setTransform(t,e){jo(this,t,e)}transform(t,e){Xo(this,t,e)}move(t,e){Io(this,t,e)}moveInner(t,e){zo(this,t,e,!0)}scaleOf(t,e,i,s){Ao(this,Go(this,t),e,i,s)}rotateOf(t,e){Wo(this,Go(this,t),e)}skewOf(t,e,i,s){Fo(this,Go(this,t),e,i,s)}transformWorld(t,e){Ho(this,t,e)}moveWorld(t,e){zo(this,t,e)}scaleOfWorld(t,e,i,s){No(this,t,e,i,s)}rotateOfWorld(t,e){Uo(this,t,e)}skewOfWorld(t,e,i,s){Yo(this,t,e,i,s)}flip(t){Xo(this,Vo(this,t))}scaleResize(t,e=t,i){this.scaleX*=t,this.scaleY*=e}__scaleResize(t,e){}resizeWidth(t){}resizeHeight(t){}__hitWorld(t){return!0}__hit(t){return!0}__hitFill(t){return!0}__hitStroke(t,e){return!0}__hitPixel(t){return!0}__drawHitPath(t){}__updateHitCanvas(){}__render(t,e){}__drawFast(t,e){}__draw(t,e){}__clip(t,e){}__renderShape(t,e,i,s){}__updateWorldOpacity(){}__updateChange(){}__drawPath(t){}__drawRenderPath(t){}__updatePath(){}__updateRenderPath(){}getMotionPathData(){return Rt("path")}getMotionPoint(t){return Rt("path")}getMotionTotal(){return 0}__updateMotionPath(){}__runAnimation(t,e){}__updateSortChildren(){}add(t,e){}remove(t,e){this.parent&&this.parent.remove(this,e)}dropTo(t,e,i){qo(this,t,e,i)}on(t,e,i){}off(t,e,i){}on_(t,e,i,s){}off_(t){}once(t,e,i){}emit(t,e,i){}emitEvent(t,e){}hasEvent(t,e){return!1}static changeAttr(t,e,i){i?this.addAttr(t,e,i):Gn(this.prototype,t,e)}static addAttr(t,e,i){i||(i=Tn),i(e)(this.prototype,t)}__emitLifeEvent(t){this.hasEvent(t)&&this.emitEvent(new Fr(t,this,this.parent))}destroy(){this.destroyed||(this.parent&&this.remove(),this.children&&this.clear(),this.__emitLifeEvent(Fr.DESTROY),this.__.destroy(),this.__layout.destroy(),this.destroyEventer(),this.destroyed=!0)}},t.Leaf=Ft([tr(ao),tr(go),tr(Eo),tr(no),tr(Bo)],t.Leaf);const{setListWithFn:Zo}=rt,{sort:Qo}=Er,{localBoxBounds:Jo,localStrokeBounds:$o,localRenderBounds:ta,maskLocalBoxBounds:ea,maskLocalStrokeBounds:ia,maskLocalRenderBounds:sa}=xr;t.Branch=class extends t.Leaf{__updateStrokeSpread(){const{children:t}=this;for(let e=0,i=t.length;e<i;e++)if(t[e].__layout.strokeSpread)return 1;return 0}__updateRenderSpread(){const{children:t}=this;for(let e=0,i=t.length;e<i;e++)if(t[e].__layout.renderSpread)return 1;return 0}__updateBoxBounds(){Zo(this.__layout.boxBounds,this.children,this.__hasMask?ea:Jo)}__updateStrokeBounds(){Zo(this.__layout.strokeBounds,this.children,this.__hasMask?ia:$o)}__updateRenderBounds(){Zo(this.__layout.renderBounds,this.children,this.__hasMask?sa:ta)}__updateSortChildren(){let t;const{children:e}=this;if(e.length>1){for(let i=0,s=e.length;i<s;i++)e[i].__tempNumber=i,e[i].__.zIndex&&(t=!0);e.sort(Qo),this.__layout.affectChildrenSort=t}}add(t,e){if(t===this)return;const i=void 0===e;if(!t.__){if(t instanceof Array)return t.forEach((t=>{this.add(t,e),i||e++}));t=Tt.get(t.tag,t)}t.parent&&t.parent.remove(t),t.parent=this,i?this.children.push(t):this.children.splice(e,0,t),t.isBranch&&(this.__.__childBranchNumber=(this.__.__childBranchNumber||0)+1),t.__layout.boxChanged||t.__layout.boxChange(),t.__layout.matrixChanged||t.__layout.matrixChange(),t.__bubbleMap&&t.__emitLifeEvent(Fr.ADD),this.leafer&&(t.__bindLeafer(this.leafer),this.leafer.created&&this.__emitChildEvent(Fr.ADD,t)),this.__layout.affectChildrenSort&&this.__layout.childrenSortChange()}addMany(...t){this.add(t)}remove(t,e){t?t.__?t.animationOut?t.__runAnimation("out",(()=>this.__remove(t,e))):this.__remove(t,e):this.find(t).forEach((t=>this.remove(t,e))):void 0===t&&super.remove(null,e)}removeAll(t){const{children:e}=this;e.length&&(this.children=[],this.__preRemove(),this.__.__childBranchNumber=0,e.forEach((e=>{this.__realRemoveChild(e),t&&e.destroy()})))}clear(){this.removeAll(!0)}__remove(t,e){const i=this.children.indexOf(t);i>-1&&(this.children.splice(i,1),t.isBranch&&(this.__.__childBranchNumber=(this.__.__childBranchNumber||1)-1),this.__preRemove(),this.__realRemoveChild(t),e&&t.destroy())}__preRemove(){this.__hasMask&&this.__updateMask(),this.__hasEraser&&this.__updateEraser(),this.__layout.boxChange(),this.__layout.affectChildrenSort&&this.__layout.childrenSortChange()}__realRemoveChild(t){t.__emitLifeEvent(Fr.REMOVE),t.parent=null,this.leafer&&(t.__bindLeafer(null),this.leafer.created&&(this.__emitChildEvent(Fr.REMOVE,t),this.leafer.hitCanvasManager&&this.leafer.hitCanvasManager.clear()))}__emitChildEvent(t,e){const i=new Fr(t,e,this);this.hasEvent(t)&&!this.isLeafer&&this.emitEvent(i),this.leafer.emitEvent(i)}},t.Branch=Ft([tr(Ro)],t.Branch);class na{get length(){return this.list.length}constructor(t){this.reset(),t&&(t instanceof Array?this.addList(t):this.add(t))}has(t){return t&&void 0!==this.keys[t.innerId]}indexAt(t){return this.list[t]}indexOf(t){const e=this.keys[t.innerId];return void 0===e?-1:e}add(t){const{list:e,keys:i}=this;void 0===i[t.innerId]&&(e.push(t),i[t.innerId]=e.length-1)}addAt(t,e=0){const{keys:i}=this;if(void 0===i[t.innerId]){const{list:s}=this;for(let t=e,n=s.length;t<n;t++)i[s[t].innerId]++;0===e?s.unshift(t):(e>s.length&&(e=s.length),s.splice(e,0,t)),i[t.innerId]=e}}addList(t){for(let e=0;e<t.length;e++)this.add(t[e])}remove(t){const{list:e}=this;let i;for(let s=0,n=e.length;s<n;s++)void 0!==i?this.keys[e[s].innerId]=s-1:e[s].innerId===t.innerId&&(i=s,delete this.keys[t.innerId]);void 0!==i&&e.splice(i,1)}sort(t){const{list:e}=this;t?e.sort(((t,e)=>e.__level-t.__level)):e.sort(((t,e)=>t.__level-e.__level))}forEach(t){this.list.forEach(t)}clone(){const t=new na;return t.list=[...this.list],t.keys=Object.assign({},this.keys),t}update(){this.keys={};const{list:t,keys:e}=this;for(let i=0,s=t.length;i<s;i++)e[t[i].innerId]=i}reset(){this.list=[],this.keys={}}destroy(){this.reset()}}class ra{get length(){return this._length}constructor(t){this._length=0,this.reset(),t&&(t instanceof Array?this.addList(t):this.add(t))}has(t){return void 0!==this.keys[t.innerId]}without(t){return void 0===this.keys[t.innerId]}sort(t){const{levels:e}=this;t?e.sort(((t,e)=>e-t)):e.sort(((t,e)=>t-e))}addList(t){t.forEach((t=>{this.add(t)}))}add(t){const{keys:e,levelMap:i}=this;e[t.innerId]||(e[t.innerId]=1,i[t.__level]?i[t.__level].push(t):(i[t.__level]=[t],this.levels.push(t.__level)),this._length++)}forEach(t){let e;this.levels.forEach((i=>{e=this.levelMap[i];for(let i=0,s=e.length;i<s;i++)t(e[i])}))}reset(){this.levelMap={},this.keys={},this.levels=[],this._length=0}destroy(){this.levelMap=null}}const oa=wt.get("LeaferCanvas");class aa extends Kt{set zIndex(t){const{style:e}=this.view;e.zIndex=t,this.setAbsolute(this.view)}set childIndex(t){const{view:e,parentView:i}=this;if(e&&i){const s=i.children[t];s?(this.setAbsolute(s),i.insertBefore(e,s)):i.appendChild(s)}}init(){const{config:t}=this,i=t.view||t.canvas;i?this.__createViewFrom(i):this.__createView();const{style:s}=this.view;if(s.display||(s.display="block"),this.parentView=this.view.parentElement,this.parentView){const t=this.parentView.style;t.webkitUserSelect=t.userSelect="none"}e.syncDomFont&&!this.parentView&&(s.display="none",document.body.appendChild(this.view)),this.__createContext(),this.autoLayout||this.resize(t)}set backgroundColor(t){this.view.style.backgroundColor=t}get backgroundColor(){return this.view.style.backgroundColor}set hittable(t){this.view.style.pointerEvents=t?"auto":"none"}get hittable(){return"none"!==this.view.style.pointerEvents}__createView(){this.view=document.createElement("canvas")}__createViewFrom(t){let e="string"==typeof t?document.getElementById(t):t;if(e)if(e instanceof HTMLCanvasElement)this.view=e;else{let t=e;if(e===window||e===document){const e=document.createElement("div"),{style:i}=e;i.position="absolute",i.top=i.bottom=i.left=i.right="0px",document.body.appendChild(e),t=e}this.__createView();const i=this.view;t.hasChildNodes()&&(this.setAbsolute(i),t.style.position||(t.style.position="relative")),t.appendChild(i)}else oa.error(`no id: ${t}`),this.__createView()}setAbsolute(t){const{style:e}=t;e.position="absolute",e.top=e.left="0px"}updateViewSize(){const{width:t,height:e,pixelRatio:i}=this,{style:s}=this.view;s.width=t+"px",s.height=e+"px",this.view.width=Math.ceil(t*i),this.view.height=Math.ceil(e*i)}updateClientBounds(){this.clientBounds=this.view.getBoundingClientRect()}startAutoLayout(t,i){if(this.resizeListener=i,t){this.autoBounds=t;try{this.resizeObserver=new ResizeObserver((t=>{this.updateClientBounds();for(const e of t)this.checkAutoBounds(e.contentRect)}));const t=this.parentView;t?(this.resizeObserver.observe(t),this.checkAutoBounds(t.getBoundingClientRect())):(this.checkAutoBounds(this.view),oa.warn("no parent"))}catch(t){this.imitateResizeObserver()}}else window.addEventListener("resize",(()=>{const t=e.devicePixelRatio;if(this.pixelRatio!==t){const{width:e,height:i}=this;this.emitResize({width:e,height:i,pixelRatio:t})}}))}imitateResizeObserver(){this.autoLayout&&(this.parentView&&this.checkAutoBounds(this.parentView.getBoundingClientRect()),e.requestRender(this.imitateResizeObserver.bind(this)))}checkAutoBounds(t){const i=this.view,{x:s,y:n,width:r,height:o}=this.autoBounds.getBoundsFrom(t),a={width:r,height:o,pixelRatio:e.devicePixelRatio};if(!this.isSameSize(a)){const{style:t}=i;t.marginLeft=s+"px",t.marginTop=n+"px",this.emitResize(a)}}stopAutoLayout(){this.autoLayout=!1,this.resizeListener=null,this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null)}emitResize(t){const e={};Mt.copyAttrs(e,this,Gt),this.resize(t),this.resizeListener&&void 0!==this.width&&this.resizeListener(new Ur(t,e))}unrealCanvas(){if(!this.unreal&&this.parentView){const t=this.view;t&&t.remove(),this.view=this.parentView,this.unreal=!0}}destroy(){if(this.view){if(this.stopAutoLayout(),!this.unreal){const t=this.view;t.parentElement&&t.remove()}super.destroy()}}}an(CanvasRenderingContext2D.prototype),an(Path2D.prototype);const{mineType:ha,fileType:la}=hn;function da(t,s){e.origin={createCanvas(t,e){const i=document.createElement("canvas");return i.width=t,i.height=e,i},canvasToDataURL:(t,e,i)=>t.toDataURL(ha(e),i),canvasToBolb:(t,e,i)=>new Promise((s=>t.toBlob(s,ha(e),i))),canvasSaveAs:(t,i,s)=>{const n=t.toDataURL(ha(la(i)),s);return e.origin.download(n,i)},download:(t,e)=>new Promise((i=>{let s=document.createElement("a");s.href=t,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),i()})),loadImage:t=>new Promise(((i,s)=>{const n=new Image,{crossOrigin:r}=e.image;r&&(n.setAttribute("crossOrigin",r),n.crossOrigin=r),n.onload=()=>{i(n)},n.onerror=t=>{s(t)},n.src=e.image.getRealURL(t)}))},e.event={stopDefault(t){t.preventDefault()},stopNow(t){t.stopImmediatePropagation()},stop(t){t.stopPropagation()}},e.canvas=i.canvas(),e.conicGradientSupport=!!e.canvas.context.createConicGradient}Object.assign(i,{canvas:(t,e)=>new aa(t,e),image:t=>new yn(t)}),e.name="web",e.isMobile="ontouchstart"in window,e.requestRender=function(t){window.requestAnimationFrame(t)},vn(e,"devicePixelRatio",{get:()=>Math.max(1,devicePixelRatio)});const{userAgent:ca}=navigator;ca.indexOf("Firefox")>-1?(e.conicGradientRotate90=!0,e.intWheelDeltaY=!0,e.syncDomFont=!0):ca.indexOf("Safari")>-1&&-1===ca.indexOf("Chrome")&&(e.fullImageShadow=!0),ca.indexOf("Windows")>-1?(e.os="Windows",e.intWheelDeltaY=!0):ca.indexOf("Mac")>-1?e.os="Mac":ca.indexOf("Linux")>-1&&(e.os="Linux");class ua{get childrenChanged(){return this.hasAdd||this.hasRemove||this.hasVisible}get updatedList(){if(this.hasRemove){const t=new na;return this.__updatedList.list.forEach((e=>{e.leafer&&t.add(e)})),t}return this.__updatedList}constructor(t,e){this.totalTimes=0,this.config={},this.__updatedList=new na,this.target=t,e&&(this.config=Mt.default(e,this.config)),this.__listenEvents()}start(){this.disabled||(this.running=!0)}stop(){this.running=!1}disable(){this.stop(),this.__removeListenEvents(),this.disabled=!0}update(){this.changed=!0,this.running&&this.target.emit(Hr.REQUEST)}__onAttrChange(t){this.__updatedList.add(t.target),this.update()}__onChildEvent(t){t.type===Fr.ADD?(this.hasAdd=!0,this.__pushChild(t.child)):(this.hasRemove=!0,this.__updatedList.add(t.parent)),this.update()}__pushChild(t){this.__updatedList.add(t),t.isBranch&&this.__loopChildren(t)}__loopChildren(t){const{children:e}=t;for(let t=0,i=e.length;t<i;t++)this.__pushChild(e[t])}__onRquestData(){this.target.emitEvent(new Yr(Yr.DATA,{updatedList:this.updatedList})),this.__updatedList=new na,this.totalTimes++,this.changed=!1,this.hasVisible=!1,this.hasRemove=!1,this.hasAdd=!1}__listenEvents(){const{target:t}=this;this.__eventIds=[t.on_(zr.CHANGE,this.__onAttrChange,this),t.on_([Fr.ADD,Fr.REMOVE],this.__onChildEvent,this),t.on_(Yr.REQUEST,this.__onRquestData,this)]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=null,this.__updatedList=null)}}const{updateAllMatrix:_a,updateBounds:pa,updateAllWorldOpacity:ga}=_r,{pushAllChildBranch:fa,pushAllParent:ya}=Er;const{worldBounds:va}=xr,ma={x:0,y:0,width:1e5,height:1e5};class wa{constructor(t){this.updatedBounds=new lt,this.beforeBounds=new lt,this.afterBounds=new lt,t instanceof Array&&(t=new na(t)),this.updatedList=t}setBefore(){this.beforeBounds.setListWithFn(this.updatedList.list,va)}setAfter(){const{list:t}=this.updatedList;t.some((t=>t.noBounds))?this.afterBounds.set(ma):this.afterBounds.setListWithFn(t,va),this.updatedBounds.setList([this.beforeBounds,this.afterBounds])}merge(t){this.updatedList.addList(t.updatedList.list),this.beforeBounds.add(t.beforeBounds),this.afterBounds.add(t.afterBounds),this.updatedBounds.add(t.updatedBounds)}destroy(){this.updatedList=null}}const{updateAllMatrix:xa,updateAllChange:ba}=_r,Ea=wt.get("Layouter");class Ba{constructor(t,e){this.totalTimes=0,this.config={},this.__levelList=new ra,this.target=t,e&&(this.config=Mt.default(e,this.config)),this.__listenEvents()}start(){this.disabled||(this.running=!0)}stop(){this.running=!1}disable(){this.stop(),this.__removeListenEvents(),this.disabled=!0}layout(){if(!this.running)return;const{target:t}=this;this.times=0;try{t.emit(Xr.START),this.layoutOnce(),t.emitEvent(new Xr(Xr.END,this.layoutedBlocks,this.times))}catch(t){Ea.error(t)}this.layoutedBlocks=null}layoutAgain(){this.layouting?this.waitAgain=!0:this.layoutOnce()}layoutOnce(){return this.layouting?Ea.warn("layouting"):this.times>3?Ea.warn("layout max times"):(this.times++,this.totalTimes++,this.layouting=!0,this.target.emit(Yr.REQUEST),this.totalTimes>1?this.partLayout():this.fullLayout(),this.layouting=!1,void(this.waitAgain&&(this.waitAgain=!1,this.layoutOnce())))}partLayout(){var t;if(!(null===(t=this.__updatedList)||void 0===t?void 0:t.length))return;const e=Bt.start("PartLayout"),{target:i,__updatedList:s}=this,{BEFORE:n,LAYOUT:r,AFTER:o}=Xr,a=this.getBlocks(s);a.forEach((t=>t.setBefore())),i.emitEvent(new Xr(n,a,this.times)),this.extraBlock=null,s.sort(),function(t,e){let i;t.list.forEach((t=>{i=t.__layout,e.without(t)&&!i.proxyZoom&&(i.matrixChanged?(_a(t,!0),e.add(t),t.isBranch&&fa(t,e),ya(t,e)):i.boundsChanged&&(e.add(t),t.isBranch&&(t.__tempNumber=0),ya(t,e)))}))}(s,this.__levelList),function(t){let e,i,s;t.sort(!0),t.levels.forEach((n=>{e=t.levelMap[n];for(let t=0,n=e.length;t<n;t++){if(i=e[t],i.isBranch&&i.__tempNumber){s=i.children;for(let t=0,e=s.length;t<e;t++)s[t].isBranch||pa(s[t])}pa(i)}}))}(this.__levelList),function(t){let e;t.list.forEach((t=>{e=t.__layout,e.opacityChanged&&ga(t),e.stateStyleChanged&&setTimeout((()=>e.stateStyleChanged&&t.updateState())),t.__updateChange()}))}(s),this.extraBlock&&a.push(this.extraBlock),a.forEach((t=>t.setAfter())),i.emitEvent(new Xr(r,a,this.times)),i.emitEvent(new Xr(o,a,this.times)),this.addBlocks(a),this.__levelList.reset(),this.__updatedList=null,Bt.end(e)}fullLayout(){const t=Bt.start("FullLayout"),{target:e}=this,{BEFORE:i,LAYOUT:s,AFTER:n}=Xr,r=this.getBlocks(new na(e));e.emitEvent(new Xr(i,r,this.times)),Ba.fullLayout(e),r.forEach((t=>{t.setAfter()})),e.emitEvent(new Xr(s,r,this.times)),e.emitEvent(new Xr(n,r,this.times)),this.addBlocks(r),Bt.end(t)}static fullLayout(t){xa(t,!0),t.isBranch?Er.updateBounds(t):_r.updateBounds(t),ba(t)}addExtra(t){if(!this.__updatedList.has(t)){const{updatedList:e,beforeBounds:i}=this.extraBlock||(this.extraBlock=new wa([]));e.length?i.add(t.__world):i.set(t.__world),e.add(t)}}createBlock(t){return new wa(t)}getBlocks(t){return[this.createBlock(t)]}addBlocks(t){this.layoutedBlocks?this.layoutedBlocks.push(...t):this.layoutedBlocks=t}__onReceiveWatchData(t){this.__updatedList=t.data.updatedList}__listenEvents(){const{target:t}=this;this.__eventIds=[t.on_(Xr.REQUEST,this.layout,this),t.on_(Xr.AGAIN,this.layoutAgain,this),t.on_(Yr.DATA,this.__onReceiveWatchData,this)]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=this.config=null)}}const Pa=wt.get("Renderer");class Ra{get needFill(){return!(this.canvas.allowBackgroundColor||!this.config.fill)}constructor(t,e,i){this.FPS=60,this.totalTimes=0,this.times=0,this.config={usePartRender:!0,maxFPS:60},this.target=t,this.canvas=e,i&&(this.config=Mt.default(i,this.config)),this.__listenEvents(),this.__requestRender()}start(){this.running=!0}stop(){this.running=!1}update(){this.changed=!0}requestLayout(){this.target.emit(Xr.REQUEST)}render(t){if(!this.running||!this.canvas.view)return void(this.changed=!0);const{target:e}=this;this.times=0,this.totalBounds=new lt,Pa.log(e.innerName,"---\x3e");try{e.app.emit(Hr.CHILD_START,e),this.emitRender(Hr.START),this.renderOnce(t),this.emitRender(Hr.END,this.totalBounds),_n.clearRecycled()}catch(t){this.rendering=!1,Pa.error(t)}Pa.log("-------------|")}renderAgain(){this.rendering?this.waitAgain=!0:this.renderOnce()}renderOnce(t){if(this.rendering)return Pa.warn("rendering");if(this.times>3)return Pa.warn("render max times");if(this.times++,this.totalTimes++,this.rendering=!0,this.changed=!1,this.renderBounds=new lt,this.renderOptions={},t)this.emitRender(Hr.BEFORE),t();else{if(this.requestLayout(),this.ignore)return void(this.ignore=this.rendering=!1);this.emitRender(Hr.BEFORE),this.config.usePartRender&&this.totalTimes>1?this.partRender():this.fullRender()}this.emitRender(Hr.RENDER,this.renderBounds,this.renderOptions),this.emitRender(Hr.AFTER,this.renderBounds,this.renderOptions),this.updateBlocks=null,this.rendering=!1,this.waitAgain&&(this.waitAgain=!1,this.renderOnce())}partRender(){const{canvas:t,updateBlocks:e}=this;if(!e)return Pa.warn("PartRender: need update attr");this.mergeBlocks(),e.forEach((e=>{t.bounds.hit(e)&&!e.isEmpty()&&this.clipRender(e)}))}clipRender(t){const e=Bt.start("PartRender"),{canvas:i}=this,s=t.getIntersect(i.bounds),n=t.includes(this.target.__world),r=new lt(s);i.save(),n&&!wt.showRepaint?i.clear():(s.spread(10+1/this.canvas.pixelRatio).ceil(),i.clearWorld(s,!0),i.clipWorld(s,!0)),this.__render(s,n,r),i.restore(),Bt.end(e)}fullRender(){const t=Bt.start("FullRender"),{canvas:e}=this;e.save(),e.clear(),this.__render(e.bounds,!0),e.restore(),Bt.end(t)}__render(t,e,i){const s=t.includes(this.target.__world)?{includes:e}:{bounds:t,includes:e};this.needFill&&this.canvas.fillWorld(t,this.config.fill),wt.showRepaint&&this.canvas.strokeWorld(t,"red"),this.target.__render(this.canvas,s),this.renderBounds=i=i||t,this.renderOptions=s,this.totalBounds.isEmpty()?this.totalBounds=i:this.totalBounds.add(i),wt.showHitView&&this.renderHitView(s),wt.showBoundsView&&this.renderBoundsView(s),this.canvas.updateRender(i)}renderHitView(t){}renderBoundsView(t){}addBlock(t){this.updateBlocks||(this.updateBlocks=[]),this.updateBlocks.push(t)}mergeBlocks(){const{updateBlocks:t}=this;if(t){const e=new lt;e.setList(t),t.length=0,t.push(e)}}__requestRender(){const t=Date.now();e.requestRender((()=>{this.FPS=Math.min(60,Math.ceil(1e3/(Date.now()-t))),this.running&&(this.changed&&this.canvas.view&&this.render(),this.target.emit(Hr.NEXT)),this.target&&this.__requestRender()}))}__onResize(t){if(!this.canvas.unreal){if(t.bigger||!t.samePixelRatio){const{width:e,height:i}=t.old;if(!new lt(0,0,e,i).includes(this.target.__world)||this.needFill||!t.samePixelRatio)return this.addBlock(this.canvas.bounds),void this.target.forceUpdate("surface")}this.addBlock(new lt(0,0,1,1)),this.changed=!0}}__onLayoutEnd(t){t.data&&t.data.map((t=>{let e;t.updatedList&&t.updatedList.list.some((t=>(e=!t.__world.width||!t.__world.height,e&&(t.isLeafer||Pa.tip(t.innerName,": empty"),e=!t.isBranch||t.isBranchLeaf),e))),this.addBlock(e?this.canvas.bounds:t.updatedBounds)}))}emitRender(t,e,i){this.target.emitEvent(new Hr(t,this.times,e,i))}__listenEvents(){const{target:t}=this;this.__eventIds=[t.on_(Hr.REQUEST,this.update,this),t.on_(Xr.END,this.__onLayoutEnd,this),t.on_(Hr.AGAIN,this.renderAgain,this),t.on_(Ur.RESIZE,this.__onResize,this)]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=this.canvas=this.config=null)}}const{hitRadiusPoint:Ca}=rt;class Ta{constructor(t,e){this.target=t,this.selector=e}getByPoint(t,e,i){e||(e=0),i||(i={});const s=i.through||!1,n=i.ignoreHittable||!1,r=i.target||this.target;this.exclude=i.exclude||null,this.point={x:t.x,y:t.y,radiusX:e,radiusY:e},this.findList=new na(i.findList),i.findList||this.hitBranch(r);const{list:o}=this.findList,a=this.getBestMatchLeaf(o,i.bottomList,n),h=n?this.getPath(a):this.getHitablePath(a);return this.clear(),s?{path:h,target:a,throughPath:o.length?this.getThroughPath(o):h}:{path:h,target:a}}getBestMatchLeaf(t,e,i){if(t.length){let e;this.findList=new na;const{x:s,y:n}=this.point,r={x:s,y:n,radiusX:0,radiusY:0};for(let s=0,n=t.length;s<n;s++)if(e=t[s],(i||_r.worldHittable(e))&&(this.hitChild(e,r),this.findList.length))return this.findList.list[0]}if(e)for(let t=0,i=e.length;t<i;t++)if(this.hitChild(e[t].target,this.point,e[t].proxy),this.findList.length)return this.findList.list[0];return t[0]}getPath(t){const e=new na;for(;t;)e.add(t),t=t.parent;return this.target&&e.add(this.target),e}getHitablePath(t){const e=this.getPath(t&&t.hittable?t:null);let i,s=new na;for(let t=e.list.length-1;t>-1&&(i=e.list[t],i.__.hittable)&&(s.addAt(i,0),i.__.hitChildren);t--);return s}getThroughPath(t){const e=new na,i=[];for(let e=t.length-1;e>-1;e--)i.push(this.getPath(t[e]));let s,n,r;for(let t=0,o=i.length;t<o;t++){s=i[t],n=i[t+1];for(let t=0,i=s.length;t<i&&(r=s.list[t],!n||!n.has(r));t++)e.add(r)}return e}hitBranch(t){this.eachFind(t.children,t.__onlyHitMask)}eachFind(t,e){let i,s;const{point:n}=this;for(let r=t.length-1;r>-1;r--)i=t[r],!i.__.visible||e&&!i.__.mask||(s=!!i.__.hitRadius||Ca(i.__world,n),i.isBranch?(s||i.__ignoreHitWorld)&&(this.eachFind(i.children,i.__onlyHitMask),i.isBranchLeaf&&this.hitChild(i,n)):s&&this.hitChild(i,n))}hitChild(t,e,i){if((!this.exclude||!this.exclude.has(t))&&t.__hitWorld(e)){const{parent:s}=t;if(s&&s.__hasMask&&!t.__.mask&&!s.children.some((t=>t.__.mask&&t.__hitWorld(e))))return;this.findList.add(i||t)}}clear(){this.point=null,this.findList=null,this.exclude=null}destroy(){this.clear()}}const{Yes:ka,NoAndSkip:La,YesAndSkip:Sa}=t.Answer,Oa={},Da={},Ma={};class Ia{constructor(t,e){this.config={},this.innerIdMap={},this.idMap={},this.methods={id:(t,e)=>t.id===e?(this.target&&(this.idMap[e]=t),1):0,innerId:(t,e)=>t.innerId===e?(this.target&&(this.innerIdMap[e]=t),1):0,className:(t,e)=>t.className===e?1:0,tag:(t,e)=>t.__tag===e?1:0,tags:(t,e)=>e[t.__tag]?1:0},this.target=t,e&&(this.config=Mt.default(e,this.config)),this.picker=new Ta(t,this),t&&this.__listenEvents()}getBy(t,e,i,s){switch(typeof t){case"number":const n=this.getByInnerId(t,e);return i?n:n?[n]:[];case"string":switch(t[0]){case"#":Oa.id=t.substring(1),t=Oa;break;case".":Da.className=t.substring(1),t=Da;break;default:Ma.tag=t,t=Ma}case"object":if(void 0!==t.id){const s=this.getById(t.id,e);return i?s:s?[s]:[]}if(t.tag){const{tag:s}=t,n=s instanceof Array;return this.getByMethod(n?this.methods.tags:this.methods.tag,e,i,n?Mt.toMap(s):s)}return this.getByMethod(this.methods.className,e,i,t.className);case"function":return this.getByMethod(t,e,i,s)}}getByPoint(t,i,s){return"node"===e.name&&this.target&&this.target.emit(Xr.CHECK_UPDATE),this.picker.getByPoint(t,i,s)}getByInnerId(t,e){const i=this.innerIdMap[t];return i||(this.eachFind(this.toChildren(e),this.methods.innerId,null,t),this.findLeaf)}getById(t,e){const i=this.idMap[t];return i&&_r.hasParent(i,e||this.target)?i:(this.eachFind(this.toChildren(e),this.methods.id,null,t),this.findLeaf)}getByClassName(t,e){return this.getByMethod(this.methods.className,e,!1,t)}getByTag(t,e){return this.getByMethod(this.methods.tag,e,!1,t)}getByMethod(t,e,i,s){const n=i?null:[];return this.eachFind(this.toChildren(e),t,n,s),n||this.findLeaf}eachFind(t,e,i,s){let n,r;for(let o=0,a=t.length;o<a;o++){if(n=t[o],r=e(n,s),r===ka||r===Sa){if(!i)return void(this.findLeaf=n);i.push(n)}n.isBranch&&r<La&&this.eachFind(n.children,e,i,s)}}toChildren(t){return this.findLeaf=null,[t||this.target]}__onRemoveChild(t){const{id:e,innerId:i}=t.child;this.idMap[e]&&delete this.idMap[e],this.innerIdMap[i]&&delete this.innerIdMap[i]}__checkIdChange(t){if("id"===t.attrName){const e=t.oldValue;this.idMap[e]&&delete this.idMap[e]}}__listenEvents(){this.__eventIds=[this.target.on_(Fr.REMOVE,this.__onRemoveChild,this),this.target.on_(zr.CHANGE,this.__checkIdChange,this)]}__removeListenEvents(){this.target.off_(this.__eventIds),this.__eventIds.length=0}destroy(){this.__eventIds.length&&(this.__removeListenEvents(),this.picker.destroy(),this.findLeaf=null,this.innerIdMap={},this.idMap={})}}function Aa(t){return wn(t,(t=>({set(e){this.__setAttr(t,e),e&&(this.__.__useEffect=!0),this.__layout.renderChanged||this.__layout.renderChange()}})))}function Wa(t){return wn(t,(t=>({set(e){this.__setAttr(t,e),this.__layout.boxChanged||this.__layout.boxChange(),this.__updateSize()}})))}function Fa(){return(t,e)=>{const i="_"+e;vn(t,e,{set(t){this.isLeafer&&(this[i]=t)},get(){return this.isApp?this.tree.zoomLayer:this.isLeafer?this[i]||this:this.leafer&&this.leafer.zoomLayer}})}}Object.assign(i,{watcher:(t,e)=>new ua(t,e),layouter:(t,e)=>new Ba(t,e),renderer:(t,e,i)=>new Ra(t,e,i),selector:(t,e)=>new Ia(t,e)}),e.layout=Ba.fullLayout;const za={},Na={},Ua={number:(t,e)=>"object"==typeof t?"percent"===t.type?t.value*e:t.value:t},Ya={},Xa={},Ha={},ja={},Va={},Ga={},Ka={setStyleName:(t,e,i)=>Rt("state"),set:(t,e)=>Rt("state")},qa={list:{},register(t,e){qa.list[t]=e},get:t=>qa.list[t]},{parse:Za,objectToCanvasData:Qa}=fi,Ja={},$a=wt.get("UIData");class th extends At{get scale(){const{scaleX:t,scaleY:e}=this;return t!==e?{x:t,y:e}:t}get __strokeWidth(){const{strokeWidth:t,strokeWidthFixed:e}=this;if(e){const e=this.__leaf;let{scaleX:i}=e.__nowWorld||e.__world;return i<0&&(i=-i),i>1?t/i:t}return t}get __hasStroke(){return this.stroke&&this.strokeWidth}get __clipAfterFill(){return this.cornerRadius||this.__pathInputed}get __autoWidth(){return!this._width}get __autoHeight(){return!this._height}get __autoSide(){return!this._width||!this._height}get __autoSize(){return!this._width&&!this._height}setVisible(t){this._visible=t;const{leafer:e}=this.__leaf;e&&(e.watcher.hasVisible=!0)}setWidth(t){t<0?(this._width=-t,this.__leaf.scaleX*=-1,$a.warn("width < 0, instead -scaleX ",this)):this._width=t}setHeight(t){t<0?(this._height=-t,this.__leaf.scaleY*=-1,$a.warn("height < 0, instead -scaleY",this)):this._height=t}setFill(t){this.__naturalWidth&&this.__removeNaturalSize(),"string"!=typeof t&&t?"object"==typeof t&&(this.__setInput("fill",t),this.__leaf.__layout.boxChanged||this.__leaf.__layout.boxChange(),this.__isFills=!0,this._fill||(this._fill=Ja)):(this.__isFills&&(this.__removeInput("fill"),Ha.recycleImage("fill",this),this.__isFills=!1,this.__pixelFill&&(this.__pixelFill=!1)),this._fill=t)}setStroke(t){"string"!=typeof t&&t?"object"==typeof t&&(this.__setInput("stroke",t),this.__leaf.__layout.boxChanged||this.__leaf.__layout.boxChange(),this.__isStrokes=!0,this._stroke||(this._stroke=Ja)):(this.__isStrokes&&(this.__removeInput("stroke"),Ha.recycleImage("stroke",this),this.__isStrokes=!1,this.__pixelStroke&&(this.__pixelStroke=!1)),this._stroke=t)}setPath(t){const e="string"==typeof t;e||t&&"object"==typeof t[0]?(this.__setInput("path",t),this._path=e?Za(t):Qa(t)):(this.__input&&this.__removeInput("path"),this._path=t)}setShadow(t){this.__setInput("shadow",t),t instanceof Array?(t.some((t=>!1===t.visible))&&(t=t.filter((t=>!1!==t.visible))),this._shadow=t.length?t:null):this._shadow=t&&!1!==t.visible?[t]:null}setInnerShadow(t){this.__setInput("innerShadow",t),t instanceof Array?(t.some((t=>!1===t.visible))&&(t=t.filter((t=>!1!==t.visible))),this._innerShadow=t.length?t:null):this._innerShadow=t&&!1!==t.visible?[t]:null}__computePaint(){const{fill:t,stroke:e}=this.__input;t&&Xa.compute("fill",this.__leaf),e&&Xa.compute("stroke",this.__leaf),this.__needComputePaint=!1}}class eh extends th{}class ih extends eh{get __boxStroke(){return!this.__pathInputed}get __drawAfterFill(){return"hide"===this.overflow&&this.__clipAfterFill&&this.__leaf.children.length}get __clipAfterFill(){return this.__leaf.isOverflow||super.__clipAfterFill}}class sh extends eh{__getInputData(t,e){const i=super.__getInputData(t,e);return Gt.forEach((t=>delete i[t])),i}}class nh extends ih{}class rh extends th{}class oh extends th{get __boxStroke(){return!this.__pathInputed}}class ah extends th{get __boxStroke(){return!this.__pathInputed}}class hh extends th{}class lh extends th{}class dh extends th{get __pathInputed(){return 2}}class ch extends eh{}const uh={thin:100,"extra-light":200,light:300,normal:400,medium:500,"semi-bold":600,bold:700,"extra-bold":800,black:900};class _h extends th{get __useNaturalRatio(){return!1}setFontWeight(t){"string"==typeof t?(this.__setInput("fontWeight",t),this._fontWeight=uh[t]||400):(this.__input&&this.__removeInput("fontWeight"),this._fontWeight=t)}}class ph extends oh{setUrl(t){this.__setImageFill(t),this._url=t}__setImageFill(t){this.__leaf.image&&(this.__leaf.image=null),this.fill=t?{type:"image",mode:"stretch",url:t}:void 0}__getData(){const t=super.__getData();return delete t.fill,t}__getInputData(t,e){const i=super.__getInputData(t,e);return delete i.fill,i}}class gh extends oh{get __isCanvas(){return!0}get __drawAfterFill(){return!0}__getInputData(t,e){const i=super.__getInputData(t,e);return i.url=this.__leaf.canvas.toDataURL("image/png"),i}}const fh={__updateStrokeSpread(){let t=0,e=0;const i=this.__,{strokeAlign:s,strokeWidth:n}=i;if((i.stroke||"all"===i.hitStroke)&&n&&"inside"!==s&&(e=t="center"===s?n/2:n,!i.__boxStroke)){const e=i.__isLinePath?0:10*t,s="none"===i.strokeCap?0:n;t+=Math.max(e,s)}return i.__useArrow&&(t+=5*n),this.__layout.strokeBoxSpread=e,t},__updateRenderSpread(){let t=0;const{shadow:e,innerShadow:i,blur:s,backgroundBlur:n}=this.__;e&&e.forEach((e=>t=Math.max(t,Math.max(Math.abs(e.y),Math.abs(e.x))+(e.spread>0?e.spread:0)+1.5*e.blur))),s&&(t=Math.max(t,s));let r=t=Math.ceil(t);return i&&i.forEach((t=>r=Math.max(r,Math.max(Math.abs(t.y),Math.abs(t.x))+(t.spread<0?-t.spread:0)+1.5*t.blur))),n&&(r=Math.max(r,n)),this.__layout.renderShapeSpread=r,t+(this.__layout.strokeSpread||0)}},yh={__updateChange(){const t=this.__;if(t.__useEffect){const{shadow:e,innerShadow:i,blur:s,backgroundBlur:n}=this.__;t.__useEffect=!!(e||i||s||n)}t.__checkSingle();t.__isFills||t.__isStrokes||t.cornerRadius||t.__useEffect?t.__complex=!0:t.__complex&&(t.__complex=!1)},__drawFast(t,e){vh(this,t,e)},__draw(t,e){const i=this.__;if(i.__complex){i.__needComputePaint&&i.__computePaint();const{fill:s,stroke:n,__drawAfterFill:r}=i;if(this.__drawRenderPath(t),i.__useEffect){const o=Xa.shape(this,t,e);this.__nowWorld=this.__getNowWorld(e);const{shadow:a,innerShadow:h}=i;a&&Va.shadow(this,t,o),s&&(i.__isFills?Xa.fills(s,this,t):Xa.fill(s,this,t)),r&&this.__drawAfterFill(t,e),h&&Va.innerShadow(this,t,o),n&&(i.__isStrokes?Xa.strokes(n,this,t):Xa.stroke(n,this,t)),o.worldCanvas&&o.worldCanvas.recycle(),o.canvas.recycle()}else s&&(i.__isFills?Xa.fills(s,this,t):Xa.fill(s,this,t)),r&&this.__drawAfterFill(t,e),n&&(i.__isStrokes?Xa.strokes(n,this,t):Xa.stroke(n,this,t))}else i.__pathInputed?vh(this,t,e):this.__drawFast(t,e)},__renderShape(t,e,i,s){if(this.__worldOpacity){t.setWorld(this.__nowWorld=this.__getNowWorld(e));const{fill:n,stroke:r}=this.__;this.__drawRenderPath(t),n&&!i&&(this.__.__pixelFill?Xa.fills(n,this,t):Xa.fill("#000000",this,t)),this.__.__isCanvas&&this.__drawAfterFill(t,e),r&&!s&&(this.__.__pixelStroke?Xa.strokes(r,this,t):Xa.stroke("#000000",this,t))}},__drawAfterFill(t,e){this.__.__clipAfterFill?(t.save(),this.windingRule?t.clip(this.windingRule):t.clip(),this.__drawContent(t,e),t.restore()):this.__drawContent(t,e)}};function vh(t,e,i){const{fill:s,stroke:n,__drawAfterFill:r}=t.__;t.__drawRenderPath(e),s&&Xa.fill(s,t,e),r&&t.__drawAfterFill(e,i),n&&Xa.stroke(n,t,e)}const mh={__drawFast(t,e){let{width:i,height:s,fill:n,stroke:r,__drawAfterFill:o}=this.__;if(n&&(t.fillStyle=n,t.fillRect(0,0,i,s)),o&&this.__drawAfterFill(t,e),r){const{strokeAlign:n,__strokeWidth:o}=this.__;if(!o)return;t.setStroke(r,o,this.__);const a=o/2;switch(n){case"center":t.strokeRect(0,0,i,s);break;case"inside":i-=o,s-=o,i<0||s<0?(t.save(),this.__clip(t,e),t.strokeRect(a,a,i,s),t.restore()):t.strokeRect(a,a,i,s);break;case"outside":t.strokeRect(-a,-a,i+o,s+o)}}}};var wh,xh;t.UI=wh=class extends t.Leaf{get app(){return this.leafer&&this.leafer.app}get isFrame(){return!1}set scale(t){h.assignScale(this,t)}get scale(){return this.__.scale}get pen(){const{path:t}=this.__;return rn.set(this.path=t||[]),t||this.__drawPathByBox(rn),rn}get editConfig(){}get editOuter(){return""}get editInner(){return""}constructor(t){super(t)}reset(t){}set(t,e){e?(this.lockNormalStyle=!0,Object.assign(this,t),this.lockNormalStyle=!1):Object.assign(this,t)}get(t){return"string"==typeof t?this.__.__getInput(t):this.__.__getInputData(t)}createProxyData(){}find(t,e){}findTag(t){return this.find({tag:t})}findOne(t,e){}findId(t){return this.findOne({id:t})}getPath(t,e){this.__layout.update();let i=e?this.__.__pathForRender:this.__.path;return i||(rn.set(i=[]),this.__drawPathByBox(rn)),t?fi.toCanvasData(i,!0):i}getPathString(t,e,i){return fi.stringify(this.getPath(t,e),i)}load(){this.__.__computePaint()}__onUpdateSize(){if(this.__.__input){const t=this.__;!t.lazy||this.__inLazyBounds||Ga.running?t.__computePaint():t.__needComputePaint=!0}}__updateRenderPath(){if(this.__.path){const t=this.__;t.__pathForRender=t.cornerRadius?nn.smooth(t.path,t.cornerRadius,t.cornerSmoothing):t.path,t.__useArrow&&Ya.addArrows(this,!t.cornerRadius)}}__drawRenderPath(t){t.beginPath(),this.__drawPathByData(t,this.__.__pathForRender)}__drawPath(t){t.beginPath(),this.__drawPathByData(t,this.__.path)}__drawPathByData(t,e){e?ys.drawPathByData(t,e):this.__drawPathByBox(t)}__drawPathByBox(t){const{x:e,y:i,width:s,height:n}=this.__layout.boxBounds;if(this.__.cornerRadius){const{cornerRadius:r}=this.__;t.roundRect(e,i,s,n,"number"==typeof r?[r]:r)}else t.rect(e,i,s,n)}animate(t,e,i,s){return Rt("animate")}killAnimate(t){}export(t,e){return Ga.export(this,t,e)}clone(t){const e=this.toJSON();return t&&Object.assign(e,t),wh.one(e)}static one(t,e,i,s,n){return Tt.get(t.tag||this.prototype.__tag,t,e,i,s,n)}static registerUI(){er()(this)}static registerData(t){Vn(t)(this.prototype)}static setEditConfig(t){}static setEditOuter(t){}static setEditInner(t){}destroy(){this.fill=this.stroke=null,this.__animate&&this.killAnimate(),super.destroy()}},Ft([Vn(th)],t.UI.prototype,"__",void 0),Ft([Fa()],t.UI.prototype,"zoomLayer",void 0),Ft([En("")],t.UI.prototype,"id",void 0),Ft([En("")],t.UI.prototype,"name",void 0),Ft([En("")],t.UI.prototype,"className",void 0),Ft([Wn("pass-through")],t.UI.prototype,"blendMode",void 0),Ft([Fn(1)],t.UI.prototype,"opacity",void 0),Ft([zn(!0)],t.UI.prototype,"visible",void 0),Ft([Wn(!1)],t.UI.prototype,"locked",void 0),Ft([Un(0)],t.UI.prototype,"zIndex",void 0),Ft([Yn(!1)],t.UI.prototype,"mask",void 0),Ft([Xn(!1)],t.UI.prototype,"eraser",void 0),Ft([Bn(0,!0)],t.UI.prototype,"x",void 0),Ft([Bn(0,!0)],t.UI.prototype,"y",void 0),Ft([Tn(100,!0)],t.UI.prototype,"width",void 0),Ft([Tn(100,!0)],t.UI.prototype,"height",void 0),Ft([Rn(1,!0)],t.UI.prototype,"scaleX",void 0),Ft([Rn(1,!0)],t.UI.prototype,"scaleY",void 0),Ft([Cn(0,!0)],t.UI.prototype,"rotation",void 0),Ft([Cn(0,!0)],t.UI.prototype,"skewX",void 0),Ft([Cn(0,!0)],t.UI.prototype,"skewY",void 0),Ft([Bn(0,!0)],t.UI.prototype,"offsetX",void 0),Ft([Bn(0,!0)],t.UI.prototype,"offsetY",void 0),Ft([Bn(0,!0)],t.UI.prototype,"scrollX",void 0),Ft([Bn(0,!0)],t.UI.prototype,"scrollY",void 0),Ft([Pn()],t.UI.prototype,"origin",void 0),Ft([Pn()],t.UI.prototype,"around",void 0),Ft([En(!1)],t.UI.prototype,"lazy",void 0),Ft([kn(1)],t.UI.prototype,"pixelRatio",void 0),Ft([Sn()],t.UI.prototype,"path",void 0),Ft([On()],t.UI.prototype,"windingRule",void 0),Ft([On(!0)],t.UI.prototype,"closed",void 0),Ft([Tn(0)],t.UI.prototype,"padding",void 0),Ft([En(!1)],t.UI.prototype,"draggable",void 0),Ft([En()],t.UI.prototype,"dragBounds",void 0),Ft([En(!1)],t.UI.prototype,"editable",void 0),Ft([Hn(!0)],t.UI.prototype,"hittable",void 0),Ft([Hn("path")],t.UI.prototype,"hitFill",void 0),Ft([In("path")],t.UI.prototype,"hitStroke",void 0),Ft([Hn(!1)],t.UI.prototype,"hitBox",void 0),Ft([Hn(!0)],t.UI.prototype,"hitChildren",void 0),Ft([Hn(!0)],t.UI.prototype,"hitSelf",void 0),Ft([Hn()],t.UI.prototype,"hitRadius",void 0),Ft([jn("")],t.UI.prototype,"cursor",void 0),Ft([Wn()],t.UI.prototype,"fill",void 0),Ft([In()],t.UI.prototype,"stroke",void 0),Ft([In("inside")],t.UI.prototype,"strokeAlign",void 0),Ft([In(1)],t.UI.prototype,"strokeWidth",void 0),Ft([In(!1)],t.UI.prototype,"strokeWidthFixed",void 0),Ft([In("none")],t.UI.prototype,"strokeCap",void 0),Ft([In("miter")],t.UI.prototype,"strokeJoin",void 0),Ft([In()],t.UI.prototype,"dashPattern",void 0),Ft([In()],t.UI.prototype,"dashOffset",void 0),Ft([In(10)],t.UI.prototype,"miterLimit",void 0),Ft([On(0)],t.UI.prototype,"cornerRadius",void 0),Ft([On()],t.UI.prototype,"cornerSmoothing",void 0),Ft([Aa()],t.UI.prototype,"shadow",void 0),Ft([Aa()],t.UI.prototype,"innerShadow",void 0),Ft([Aa()],t.UI.prototype,"blur",void 0),Ft([Aa()],t.UI.prototype,"backgroundBlur",void 0),Ft([Aa()],t.UI.prototype,"grayscale",void 0),Ft([En({})],t.UI.prototype,"data",void 0),Ft([Qn(t.Leaf.prototype.reset)],t.UI.prototype,"reset",null),t.UI=wh=Ft([tr(fh),tr(yh),Jn()],t.UI),t.Group=class extends t.UI{get __tag(){return"Group"}get isBranch(){return!0}constructor(t){super(t)}reset(t){this.__setBranch(),super.reset(t)}__setBranch(){this.children||(this.children=[])}set(t,e){if(t.children){const{children:i}=t;delete t.children,this.children?this.clear():this.__setBranch(),super.set(t,e),i.forEach((t=>this.add(t))),t.children=i}else super.set(t,e)}toJSON(t){const e=super.toJSON(t);return e.children=this.children.map((e=>e.toJSON(t))),e}pick(t,e){}addAt(t,e){this.add(t,e)}addAfter(t,e){this.add(t,this.children.indexOf(e)+1)}addBefore(t,e){this.add(t,this.children.indexOf(e))}add(t,e){}addMany(...t){}remove(t,e){}removeAll(t){}clear(){}},Ft([Vn(eh)],t.Group.prototype,"__",void 0),t.Group=Ft([tr(t.Branch),er()],t.Group);const bh=wt.get("Leafer");t.Leafer=xh=class extends t.Group{get __tag(){return"Leafer"}get isApp(){return!1}get app(){return this.parent||this}get isLeafer(){return!0}get imageReady(){return this.viewReady&&_n.isComplete}get layoutLocked(){return!this.layouter.running}get FPS(){return this.renderer?this.renderer.FPS:60}get cursorPoint(){return this.interaction&&this.interaction.hoverData||{x:this.width/2,y:this.height/2}}get clientBounds(){return this.canvas&&this.canvas.getClientBounds()}constructor(t,e){super(e),this.config={type:"design",start:!0,hittable:!0,smooth:!0,lazySpeard:100,zoom:{min:.01,max:256},move:{holdSpaceKey:!0,holdMiddleKey:!0,autoDistance:2}},this.leafs=0,this.__eventIds=[],this.__controllers=[],this.__readyWait=[],this.__viewReadyWait=[],this.__viewCompletedWait=[],this.__nextRenderWait=[],this.userConfig=t,t&&(t.view||t.width)&&this.init(t),xh.list.add(this)}init(t,e){if(this.canvas)return;let s;this.__setLeafer(this),t&&Mt.assign(this.config,t);const{config:n}=this;this.initType(n.type);const r=this.canvas=i.canvas(n);this.__controllers.push(this.renderer=i.renderer(this,r,n),this.watcher=i.watcher(this,n),this.layouter=i.layouter(this,n)),this.isApp&&this.__setApp(),this.__checkAutoLayout(n,e),this.view=r.view,e?(this.__bindApp(e),s=e.running):(this.selector=i.selector(this),this.interaction=i.interaction(this,r,this.selector,n),this.interaction&&(this.__controllers.unshift(this.interaction),this.hitCanvasManager=i.hitCanvasManager()),this.canvasManager=new Dt,s=n.start),this.hittable=n.hittable,this.fill=n.fill,this.canvasManager.add(r),this.__listenEvents(),s&&(this.__startTimer=setTimeout(this.start.bind(this))),Cr.run(this.__initWait),this.onInit()}onInit(){}initType(t){}set(t){this.waitInit((()=>{super.set(t)}))}start(){clearTimeout(this.__startTimer),!this.running&&this.canvas&&(this.running=!0,this.ready?this.emitLeafer(jr.RESTART):this.emitLeafer(jr.START),this.__controllers.forEach((t=>t.start())),this.isApp||this.renderer.render())}stop(){clearTimeout(this.__startTimer),this.running&&this.canvas&&(this.__controllers.forEach((t=>t.stop())),this.running=!1,this.emitLeafer(jr.STOP))}unlockLayout(){this.layouter.start(),this.updateLayout()}lockLayout(){this.updateLayout(),this.layouter.stop()}resize(t){const e=Mt.copyAttrs({},t,Gt);Object.keys(e).forEach((t=>this[t]=e[t]))}forceRender(t){this.renderer.addBlock(t?new lt(t):this.canvas.bounds),this.viewReady&&this.renderer.update()}updateCursor(t){const e=this.interaction;e&&(t?e.setCursor(t):e.updateCursor())}updateLazyBounds(){this.lazyBounds=this.canvas.bounds.clone().spread(this.config.lazySpeard)}__doResize(t){const{canvas:e}=this;if(!e||e.isSameSize(t))return;const i=Mt.copyAttrs({},this.canvas,Gt);e.resize(t),this.updateLazyBounds(),this.__onResize(new Ur(t,i))}__onResize(t){this.emitEvent(t),Mt.copyAttrs(this.__,t,Gt),t.width&&t.height||bh.warn("w = 0 or h = 0"),setTimeout((()=>{this.canvasManager&&this.canvasManager.clearRecycled()}),0)}__setApp(){}__bindApp(t){this.selector=t.selector,this.interaction=t.interaction,this.canvasManager=t.canvasManager,this.hitCanvasManager=t.hitCanvasManager}__setLeafer(t){this.leafer=t,this.__level=1}__checkAutoLayout(t,e){e||(t.width&&t.height||(this.autoLayout=new ct(t)),this.canvas.startAutoLayout(this.autoLayout,this.__onResize.bind(this)))}__setAttr(t,e){return this.canvas&&(Gt.includes(t)?(e||bh.warn(t+" is 0"),this.__changeCanvasSize(t,e)):"fill"===t?this.__changeFill(e):"hittable"===t?this.parent||(this.canvas.hittable=e):"zIndex"===t&&(this.canvas.zIndex=e,setTimeout((()=>this.parent&&this.parent.__updateSortChildren())))),super.__setAttr(t,e)}__getAttr(t){return this.canvas&&Gt.includes(t)?this.canvas[t]:super.__getAttr(t)}__changeCanvasSize(t,e){const i=Mt.copyAttrs({},this.canvas,Gt);i[t]=this.config[t]=e,e&&this.canvas.stopAutoLayout(),this.__doResize(i)}__changeFill(t){this.config.fill=t,this.canvas.allowBackgroundColor?this.canvas.backgroundColor=t:this.forceRender()}__onCreated(){this.created=!0}__onReady(){this.ready||(this.ready=!0,this.emitLeafer(jr.BEFORE_READY),this.emitLeafer(jr.READY),this.emitLeafer(jr.AFTER_READY),Cr.run(this.__readyWait))}__onViewReady(){this.viewReady||(this.viewReady=!0,this.emitLeafer(jr.VIEW_READY),Cr.run(this.__viewReadyWait))}__onNextRender(){if(this.viewReady){Cr.run(this.__nextRenderWait);const{imageReady:t}=this;t&&!this.viewCompleted&&this.__checkViewCompleted(),t||(this.viewCompleted=!1)}}__checkViewCompleted(t=!0){this.nextRender((()=>{this.imageReady&&(t&&this.emitLeafer(jr.VIEW_COMPLETED),Cr.run(this.__viewCompletedWait),this.viewCompleted=!0)}))}__onWatchData(){this.watcher.childrenChanged&&this.interaction&&this.nextRender((()=>this.interaction.updateCursor()))}waitInit(t,e){e&&(t=t.bind(e)),this.__initWait||(this.__initWait=[]),this.canvas?t():this.__initWait.push(t)}waitReady(t,e){e&&(t=t.bind(e)),this.ready?t():this.__readyWait.push(t)}waitViewReady(t,e){e&&(t=t.bind(e)),this.viewReady?t():this.__viewReadyWait.push(t)}waitViewCompleted(t,e){e&&(t=t.bind(e)),this.__viewCompletedWait.push(t),this.viewCompleted?this.__checkViewCompleted(!1):this.running||this.start()}nextRender(t,e,i){e&&(t=t.bind(e));const s=this.__nextRenderWait;if(i){for(let e=0;e<s.length;e++)if(s[e]===t){s.splice(e,1);break}}else s.push(t)}zoom(t,e,i){return Rt("view")}getValidMove(t,e){return{x:t,y:e}}getValidScale(t){return t}getWorldPointByClient(t,e){return this.interaction&&this.interaction.getLocal(t,e)}getPagePointByClient(t,e){return this.getPagePoint(this.getWorldPointByClient(t,e))}updateClientBounds(){this.canvas&&this.canvas.updateClientBounds()}receiveEvent(t){}__checkUpdateLayout(){this.__layout.update()}emitLeafer(t){this.emitEvent(new jr(t,this))}__listenEvents(){const t=Bt.start("FirstCreate "+this.innerName);this.once(jr.START,(()=>Bt.end(t))),this.once(Xr.START,(()=>this.updateLazyBounds())),this.once(Xr.END,(()=>this.__onReady())),this.once(Hr.START,(()=>this.__onCreated())),this.once(Hr.END,(()=>this.__onViewReady())),this.__eventIds.push(this.on_(Yr.DATA,this.__onWatchData,this),this.on_(Hr.NEXT,this.__onNextRender,this),this.on_(Xr.CHECK_UPDATE,this.__checkUpdateLayout,this))}__removeListenEvents(){this.off_(this.__eventIds),this.__eventIds.length=0}destroy(t){const e=()=>{if(!this.destroyed){xh.list.remove(this);try{this.stop(),this.emitEvent(new jr(jr.END,this)),this.__removeListenEvents(),this.__controllers.forEach((t=>!(this.parent&&t===this.interaction)&&t.destroy())),this.__controllers.length=0,this.parent||(this.selector&&this.selector.destroy(),this.hitCanvasManager&&this.hitCanvasManager.destroy(),this.canvasManager.destroy()),this.canvas.destroy(),this.config.view=this.view=null,this.userConfig&&(this.userConfig.view=null),super.destroy(),setTimeout((()=>{_n.clearRecycled()}),100)}catch(t){bh.error(t)}}};t?e():setTimeout(e)}},t.Leafer.list=new na,Ft([Vn(sh)],t.Leafer.prototype,"__",void 0),Ft([Tn()],t.Leafer.prototype,"pixelRatio",void 0),t.Leafer=xh=Ft([er()],t.Leafer),t.Rect=class extends t.UI{get __tag(){return"Rect"}constructor(t){super(t)}},Ft([Vn(oh)],t.Rect.prototype,"__",void 0),t.Rect=Ft([tr(mh),Jn(),er()],t.Rect);const{copy:Eh,add:Bh,includes:Ph}=rt,Rh=t.Rect.prototype,Ch=t.Group.prototype,Th={};t.Box=class extends t.Group{get __tag(){return"Box"}get isBranchLeaf(){return!0}constructor(t){super(t),this.__layout.renderChanged||this.__layout.renderChange()}__updateStrokeSpread(){return 0}__updateRectRenderSpread(){return 0}__updateRenderSpread(){return this.__updateRectRenderSpread()||-1}__updateRectBoxBounds(){}__updateBoxBounds(t){const e=this.__;if(this.children.length)if(e.__autoSide){super.__updateBoxBounds();const{boxBounds:t}=this.__layout;e.__autoSize||(e.__autoWidth?(t.width+=t.x,t.x=0,t.height=e.height,t.y=0):(t.height+=t.y,t.y=0,t.width=e.width,t.x=0)),this.__updateNaturalSize()}else this.__updateRectBoxBounds();else this.__updateRectBoxBounds()}__updateStrokeBounds(){}__updateRenderBounds(){let t;const{renderBounds:e}=this.__layout;this.children.length?(super.__updateRenderBounds(),Eh(Th,e),this.__updateRectRenderBounds(),t=!Ph(e,Th),t&&"hide"!==this.__.overflow&&Bh(e,Th)):this.__updateRectRenderBounds(),!this.isOverflow!=!t&&(this.isOverflow=t)}__updateRectRenderBounds(){}__updateRectChange(){}__updateChange(){super.__updateChange(),this.__updateRectChange()}__renderRect(t,e){}__renderGroup(t,e){}__render(t,e){this.__.__drawAfterFill?this.__renderRect(t,e):(this.__renderRect(t,e),this.children.length&&this.__renderGroup(t,e))}__drawContent(t,e){this.__renderGroup(t,e),this.__.__hasStroke&&(t.setWorld(this.__nowWorld),this.__drawRenderPath(t))}},Ft([Vn(ih)],t.Box.prototype,"__",void 0),Ft([En(!1)],t.Box.prototype,"resizeChildren",void 0),Ft([En(!1)],t.Box.prototype,"textBox",void 0),Ft([An("show")],t.Box.prototype,"overflow",void 0),Ft([Qn(Rh.__updateStrokeSpread)],t.Box.prototype,"__updateStrokeSpread",null),Ft([Qn(Rh.__updateRenderSpread)],t.Box.prototype,"__updateRectRenderSpread",null),Ft([Qn(Rh.__updateBoxBounds)],t.Box.prototype,"__updateRectBoxBounds",null),Ft([Qn(Rh.__updateStrokeBounds)],t.Box.prototype,"__updateStrokeBounds",null),Ft([Qn(Rh.__updateRenderBounds)],t.Box.prototype,"__updateRectRenderBounds",null),Ft([Qn(Rh.__updateChange)],t.Box.prototype,"__updateRectChange",null),Ft([Qn(Rh.__render)],t.Box.prototype,"__renderRect",null),Ft([Qn(Ch.__render)],t.Box.prototype,"__renderGroup",null),t.Box=Ft([Jn(),er()],t.Box),t.Frame=class extends t.Box{get __tag(){return"Frame"}get isFrame(){return!0}constructor(t){super(t)}},Ft([Vn(nh)],t.Frame.prototype,"__",void 0),Ft([Wn("#FFFFFF")],t.Frame.prototype,"fill",void 0),Ft([An("hide")],t.Frame.prototype,"overflow",void 0),t.Frame=Ft([er()],t.Frame);const{moveTo:kh,closePath:Lh,ellipse:Sh}=zi;t.Ellipse=class extends t.UI{get __tag(){return"Ellipse"}constructor(t){super(t)}__updatePath(){const{width:t,height:i,innerRadius:s,startAngle:n,endAngle:r}=this.__,o=t/2,a=i/2,h=this.__.path=[];s?(n||r?(s<1&&Sh(h,o,a,o*s,a*s,0,n,r,!1),Sh(h,o,a,o,a,0,r,n,!0),s<1&&Lh(h)):(s<1&&(Sh(h,o,a,o*s,a*s),kh(h,t,a)),Sh(h,o,a,o,a,0,360,0,!0)),e.ellipseToCurve&&(this.__.path=this.getPath(!0))):n||r?(kh(h,o,a),Sh(h,o,a,o,a,0,n,r,!1),Lh(h)):Sh(h,o,a,o,a)}},Ft([Vn(ah)],t.Ellipse.prototype,"__",void 0),Ft([On(0)],t.Ellipse.prototype,"innerRadius",void 0),Ft([On(0)],t.Ellipse.prototype,"startAngle",void 0),Ft([On(0)],t.Ellipse.prototype,"endAngle",void 0),t.Ellipse=Ft([er()],t.Ellipse);const{moveTo:Oh,lineTo:Dh,drawPoints:Mh}=zi,{rotate:Ih,getAngle:Ah,getDistance:Wh,defaultPoint:Fh}=D,{toBounds:zh}=qs;t.Line=class extends t.UI{get __tag(){return"Line"}get toPoint(){const{width:t,rotation:e}=this.__,i={x:0,y:0};return t&&(i.x=t),e&&Ih(i,e),i}set toPoint(t){this.width=Wh(Fh,t),this.rotation=Ah(Fh,t),this.height&&(this.height=0)}constructor(t){super(t)}__updatePath(){const t=this.__,e=t.path=[];t.points?Mh(e,t.points,!1,t.closed):(Oh(e,0,0),Dh(e,this.width,0))}__updateRenderPath(){const t=this.__;!this.pathInputed&&t.points&&t.curve?(Mh(t.__pathForRender=[],t.points,t.curve,t.closed),t.__useArrow&&Ya.addArrows(this,!1)):super.__updateRenderPath()}__updateBoxBounds(){this.points?zh(this.__.__pathForRender,this.__layout.boxBounds):super.__updateBoxBounds()}},Ft([Vn(rh)],t.Line.prototype,"__",void 0),Ft([Dn("center")],t.Line.prototype,"strokeAlign",void 0),Ft([Tn(0)],t.Line.prototype,"height",void 0),Ft([On()],t.Line.prototype,"points",void 0),Ft([On(0)],t.Line.prototype,"curve",void 0),Ft([On(!1)],t.Line.prototype,"closed",void 0),t.Line=Ft([er()],t.Line);const{sin:Nh,cos:Uh,PI:Yh}=Math,{moveTo:Xh,lineTo:Hh,closePath:jh,drawPoints:Vh}=zi,Gh=t.Line.prototype;t.Polygon=class extends t.UI{get __tag(){return"Polygon"}constructor(t){super(t)}__updatePath(){const t=this.__.path=[];if(this.__.points)Vh(t,this.__.points,!1,!0);else{const{width:e,height:i,sides:s}=this.__,n=e/2,r=i/2;Xh(t,n,0);for(let e=1;e<s;e++)Hh(t,n+n*Nh(2*e*Yh/s),r-r*Uh(2*e*Yh/s))}jh(t)}__updateRenderPath(){}__updateBoxBounds(){}},Ft([Vn(hh)],t.Polygon.prototype,"__",void 0),Ft([On(3)],t.Polygon.prototype,"sides",void 0),Ft([On()],t.Polygon.prototype,"points",void 0),Ft([On(0)],t.Polygon.prototype,"curve",void 0),Ft([Qn(Gh.__updateRenderPath)],t.Polygon.prototype,"__updateRenderPath",null),Ft([Qn(Gh.__updateBoxBounds)],t.Polygon.prototype,"__updateBoxBounds",null),t.Polygon=Ft([Jn(),er()],t.Polygon);const{sin:Kh,cos:qh,PI:Zh}=Math,{moveTo:Qh,lineTo:Jh,closePath:$h}=zi;t.Star=class extends t.UI{get __tag(){return"Star"}constructor(t){super(t)}__updatePath(){const{width:t,height:e,corners:i,innerRadius:s}=this.__,n=t/2,r=e/2,o=this.__.path=[];Qh(o,n,0);for(let t=1;t<2*i;t++)Jh(o,n+(t%2==0?n:n*s)*Kh(t*Zh/i),r-(t%2==0?r:r*s)*qh(t*Zh/i));$h(o)}},Ft([Vn(lh)],t.Star.prototype,"__",void 0),Ft([On(5)],t.Star.prototype,"corners",void 0),Ft([On(.382)],t.Star.prototype,"innerRadius",void 0),t.Star=Ft([er()],t.Star),t.Image=class extends t.Rect{get __tag(){return"Image"}get ready(){return!!this.image&&this.image.ready}constructor(t){super(t),this.on(Nr.LOADED,(t=>{"fill"===t.attrName&&t.attrValue.url===this.url&&(this.image=t.image)}))}destroy(){this.image=null,super.destroy()}},Ft([Vn(ph)],t.Image.prototype,"__",void 0),Ft([Tn("")],t.Image.prototype,"url",void 0),t.Image=Ft([er()],t.Image);const tl=t.Image;t.Canvas=class extends t.Rect{get __tag(){return"Canvas"}get ready(){return!this.url}constructor(t){super(t),this.canvas=i.canvas(this.__),this.context=this.canvas.context,t&&t.url&&this.drawImage(t.url)}drawImage(t){new yn({url:t}).load((t=>{this.context.drawImage(t.view,0,0),this.url=void 0,this.paint(),this.emitEvent(new Nr(Nr.LOADED,{image:t}))}))}draw(t,e,i,s){const n=new N(t.worldTransform).invert(),r=new N;e&&r.translate(e.x,e.y),i&&("number"==typeof i?r.scale(i):r.scale(i.x,i.y)),s&&r.rotate(s),n.multiplyParent(r),t.__render(this.canvas,{matrix:n.withScale()}),this.paint()}paint(){this.forceRender()}__drawContent(t,e){const{width:i,height:s}=this.__,{view:n}=this.canvas;t.drawImage(n,0,0,n.width,n.height,0,0,i,s)}__updateSize(){const{canvas:t}=this;if(t){const{smooth:e}=this.__;t.smooth!==e&&(t.smooth=e),t.resize(this.__)}}destroy(){this.canvas&&(this.canvas.destroy(),this.canvas=this.context=null),super.destroy()}},Ft([Vn(gh)],t.Canvas.prototype,"__",void 0),Ft([Wa(100)],t.Canvas.prototype,"width",void 0),Ft([Wa(100)],t.Canvas.prototype,"height",void 0),Ft([Wa(1)],t.Canvas.prototype,"pixelRatio",void 0),Ft([Wa(!0)],t.Canvas.prototype,"smooth",void 0),Ft([Wa()],t.Canvas.prototype,"contextSettings",void 0),t.Canvas=Ft([er()],t.Canvas);const{copyAndSpread:el,includes:il,isSame:sl,spread:nl,setList:rl}=rt;t.Text=class extends t.UI{get __tag(){return"Text"}get textDrawData(){return this.__layout.update(),this.__.__textDrawData}constructor(t){super(t)}__drawHitPath(t){const{__lineHeight:e,fontSize:i,__baseLine:s,__textDrawData:n}=this.__;t.beginPath(),this.__.__letterSpacing<0?this.__drawPathByData(t):n.rows.forEach((n=>t.rect(n.x,n.y-s,n.width,e<i?i:e)))}__drawPathByData(t,e){const{x:i,y:s,width:n,height:r}=this.__layout.boxBounds;t.rect(i,s,n,r)}__drawRenderPath(t){t.font=this.__.__font}__updateTextDrawData(){const t=this.__,{lineHeight:e,letterSpacing:i,fontFamily:s,fontSize:n,fontWeight:r,italic:o,textCase:a,textOverflow:l,padding:d}=t;t.__lineHeight=Ua.number(e,n),t.__letterSpacing=Ua.number(i,n),t.__padding=d?h.fourNumber(d):void 0,t.__baseLine=t.__lineHeight-(t.__lineHeight-.7*n)/2,t.__font=`${o?"italic ":""}${"small-caps"===a?"small-caps ":""}${"normal"!==r?r+" ":""}${n}px ${s}`,t.__clipText="show"!==l&&!t.__autoSize,t.__textDrawData=za.getDrawData(t.text,this.__)}__updateBoxBounds(){const t=this.__,e=this.__layout,{fontSize:i,italic:s,padding:n,__autoWidth:r,__autoHeight:o}=t;this.__updateTextDrawData();const{bounds:a}=t.__textDrawData,h=e.boxBounds;if(t.__lineHeight<i&&nl(a,i/2),r||o){if(h.x=r?a.x:0,h.y=o?a.y:0,h.width=r?a.width:t.width,h.height=o?a.height:t.height,n){const[e,i,s,n]=t.__padding;r&&(h.x-=n,h.width+=i+n),o&&(h.y-=e,h.height+=s+e)}this.__updateNaturalSize()}else super.__updateBoxBounds();s&&(h.width+=.16*i);const l=il(h,a)?h:a;sl(l,e.contentBounds)?t.__textBoxBounds=l:(e.contentBounds=l,e.renderChanged=!0,rl(t.__textBoxBounds={},[h,a]))}__updateRenderSpread(){let t=super.__updateRenderSpread();return t||(t=this.__layout.boxBounds===this.__layout.contentBounds?0:1),t}__updateRenderBounds(){el(this.__layout.renderBounds,this.__.__textBoxBounds,this.__layout.renderSpread)}},Ft([Vn(_h)],t.Text.prototype,"__",void 0),Ft([Tn(0)],t.Text.prototype,"width",void 0),Ft([Tn(0)],t.Text.prototype,"height",void 0),Ft([En(!1)],t.Text.prototype,"resizeFontSize",void 0),Ft([Wn("#000000")],t.Text.prototype,"fill",void 0),Ft([Dn("outside")],t.Text.prototype,"strokeAlign",void 0),Ft([Hn("all")],t.Text.prototype,"hitFill",void 0),Ft([Tn("")],t.Text.prototype,"text",void 0),Ft([Tn("L")],t.Text.prototype,"fontFamily",void 0),Ft([Tn(12)],t.Text.prototype,"fontSize",void 0),Ft([Tn("normal")],t.Text.prototype,"fontWeight",void 0),Ft([Tn(!1)],t.Text.prototype,"italic",void 0),Ft([Tn("none")],t.Text.prototype,"textCase",void 0),Ft([Tn("none")],t.Text.prototype,"textDecoration",void 0),Ft([Tn(0)],t.Text.prototype,"letterSpacing",void 0),Ft([Tn({type:"percent",value:1.5})],t.Text.prototype,"lineHeight",void 0),Ft([Tn(0)],t.Text.prototype,"paraIndent",void 0),Ft([Tn(0)],t.Text.prototype,"paraSpacing",void 0),Ft([Tn("left")],t.Text.prototype,"textAlign",void 0),Ft([Tn("top")],t.Text.prototype,"verticalAlign",void 0),Ft([Tn(!0)],t.Text.prototype,"autoSizeAlign",void 0),Ft([Tn("normal")],t.Text.prototype,"textWrap",void 0),Ft([Tn("show")],t.Text.prototype,"textOverflow",void 0),t.Text=Ft([er()],t.Text),t.Path=class extends t.UI{get __tag(){return"Path"}constructor(t){super(t)}},Ft([Vn(dh)],t.Path.prototype,"__",void 0),Ft([Dn("center")],t.Path.prototype,"strokeAlign",void 0),t.Path=Ft([er()],t.Path),t.Pen=class extends t.Group{get __tag(){return"Pen"}constructor(t){super(t)}setStyle(e){const i=this.pathElement=new t.Path(e);return this.pathStyle=e,this.__path=i.path||(i.path=[]),this.add(i),this}beginPath(){return this}moveTo(t,e){return this}lineTo(t,e){return this}bezierCurveTo(t,e,i,s,n,r){return this}quadraticCurveTo(t,e,i,s){return this}closePath(){return this}rect(t,e,i,s){return this}roundRect(t,e,i,s,n){return this}ellipse(t,e,i,s,n,r,o,a){return this}arc(t,e,i,s,n,r){return this}arcTo(t,e,i,s,n){return this}drawEllipse(t,e,i,s,n,r,o,a){return this}drawArc(t,e,i,s,n,r){return this}drawPoints(t,e,i){return this}clearPath(){return this}paint(){this.pathElement.__layout.boxChanged||this.pathElement.forceUpdate("path")}},Ft([Vn(ch)],t.Pen.prototype,"__",void 0),Ft([(t,e)=>{vn(t,e,{get(){return this.__path}})}],t.Pen.prototype,"path",void 0),t.Pen=Ft([tr(is,["set","path","paint"]),er()],t.Pen),t.App=class extends t.Leafer{get __tag(){return"App"}get isApp(){return!0}constructor(t,e){super(t,e)}init(t,e){if(super.init(t,e),t){const{ground:e,tree:s,sky:n,editor:r}=t;e&&(this.ground=this.addLeafer(e)),(s||r)&&(this.tree=this.addLeafer(s)),(n||r)&&(this.sky=this.addLeafer(n||{type:"draw",usePartRender:!1})),r&&this.sky.add(this.editor=i.editor(r))}}__setApp(){const{canvas:t}=this,{realCanvas:e,view:i}=this.config;e||i===this.canvas.view||!t.parentView?this.realCanvas=!0:t.unrealCanvas(),this.leafer=this,this.watcher.disable(),this.layouter.disable(),this.__eventIds.push(this.on_(zr.CHANGE,this.__onPropertyChange,this))}start(){super.start(),this.children.forEach((t=>t.start()))}stop(){this.children.forEach((t=>t.stop())),super.stop()}unlockLayout(){super.unlockLayout(),this.children.forEach((t=>t.unlockLayout()))}lockLayout(){super.lockLayout(),this.children.forEach((t=>t.lockLayout()))}forceRender(t){this.children.forEach((e=>e.forceRender(t)))}addLeafer(e){const i=new t.Leafer(e);return this.add(i),i}add(t,e){if(!t.view){if(this.realCanvas&&!this.canvas.bounds)return void setTimeout((()=>this.add(t,e)),10);t.init(this.__getChildConfig(t.userConfig),this)}super.add(t,e),void 0!==e&&(t.canvas.childIndex=e),this.__listenChildEvents(t)}__onPropertyChange(){wt.showHitView&&this.children.forEach((t=>t.forceUpdate("surface")))}__onCreated(){this.created=this.children.every((t=>t.created))}__onReady(){this.children.every((t=>t.ready))&&super.__onReady()}__onViewReady(){this.children.every((t=>t.viewReady))&&super.__onViewReady()}__onChildRenderEnd(t){this.renderer.addBlock(t.renderBounds),this.viewReady&&this.renderer.update()}__render(t,e){if(t.context){const i=e.matrix;i&&t.setTransform(i.a,i.b,i.c,i.d,i.e,i.f),this.children.forEach((e=>t.copyWorld(e.canvas)))}}__onResize(t){this.children.forEach((e=>e.resize(t))),super.__onResize(t)}__checkUpdateLayout(){this.children.forEach((t=>t.__layout.update()))}__getChildConfig(t){let e=Object.assign({},this.config);return e.hittable=e.realCanvas=void 0,t&&Mt.assign(e,t),this.autoLayout&&Mt.copyAttrs(e,this,Gt),e.view=this.realCanvas?void 0:this.view,e.fill=void 0,e}__listenChildEvents(t){t.once(Xr.END,(()=>this.__onReady())),t.once(Hr.START,(()=>this.__onCreated())),t.once(Hr.END,(()=>this.__onViewReady())),this.realCanvas&&this.__eventIds.push(t.on_(Hr.END,this.__onChildRenderEnd,this))}},t.App=Ft([er()],t.App);const ol={},al={isHoldSpaceKey:()=>al.isHold("Space"),isHold:t=>ol[t],setDownCode(t){ol[t]||(ol[t]=!0)},setUpCode(t){ol[t]=!1}},hl={LEFT:1,RIGHT:2,MIDDLE:4,defaultLeft(t){t.buttons||(t.buttons=1)},left:t=>1===t.buttons,right:t=>2===t.buttons,middle:t=>4===t.buttons};class ll extends Wr{get spaceKey(){return al.isHoldSpaceKey()}get left(){return hl.left(this)}get right(){return hl.right(this)}get middle(){return hl.middle(this)}constructor(t){super(t.type),this.bubbles=!0,Object.assign(this,t)}getBoxPoint(t){return t||(t=this.current),t.getBoxPoint(this)}getInnerPoint(t){return t||(t=this.current),t.getInnerPoint(this)}getLocalPoint(t){return t||(t=this.current),t.getLocalPoint(this)}getPagePoint(){return this.current.getPagePoint(this)}getInner(t){return this.getInnerPoint(t)}getLocal(t){return this.getLocalPoint(t)}getPage(){return this.getPagePoint()}static changeName(t,e){St.changeName(t,e)}}t.PointerEvent=class extends ll{},t.PointerEvent.POINTER="pointer",t.PointerEvent.BEFORE_DOWN="pointer.before_down",t.PointerEvent.BEFORE_MOVE="pointer.before_move",t.PointerEvent.BEFORE_UP="pointer.before_up",t.PointerEvent.DOWN="pointer.down",t.PointerEvent.MOVE="pointer.move",t.PointerEvent.UP="pointer.up",t.PointerEvent.OVER="pointer.over",t.PointerEvent.OUT="pointer.out",t.PointerEvent.ENTER="pointer.enter",t.PointerEvent.LEAVE="pointer.leave",t.PointerEvent.TAP="tap",t.PointerEvent.DOUBLE_TAP="double_tap",t.PointerEvent.CLICK="click",t.PointerEvent.DOUBLE_CLICK="double_click",t.PointerEvent.LONG_PRESS="long_press",t.PointerEvent.LONG_TAP="long_tap",t.PointerEvent.MENU="pointer.menu",t.PointerEvent.MENU_TAP="pointer.menu_tap",t.PointerEvent=Ft([ir()],t.PointerEvent);const dl=t.PointerEvent,cl={};t.DragEvent=class extends t.PointerEvent{static setList(t){this.list=t instanceof na?t:new na(t)}static setData(t){this.data=t}static getValidMove(t,e,i){const{draggable:s,dragBounds:n,x:r,y:o}=t,a=t.getLocalPoint(i,null,!0);return a.x+=e.x-r,a.y+=e.y-o,n&&this.getMoveInDragBounds(t.__local,"parent"===n?t.parent.boxBounds:n,a,!0),"x"===s&&(a.y=0),"y"===s&&(a.x=0),a}static getMoveInDragBounds(t,e,i,s){const n=t.x+i.x,r=t.y+i.y,o=n+t.width,a=r+t.height,h=e.x+e.width,l=e.y+e.height;return s||(i=Object.assign({},i)),rt.includes(t,e)?(n>e.x?i.x+=e.x-n:o<h&&(i.x+=h-o),r>e.y?i.y+=e.y-r:a<l&&(i.y+=l-a)):(n<e.x?i.x+=e.x-n:o>h&&(i.x+=h-o),r<e.y?i.y+=e.y-r:a>l&&(i.y+=l-a)),i}getPageMove(t){return this.assignMove(t),this.current.getPagePoint(cl,null,!0)}getInnerMove(t,e){return t||(t=this.current),this.assignMove(e),t.getInnerPoint(cl,null,!0)}getLocalMove(t,e){return t||(t=this.current),this.assignMove(e),t.getLocalPoint(cl,null,!0)}getPageTotal(){return this.getPageMove(!0)}getInnerTotal(t){return this.getInnerMove(t,!0)}getLocalTotal(t){return this.getLocalMove(t,!0)}getPageBounds(){const t=this.getPageTotal(),e=this.getPagePoint(),i={};return rt.set(i,e.x-t.x,e.y-t.y,t.x,t.y),rt.unsign(i),i}assignMove(t){cl.x=t?this.totalX:this.moveX,cl.y=t?this.totalY:this.moveY}},t.DragEvent.BEFORE_DRAG="drag.before_drag",t.DragEvent.START="drag.start",t.DragEvent.DRAG="drag",t.DragEvent.END="drag.end",t.DragEvent.OVER="drag.over",t.DragEvent.OUT="drag.out",t.DragEvent.ENTER="drag.enter",t.DragEvent.LEAVE="drag.leave",t.DragEvent=Ft([ir()],t.DragEvent);const ul=t.DragEvent;function _l(e){e.isApp||e.__eventIds.push(e.on_(t.MoveEvent.BEFORE_MOVE,(t=>{e.zoomLayer.move(e.getValidMove(t.moveX,t.moveY))})),e.on_(t.ZoomEvent.BEFORE_ZOOM,(t=>{const{zoomLayer:i}=e,s=e.getValidScale(t.scale);1!==s&&(D.scaleOf(i,t,s),i.scale=i.__.scaleX*s)})))}t.DropEvent=class extends t.PointerEvent{static setList(e){t.DragEvent.setList(e)}static setData(e){t.DragEvent.setData(e)}},t.DropEvent.DROP="drop",t.DropEvent=Ft([ir()],t.DropEvent),t.MoveEvent=class extends t.DragEvent{},t.MoveEvent.BEFORE_MOVE="move.before_move",t.MoveEvent.START="move.start",t.MoveEvent.MOVE="move",t.MoveEvent.END="move.end",t.MoveEvent=Ft([ir()],t.MoveEvent),t.RotateEvent=class extends ll{},t.RotateEvent.BEFORE_ROTATE="rotate.before_rotate",t.RotateEvent.START="rotate.start",t.RotateEvent.ROTATE="rotate",t.RotateEvent.END="rotate.end",t.RotateEvent=Ft([ir()],t.RotateEvent),t.SwipeEvent=class extends t.DragEvent{},t.SwipeEvent.SWIPE="swipe",t.SwipeEvent.LEFT="swipe.left",t.SwipeEvent.RIGHT="swipe.right",t.SwipeEvent.UP="swipe.up",t.SwipeEvent.DOWN="swipe.down",t.SwipeEvent=Ft([ir()],t.SwipeEvent),t.ZoomEvent=class extends ll{},t.ZoomEvent.BEFORE_ZOOM="zoom.before_zoom",t.ZoomEvent.START="zoom.start",t.ZoomEvent.ZOOM="zoom",t.ZoomEvent.END="zoom.end",t.ZoomEvent=Ft([ir()],t.ZoomEvent),t.KeyEvent=class extends ll{},t.KeyEvent.DOWN="key.down",t.KeyEvent.HOLD="key.hold",t.KeyEvent.UP="key.up",t.KeyEvent=Ft([ir()],t.KeyEvent);const pl=wt.get("LeaferTypeCreator"),gl={list:{},register(t,e){fl[t]?pl.repeat(t):fl[t]=e},run(t,e){const i=fl[t];i&&i(e)}},{list:fl,register:yl}=gl;yl("design",_l),yl("document",(function(t){_l(t);const{move:e,zoom:i}=t.config;e.scroll="limit",i.min=1})),yl("block",(function(t){const{config:e}=t;(e.wheel||(e.wheel={})).preventDefault=!1,(e.touch||(e.touch={})).preventDefault="auto"}));const vl=t.Leafer.prototype;vl.initType=function(t){gl.run(t,this)},vl.getValidMove=function(t,e){const{scroll:i,disabled:s}=this.app.config.move;if(i&&(Math.abs(t)>Math.abs(e)?e=0:t=0,"limit"===i)){const{x:i,y:s,width:n,height:r}=new lt(this.__world).addPoint(this.zoomLayer),o=i+n-this.width,a=s+r-this.height;i>=0&&o<=0?t=0:t>0?i+t>0&&(t=-i):t<0&&o+t<0&&(t=-o),s>=0&&a<=0?e=0:e>0?s+e>0&&(e=-s):e<0&&a+e<0&&(e=-a)}return{x:s?0:t,y:s?0:e}},vl.getValidScale=function(t){const{scaleX:e}=this.zoomLayer.__,{min:i,max:s,disabled:n}=this.app.config.zoom,r=Math.abs(e*t);return r<i?t=i/e:r>s&&(t=s/e),n?1:t};class ml{get transforming(){return!!(this.moveData||this.zoomData||this.rotateData)}constructor(t){this.interaction=t}move(e){const{interaction:i}=this;if(e.moveType||(e.moveType="move"),!this.moveData){const{path:s}=i.selector.getByPoint(e,i.hitRadius);e.path=s,this.moveData=Object.assign(Object.assign({},e),{moveX:0,moveY:0}),i.cancelHover(),i.emit(t.MoveEvent.START,this.moveData)}e.path=this.moveData.path,i.emit(t.MoveEvent.BEFORE_MOVE,e),i.emit(t.MoveEvent.MOVE,e),this.transformEndWait()}zoom(e){const{interaction:i}=this;if(!this.zoomData){const{path:s}=i.selector.getByPoint(e,i.hitRadius);e.path=s,this.zoomData=Object.assign(Object.assign({},e),{scale:1}),i.cancelHover(),i.emit(t.ZoomEvent.START,this.zoomData)}e.path=this.zoomData.path,i.emit(t.ZoomEvent.BEFORE_ZOOM,e),i.emit(t.ZoomEvent.ZOOM,e),this.transformEndWait()}rotate(e){const{interaction:i}=this;if(!this.rotateData){const{path:s}=i.selector.getByPoint(e,i.hitRadius);e.path=s,this.rotateData=Object.assign(Object.assign({},e),{rotation:0}),i.cancelHover(),i.emit(t.RotateEvent.START,this.rotateData)}e.path=this.rotateData.path,i.emit(t.RotateEvent.BEFORE_ROTATE,e),i.emit(t.RotateEvent.ROTATE,e),this.transformEndWait()}transformEndWait(){clearTimeout(this.transformTimer),this.transformTimer=setTimeout((()=>{this.transformEnd()}),this.interaction.config.pointer.transformTime)}transformEnd(){this.moveEnd(),this.zoomEnd(),this.rotateEnd()}moveEnd(){this.moveData&&(this.interaction.emit(t.MoveEvent.END,this.moveData),this.moveData=null)}zoomEnd(){this.zoomData&&(this.interaction.emit(t.ZoomEvent.END,this.zoomData),this.zoomData=null)}rotateEnd(){this.rotateData&&(this.interaction.emit(t.RotateEvent.END,this.rotateData),this.rotateData=null)}destroy(){this.zoomData=this.moveData=this.rotateData=null}}const wl={getMoveEventData:(t,e,i)=>Object.assign(Object.assign({},i),{x:t.x,y:t.y,moveX:e.x,moveY:e.y}),getRotateEventData:(t,e,i)=>Object.assign(Object.assign({},i),{x:t.x,y:t.y,rotation:e}),getZoomEventData:(t,e,i)=>Object.assign(Object.assign({},i),{x:t.x,y:t.y,scale:e}),getDragEventData:(t,e,i)=>Object.assign(Object.assign({},i),{x:i.x,y:i.y,moveX:i.x-e.x,moveY:i.y-e.y,totalX:i.x-t.x,totalY:i.y-t.y}),getDropEventData:(t,e,i)=>Object.assign(Object.assign({},t),{list:e,data:i}),getSwipeDirection:e=>e<-45&&e>-135?t.SwipeEvent.UP:e>45&&e<135?t.SwipeEvent.DOWN:e<=45&&e>=-45?t.SwipeEvent.RIGHT:t.SwipeEvent.LEFT,getSwipeEventData:(t,e,i)=>Object.assign(Object.assign({},i),{moveX:e.moveX,moveY:e.moveY,totalX:i.x-t.x,totalY:i.y-t.y,type:xl.getSwipeDirection(D.getAngle(t,i))}),getBase(t){const e=1===t.button?4:t.button;return{altKey:t.altKey,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,metaKey:t.metaKey,buttons:void 0===t.buttons?1:0===t.buttons?e:t.buttons,origin:t}},pathHasEventType(t,e){const{list:i}=t;for(let t=0,s=i.length;t<s;t++)if(i[t].hasEvent(e))return!0;return!1},filterPathByEventType(t,e){const i=new na,{list:s}=t;for(let t=0,n=s.length;t<n;t++)s[t].hasEvent(e)&&i.add(s[t]);return i},pathCanDrag:e=>e&&e.list.some((e=>e.draggable||e.editable||!e.isLeafer&&e.hasEvent(t.DragEvent.DRAG))),pathHasOutside:t=>t&&t.list.some((t=>t.isOutside))},xl=wl,bl=new na,{getDragEventData:El,getDropEventData:Bl,getSwipeEventData:Pl}=wl;class Rl{constructor(t){this.interaction=t}setDragData(t){this.animateWait&&this.dragEndReal(),this.downData=this.interaction.downData,this.dragData=El(t,t,t),this.canAnimate=this.canDragOut=!0}getList(e,i){const{proxy:s}=this.interaction.selector,n=s&&s.list.length,r=t.DragEvent.list||this.draggableList||bl;return this.dragging&&(n?e?bl:new na(i?[...s.list,...s.dragHoverExclude]:s.list):r)}checkDrag(e,i){const{interaction:s}=this;if(this.moving&&e.buttons<1)return this.canAnimate=!1,void s.pointerCancel();!this.moving&&i&&(this.moving=s.canMove(this.downData)||s.isHoldRightKey||s.isMobileDragEmpty)&&(this.dragData.moveType="drag",s.emit(t.MoveEvent.START,this.dragData)),this.moving||this.dragStart(e,i),this.drag(e)}dragStart(e,i){this.dragging||(this.dragging=i&&hl.left(e),this.dragging&&(this.interaction.emit(t.DragEvent.START,this.dragData),this.getDraggableList(this.dragData.path),this.setDragStartPoints(this.realDraggableList=this.getList(!0))))}setDragStartPoints(t){this.dragStartPoints={},t.forEach((t=>this.dragStartPoints[t.innerId]={x:t.x,y:t.y}))}getDraggableList(t){let e;for(let i=0,s=t.length;i<s;i++)if(e=t.list[i],(e.draggable||e.editable)&&e.hitSelf&&!e.locked){this.draggableList=new na(e);break}}drag(e){const{interaction:i,dragData:s,downData:n}=this,{path:r,throughPath:o}=n;this.dragData=El(n,s,e),o&&(this.dragData.throughPath=o),this.dragData.path=r,this.moving?(this.dragData.moveType="drag",i.emit(t.MoveEvent.BEFORE_MOVE,this.dragData),i.emit(t.MoveEvent.MOVE,this.dragData)):this.dragging&&(this.dragReal(),i.emit(t.DragEvent.BEFORE_DRAG,this.dragData),i.emit(t.DragEvent.DRAG,this.dragData))}dragReal(){const{running:e}=this.interaction,i=this.realDraggableList;if(i.length&&e){const{totalX:e,totalY:s}=this.dragData;i.forEach((i=>i.draggable&&i.move(t.DragEvent.getValidMove(i,this.dragStartPoints[i.innerId],{x:e,y:s}))))}}dragOverOrOut(e){const{interaction:i}=this,{dragOverPath:s}=this,{path:n}=e;this.dragOverPath=n,s?n.indexAt(0)!==s.indexAt(0)&&(i.emit(t.DragEvent.OUT,e,s),i.emit(t.DragEvent.OVER,e,n)):i.emit(t.DragEvent.OVER,e,n)}dragEnterOrLeave(e){const{interaction:i}=this,{dragEnterPath:s}=this,{path:n}=e;i.emit(t.DragEvent.LEAVE,e,s,n),i.emit(t.DragEvent.ENTER,e,n,s),this.dragEnterPath=n}dragEnd(t,e){if(!this.dragging&&!this.moving)return;const{moveX:i,moveY:s}=this.dragData;this.interaction.config.move.dragAnimate&&this.canAnimate&&this.moving&&(Math.abs(i)>1||Math.abs(s)>1)?(t=Object.assign({},t),e=.9*(e||("touch"===t.pointerType?2:1)),D.move(t,i*e,s*e),this.drag(t),this.animate((()=>{this.dragEnd(t,1)}))):this.dragEndReal(t)}dragEndReal(e){const{interaction:i,downData:s,dragData:n}=this;e||(e=n);const{path:r,throughPath:o}=s,a=El(s,e,e);if(o&&(a.throughPath=o),a.path=r,this.moving&&(this.moving=!1,a.moveType="drag",i.emit(t.MoveEvent.END,a)),this.dragging){const r=this.getList();this.dragging=!1,i.emit(t.DragEvent.END,a),this.swipe(e,s,n,a),this.drop(e,r,this.dragEnterPath)}this.autoMoveCancel(),this.dragReset(),this.animate(null,"off")}animate(t,e){const i=t||this.animateWait;i&&this.interaction.target.nextRender(i,null,e),this.animateWait=t}swipe(t,e,i,s){const{interaction:n}=this;if(D.getDistance(e,t)>n.config.pointer.swipeDistance){const t=Pl(e,i,s);this.interaction.emit(t.type,t)}}drop(e,i,s){const n=Bl(e,i,t.DragEvent.data);n.path=s,this.interaction.emit(t.DropEvent.DROP,n),this.interaction.emit(t.DragEvent.LEAVE,e,s)}dragReset(){t.DragEvent.list=t.DragEvent.data=this.draggableList=this.dragData=this.downData=this.dragOverPath=this.dragEnterPath=null}checkDragOut(t){const{interaction:e}=this;this.autoMoveCancel(),this.dragging&&!e.shrinkCanvasBounds.hitPoint(t)&&this.autoMoveOnDragOut(t)}autoMoveOnDragOut(t){const{interaction:e,downData:i,canDragOut:s}=this,{autoDistance:n,dragOut:r}=e.config.move;if(!r||!s||!n)return;const o=e.shrinkCanvasBounds,{x:a,y:h}=o,l=rt.maxX(o),d=rt.maxY(o),c=t.x<a?n:l<t.x?-n:0,u=t.y<h?n:d<t.y?-n:0;let _=0,p=0;this.autoMoveTimer=setInterval((()=>{_+=c,p+=u,D.move(i,c,u),D.move(this.dragData,c,u),e.move(Object.assign(Object.assign({},t),{moveX:c,moveY:u,totalX:_,totalY:p,moveType:"drag"})),e.pointerMoveReal(t)}),10)}autoMoveCancel(){this.autoMoveTimer&&(clearInterval(this.autoMoveTimer),this.autoMoveTimer=0)}destroy(){this.dragReset()}}const Cl=wt.get("emit");const Tl=["move","zoom","rotate","key"];function kl(t,e,i,s,n){if(Tl.some((t=>e.startsWith(t)))&&t.__.hitChildren&&!Sl(t,n)){let r;for(let o=0,a=t.children.length;o<a;o++)r=t.children[o],!i.path.has(r)&&r.__.hittable&&Ll(r,e,i,s,n)}}function Ll(t,e,i,s,n){if(t.destroyed)return!1;if(t.__.hitSelf&&!Sl(t,n)&&(Ka.updateEventStyle&&!s&&Ka.updateEventStyle(t,e),t.hasEvent(e,s))){i.phase=s?1:t===i.target?2:3;const n=St.get(e,i);if(t.emitEvent(n,s),n.isStop)return!0}return!1}function Sl(t,e){return e&&e.has(t)}const Ol={getData(t){const e=t[0],i=t[1],s=D.getCenter(e.from,i.from),n=D.getCenter(e.to,i.to),r={x:n.x-s.x,y:n.y-s.y},o=D.getDistance(e.from,i.from);return{move:r,scale:D.getDistance(e.to,i.to)/o,angle:D.getRotation(e.from,i.from,e.to,i.to),center:n}}},Dl={wheel:{zoomSpeed:.5,moveSpeed:.5,rotateSpeed:.5,delta:{x:20,y:8},preventDefault:!0},pointer:{hitRadius:5,tapTime:120,longPressTime:800,transformTime:500,hover:!0,dragHover:!0,dragDistance:2,swipeDistance:20,preventDefaultMenu:!0},touch:{preventDefault:!0},multiTouch:{},cursor:!0,keyEvent:!0},{pathHasEventType:Ml,getMoveEventData:Il,getZoomEventData:Al,getRotateEventData:Wl,pathCanDrag:Fl,pathHasOutside:zl}=wl;class Nl{get dragging(){return this.dragger.dragging}get transforming(){return this.transformer.transforming}get moveMode(){return!0===this.m.drag||this.isHoldSpaceKey||this.isHoldMiddleKey||this.isHoldRightKey&&this.dragger.moving||this.isDragEmpty}get canHover(){return this.p.hover&&!this.config.mobile}get isDragEmpty(){return this.m.dragEmpty&&this.isRootPath(this.hoverData)&&(!this.downData||this.isRootPath(this.downData))}get isMobileDragEmpty(){return this.m.dragEmpty&&!this.canHover&&this.downData&&this.isTreePath(this.downData)}get isHoldMiddleKey(){return this.m.holdMiddleKey&&this.downData&&hl.middle(this.downData)}get isHoldRightKey(){return this.m.holdRightKey&&this.downData&&hl.right(this.downData)}get isHoldSpaceKey(){return this.m.holdSpaceKey&&al.isHoldSpaceKey()}get m(){return this.config.move}get p(){return this.config.pointer}get hitRadius(){return this.p.hitRadius}constructor(t,e,i,s){this.config=Mt.clone(Dl),this.tapCount=0,this.downKeyMap={},this.target=t,this.canvas=e,this.selector=i,this.defaultPath=new na(t),this.transformer=new ml(this),this.dragger=new Rl(this),s&&(this.config=Mt.default(s,this.config)),this.__listenEvents()}start(){this.running=!0}stop(){this.running=!1}receive(t){}pointerDown(e,i){e||(e=this.hoverData),e&&(hl.defaultLeft(e),this.updateDownData(e),this.checkPath(e,i),this.downTime=Date.now(),this.emit(t.PointerEvent.BEFORE_DOWN,e),this.emit(t.PointerEvent.DOWN,e),hl.left(e)&&(this.tapWait(),this.longPressWait(e)),this.waitRightTap=hl.right(e),this.dragger.setDragData(e),this.isHoldRightKey||this.updateCursor(e))}pointerMove(t){if(t||(t=this.hoverData),!t)return;const{downData:e}=this;e&&hl.defaultLeft(t);(this.canvas.bounds.hitPoint(t)||e)&&(this.pointerMoveReal(t),e&&this.dragger.checkDragOut(t))}pointerMoveReal(e){const{dragHover:i,dragDistance:s}=this.p;if(this.emit(t.PointerEvent.BEFORE_MOVE,e,this.defaultPath),this.downData){const t=D.getDistance(this.downData,e)>s;t&&(this.waitTap&&this.pointerWaitCancel(),this.waitRightTap=!1),this.dragger.checkDrag(e,t)}this.dragger.moving||(this.updateHoverData(e),this.checkPath(e),this.emit(t.PointerEvent.MOVE,e),this.dragging&&!i||this.pointerHover(e),this.dragger.dragging&&(this.dragger.dragOverOrOut(e),this.dragger.dragEnterOrLeave(e))),this.updateCursor(this.downData||e)}pointerUp(e){const{downData:i}=this;if(e||(e=i),!i)return;hl.defaultLeft(e),e.multiTouch=i.multiTouch,this.findPath(e);const s=Object.assign(Object.assign({},e),{path:e.path.clone()});e.path.addList(i.path.list),this.checkPath(e),this.downData=null,this.emit(t.PointerEvent.BEFORE_UP,e),this.emit(t.PointerEvent.UP,e),this.touchLeave(e),e.isCancel||(this.tap(e),this.menuTap(e)),this.dragger.dragEnd(e),this.updateCursor(s)}pointerCancel(){const t=Object.assign({},this.dragger.dragData);t.isCancel=!0,this.pointerUp(t)}multiTouch(t,e){if(this.config.multiTouch.disabled)return;const{move:i,angle:s,scale:n,center:r}=Ol.getData(e);this.rotate(Wl(r,s,t)),this.zoom(Al(r,n,t)),this.move(Il(r,i,t))}menu(e){this.findPath(e),this.emit(t.PointerEvent.MENU,e),this.waitMenuTap=!0,!this.downData&&this.waitRightTap&&this.menuTap(e)}menuTap(e){this.waitRightTap&&this.waitMenuTap&&(this.emit(t.PointerEvent.MENU_TAP,e),this.waitRightTap=this.waitMenuTap=!1)}move(t){this.transformer.move(t)}zoom(t){this.transformer.zoom(t)}rotate(t){this.transformer.rotate(t)}transformEnd(){this.transformer.transformEnd()}keyDown(e){if(!this.config.keyEvent)return;const{code:i}=e;this.downKeyMap[i]||(this.downKeyMap[i]=!0,al.setDownCode(i),this.emit(t.KeyEvent.HOLD,e,this.defaultPath),this.moveMode&&(this.cancelHover(),this.updateCursor())),this.emit(t.KeyEvent.DOWN,e,this.defaultPath)}keyUp(e){if(!this.config.keyEvent)return;const{code:i}=e;this.downKeyMap[i]=!1,al.setUpCode(i),this.emit(t.KeyEvent.UP,e,this.defaultPath),"grab"===this.cursor&&this.updateCursor()}pointerHover(t){this.canHover&&(this.pointerOverOrOut(t),this.pointerEnterOrLeave(t))}pointerOverOrOut(e){const{path:i}=e,{overPath:s}=this;this.overPath=i,s?i.indexAt(0)!==s.indexAt(0)&&(this.emit(t.PointerEvent.OUT,e,s),this.emit(t.PointerEvent.OVER,e,i)):this.emit(t.PointerEvent.OVER,e,i)}pointerEnterOrLeave(e){let{path:i}=e;this.downData&&!this.moveMode&&(i=i.clone(),this.downData.path.forEach((t=>i.add(t))));const{enterPath:s}=this;this.enterPath=i,this.emit(t.PointerEvent.LEAVE,e,s,i),this.emit(t.PointerEvent.ENTER,e,i,s)}touchLeave(e){"touch"===e.pointerType&&this.enterPath&&(this.emit(t.PointerEvent.LEAVE,e),this.dragger.dragging&&this.emit(t.DropEvent.LEAVE,e))}tap(e){const{pointer:i}=this.config,s=this.longTap(e);if(!i.tapMore&&s)return;if(!this.waitTap)return;i.tapMore&&this.emitTap(e);const n=Date.now()-this.downTime,r=[t.PointerEvent.DOUBLE_TAP,t.PointerEvent.DOUBLE_CLICK].some((t=>Ml(e.path,t)));n<i.tapTime+50&&r?(this.tapCount++,2===this.tapCount?(this.tapWaitCancel(),this.emitDoubleTap(e)):(clearTimeout(this.tapTimer),this.tapTimer=setTimeout((()=>{i.tapMore||(this.tapWaitCancel(),this.emitTap(e))}),i.tapTime))):i.tapMore||(this.tapWaitCancel(),this.emitTap(e))}findPath(t,e){const{hitRadius:i,through:s}=this.p,{bottomList:n}=this,r=this.selector.getByPoint(t,i,Object.assign({bottomList:n,name:t.type},e||{through:s}));return r.throughPath&&(t.throughPath=r.throughPath),t.path=r.path,r.path}isRootPath(t){return t&&t.path.list[0].isLeafer}isTreePath(t){const e=this.target.app;return!(!e||!e.isApp)&&(e.editor&&!t.path.has(e.editor)&&t.path.has(e.tree)&&!t.target.syncEventer)}checkPath(t,e){(e||this.moveMode&&!zl(t.path))&&(t.path=this.defaultPath)}canMove(t){return t&&(this.moveMode||"auto"===this.m.drag&&!Fl(t.path))&&!zl(t.path)}isDrag(t){return this.dragger.getList().has(t)}isPress(t){return this.downData&&this.downData.path.has(t)}isHover(t){return this.enterPath&&this.enterPath.has(t)}isFocus(t){return this.focusData===t}cancelHover(){const{hoverData:t}=this;t&&(t.path=this.defaultPath,this.pointerHover(t))}updateDownData(t,e,i){const{downData:s}=this;!t&&s&&(t=s),t&&(this.findPath(t,e),i&&s&&t.path.addList(s.path.list),this.downData=t)}updateHoverData(e){e||(e=this.hoverData),e&&(this.findPath(e,{exclude:this.dragger.getList(!1,!0),name:t.PointerEvent.MOVE}),this.hoverData=e)}updateCursor(t){if(!this.config.cursor||!this.canHover)return;if(t||(this.updateHoverData(),t=this.downData||this.hoverData),this.dragger.moving)return this.setCursor("grabbing");if(this.canMove(t))return this.setCursor(this.downData?"grabbing":"grab");if(!t)return;let e,i;const{path:s}=t;for(let t=0,n=s.length;t<n&&(e=s.list[t],i=e.syncEventer&&e.syncEventer.cursor||e.cursor,!i);t++);this.setCursor(i)}setCursor(t){this.cursor=t}getLocal(t,e){const i=this.canvas.getClientBounds(e);return{x:t.clientX-i.x,y:t.clientY-i.y}}emitTap(e){this.emit(t.PointerEvent.TAP,e),this.emit(t.PointerEvent.CLICK,e)}emitDoubleTap(e){this.emit(t.PointerEvent.DOUBLE_TAP,e),this.emit(t.PointerEvent.DOUBLE_CLICK,e)}pointerWaitCancel(){this.tapWaitCancel(),this.longPressWaitCancel()}tapWait(){clearTimeout(this.tapTimer),this.waitTap=!0}tapWaitCancel(){clearTimeout(this.tapTimer),this.waitTap=!1,this.tapCount=0}longPressWait(e){clearTimeout(this.longPressTimer),this.longPressTimer=setTimeout((()=>{this.longPressed=!0,this.emit(t.PointerEvent.LONG_PRESS,e)}),this.p.longPressTime)}longTap(e){let i;return this.longPressed&&(this.emit(t.PointerEvent.LONG_TAP,e),(Ml(e.path,t.PointerEvent.LONG_TAP)||Ml(e.path,t.PointerEvent.LONG_PRESS))&&(i=!0)),this.longPressWaitCancel(),i}longPressWaitCancel(){clearTimeout(this.longPressTimer),this.longPressed=!1}__onResize(){this.shrinkCanvasBounds=new lt(this.canvas.bounds),this.shrinkCanvasBounds.spread(-2)}__listenEvents(){const{target:t}=this;this.__eventIds=[t.on_(Ur.RESIZE,this.__onResize,this)],t.once(jr.READY,(()=>this.__onResize()))}__removeListenEvents(){this.target.off_(this.__eventIds),this.__eventIds.length=0}emit(t,e,i,s){this.running&&function(t,e,i,s){if(!i&&!e.path)return;let n;e.type=t,i?e=Object.assign(Object.assign({},e),{path:i}):i=e.path,e.target=i.indexAt(0);try{for(let r=i.length-1;r>-1;r--){if(n=i.list[r],Ll(n,t,e,!0,s))return;n.isApp&&kl(n,t,e,!0,s)}for(let r=0,o=i.length;r<o;r++)if(n=i.list[r],n.isApp&&kl(n,t,e,!1,s),Ll(n,t,e,!1,s))return}catch(t){Cl.error(t)}}(t,e,i,s)}destroy(){this.__eventIds.length&&(this.stop(),this.__removeListenEvents(),this.dragger.destroy(),this.transformer.destroy(),this.downData=this.overPath=this.enterPath=null)}}class Ul{static set(t,e){this.custom[t]=e}static get(t){return this.custom[t]}}Ul.custom={};class Yl extends Dt{constructor(){super(...arguments),this.maxTotal=1e3,this.pathList=new na,this.pixelList=new na}getPixelType(t,e){return this.__autoClear(),this.pixelList.add(t),i.hitCanvas(e)}getPathType(t){return this.__autoClear(),this.pathList.add(t),i.hitCanvas()}clearImageType(){this.__clearLeafList(this.pixelList)}clearPathType(){this.__clearLeafList(this.pathList)}__clearLeafList(t){t.length&&(t.forEach((t=>{t.__hitCanvas&&(t.__hitCanvas.destroy(),t.__hitCanvas=null)})),t.reset())}__autoClear(){this.pathList.length+this.pixelList.length>this.maxTotal&&this.clear()}clear(){this.clearPathType(),this.clearImageType()}}const{toInnerRadiusPointOf:Xl,copy:Hl,setRadius:jl}=D,Vl={},Gl=t.Leaf.prototype;Gl.__hitWorld=function(t){if(!this.__.hitSelf)return!1;this.__.hitRadius&&(Hl(Vl,t),jl(t=Vl,this.__.hitRadius)),Xl(t,this.__world,Vl);const{width:e,height:i}=this.__world,s=e<10&&i<10;if(this.__.hitBox||s){if(rt.hitRadiusPoint(this.__layout.boxBounds,Vl))return!0;if(s)return!1}return!this.__layout.hitCanvasChanged&&this.__hitCanvas||(this.__updateHitCanvas(),this.__layout.boundsChanged||(this.__layout.hitCanvasChanged=!1)),this.__hit(Vl)},Gl.__hitFill=function(t){var e;return null===(e=this.__hitCanvas)||void 0===e?void 0:e.hitFill(t,this.__.windingRule)},Gl.__hitStroke=function(t,e){var i;return null===(i=this.__hitCanvas)||void 0===i?void 0:i.hitStroke(t,e)},Gl.__hitPixel=function(t){var e;return null===(e=this.__hitCanvas)||void 0===e?void 0:e.hitPixel(t,this.__layout.renderBounds,this.__hitCanvas.hitScale)},Gl.__drawHitPath=function(t){t&&this.__drawRenderPath(t)};const Kl=new N,ql=t.UI.prototype;ql.__updateHitCanvas=function(){const t=this.__,{hitCanvasManager:i}=this.leafer,s=(t.__pixelFill||t.__isCanvas)&&"pixel"===t.hitFill,n=t.__pixelStroke&&"pixel"===t.hitStroke,r=s||n;this.__hitCanvas||(this.__hitCanvas=r?i.getPixelType(this,{contextSettings:{willReadFrequently:!0}}):i.getPathType(this));const o=this.__hitCanvas;if(r){const{renderBounds:i}=this.__layout,r=e.image.hitCanvasSize,a=o.hitScale=dt.set(0,0,r,r).getFitMatrix(i).a,{x:h,y:l,width:d,height:c}=dt.set(i).scale(a);o.resize({width:d,height:c,pixelRatio:1}),o.clear(),_n.patternLocked=!0,this.__renderShape(o,{matrix:Kl.setWith(this.__world).scaleWith(1/a).invertWith().translate(-h,-l)},!s,!n),_n.patternLocked=!1,o.resetTransform(),t.__isHitPixel=!0}else t.__isHitPixel&&(t.__isHitPixel=!1);this.__drawHitPath(o),o.setStrokeOptions(t)},ql.__hit=function(t){"miniapp"===e.name&&this.__drawHitPath(this.__hitCanvas);const i=this.__;if(i.__isHitPixel&&this.__hitPixel(t))return!0;const{hitFill:s}=i,n=(i.fill||i.__isCanvas)&&("path"===s||"pixel"===s&&!(i.__pixelFill||i.__isCanvas))||"all"===s;if(n&&this.__hitFill(t))return!0;const{hitStroke:r,__strokeWidth:o}=i,a=i.stroke&&("path"===r||"pixel"===r&&!i.__pixelStroke)||"all"===r;if(!n&&!a)return!1;const h=2*t.radiusX;let l=h;if(a)switch(i.strokeAlign){case"inside":if(l+=2*o,!n&&this.__hitFill(t)&&this.__hitStroke(t,l))return!0;l=h;break;case"center":l+=o;break;case"outside":if(l+=2*o,!n){if(!this.__hitFill(t)&&this.__hitStroke(t,l))return!0;l=h}}return!!l&&this.__hitStroke(t,l)};const Zl=t.UI.prototype,Ql=t.Rect.prototype,Jl=t.Box.prototype;Ql.__updateHitCanvas=Jl.__updateHitCanvas=function(){this.stroke||this.cornerRadius||(this.fill||this.__.__isCanvas)&&"pixel"===this.hitFill||"all"===this.hitStroke?Zl.__updateHitCanvas.call(this):this.__hitCanvas&&(this.__hitCanvas=null)},Ql.__hitFill=Jl.__hitFill=function(t){return this.__hitCanvas?Zl.__hitFill.call(this,t):rt.hitRadiusPoint(this.__layout.boxBounds,t)};const $l=t.UI.prototype,td=t.Group.prototype;function ed(t){return t.leafer?t.leafer.selector:e.selector||(e.selector=i.selector())}$l.find=function(t,e){return ed(this).getBy(t,this,!1,e)},$l.findOne=function(t,e){return ed(this).getBy(t,this,!0,e)},td.pick=function(t,e){return this.__layout.update(),e||(e={}),ed(this).getByPoint(t,e.hitRadius||0,Object.assign(Object.assign({},e),{target:this}))};const id=Kt.prototype;id.hitFill=function(t,e){return e?this.context.isPointInPath(t.x,t.y,e):this.context.isPointInPath(t.x,t.y)},id.hitStroke=function(t,e){return this.strokeWidth=e,this.context.isPointInStroke(t.x,t.y)},id.hitPixel=function(t,e,i=1){let{x:s,y:n,radiusX:r,radiusY:o}=t;e&&(s-=e.x,n-=e.y),dt.set(s-r,n-o,2*r,2*o).scale(i).ceil();const{data:a}=this.context.getImageData(dt.x,dt.y,dt.width||1,dt.height||1);for(let t=0,e=a.length;t<e;t+=4)if(a[t+3]>0)return!0;return a[3]>0};const sd={convert(t,e){const i=wl.getBase(t),s=Object.assign(Object.assign({},i),{x:e.x,y:e.y,width:t.width,height:t.height,pointerType:t.pointerType,pressure:t.pressure});return"pen"===s.pointerType&&(s.tangentialPressure=t.tangentialPressure,s.tiltX=t.tiltX,s.tiltY=t.tiltY,s.twist=t.twist),s},convertMouse(t,e){const i=wl.getBase(t);return Object.assign(Object.assign({},i),{x:e.x,y:e.y,width:1,height:1,pointerType:"mouse",pressure:.5})},convertTouch(t,e){const i=sd.getTouch(t),s=wl.getBase(t);return Object.assign(Object.assign({},s),{x:e.x,y:e.y,width:1,height:1,pointerType:"touch",multiTouch:t.touches.length>1,pressure:i.force})},getTouch:t=>t.targetTouches[0]||t.changedTouches[0]},nd={getMove(t,e){let{moveSpeed:i}=e,{deltaX:s,deltaY:n}=t;return t.shiftKey&&!s&&(s=n,n=0),s>50&&(s=Math.max(50,s/3)),n>50&&(n=Math.max(50,n/3)),{x:-s*i*2,y:-n*i*2}},getScale(t,i){let s,n=1,{zoomMode:r,zoomSpeed:o}=i;const a=t.deltaY||t.deltaX;if(r?(s="mouse"===r||!t.deltaX&&(e.intWheelDeltaY?Math.abs(a)>17:Math.ceil(a)!==a),(t.shiftKey||t.metaKey||t.ctrlKey)&&(s=!0)):s=!t.shiftKey&&(t.metaKey||t.ctrlKey),s){o=h.within(o,0,1);n=1-a/(4*(t.deltaY?i.delta.y:i.delta.x))*o,n<.5&&(n=.5),n>=1.5&&(n=1.5)}return n}},rd={convert(t){const e=wl.getBase(t);return Object.assign(Object.assign({},e),{code:t.code,key:t.key})}},{getMoveEventData:od,getZoomEventData:ad,getRotateEventData:hd,pathCanDrag:ld}=wl;class dd extends Nl{__listenEvents(){super.__listenEvents();const t=this.view=this.canvas.view;this.viewEvents={pointerdown:this.onPointerDown,mousedown:this.onMouseDown,touchstart:this.onTouchStart,contextmenu:this.onContextMenu,wheel:this.onWheel,gesturestart:this.onGesturestart,gesturechange:this.onGesturechange,gestureend:this.onGestureend},this.windowEvents={pointermove:this.onPointerMove,pointerup:this.onPointerUp,pointercancel:this.onPointerCancel,mousemove:this.onMouseMove,mouseup:this.onMouseUp,touchmove:this.onTouchMove,touchend:this.onTouchEnd,touchcancel:this.onTouchCancel,keydown:this.onKeyDown,keyup:this.onKeyUp,scroll:this.onScroll};const{viewEvents:e,windowEvents:i}=this;for(let i in e)e[i]=e[i].bind(this),t.addEventListener(i,e[i]);for(let t in i)i[t]=i[t].bind(this),window.addEventListener(t,i[t])}__removeListenEvents(){super.__removeListenEvents();const{viewEvents:t,windowEvents:e}=this;for(let e in t)this.view.removeEventListener(e,t[e]),this.viewEvents={};for(let t in e)window.removeEventListener(t,e[t]),this.windowEvents={}}getTouches(t){const e=[];for(let i=0,s=t.length;i<s;i++)e.push(t[i]);return e}preventDefaultPointer(t){const{pointer:e}=this.config;e.preventDefault&&t.preventDefault()}preventDefaultWheel(t){const{wheel:e}=this.config;e.preventDefault&&t.preventDefault()}preventWindowPointer(t){return!this.downData&&t.target!==this.view}onKeyDown(t){this.keyDown(rd.convert(t))}onKeyUp(t){this.keyUp(rd.convert(t))}onContextMenu(t){this.config.pointer.preventDefaultMenu&&t.preventDefault(),this.menu(sd.convert(t,this.getLocal(t)))}onScroll(){this.canvas.updateClientBounds()}onPointerDown(t){this.preventDefaultPointer(t),this.config.pointer.touch||this.useMultiTouch||(this.usePointer||(this.usePointer=!0),this.pointerDown(sd.convert(t,this.getLocal(t))))}onPointerMove(t){this.config.pointer.touch||this.useMultiTouch||this.preventWindowPointer(t)||(this.usePointer||(this.usePointer=!0),this.pointerMove(sd.convert(t,this.getLocal(t,!0))))}onPointerUp(t){this.downData&&this.preventDefaultPointer(t),this.config.pointer.touch||this.useMultiTouch||this.preventWindowPointer(t)||this.pointerUp(sd.convert(t,this.getLocal(t)))}onPointerCancel(){this.useMultiTouch||this.pointerCancel()}onMouseDown(t){this.preventDefaultPointer(t),this.useTouch||this.usePointer||this.pointerDown(sd.convertMouse(t,this.getLocal(t)))}onMouseMove(t){this.useTouch||this.usePointer||this.preventWindowPointer(t)||this.pointerMove(sd.convertMouse(t,this.getLocal(t,!0)))}onMouseUp(t){this.downData&&this.preventDefaultPointer(t),this.useTouch||this.usePointer||this.preventWindowPointer(t)||this.pointerUp(sd.convertMouse(t,this.getLocal(t)))}onMouseCancel(){this.useTouch||this.usePointer||this.pointerCancel()}onTouchStart(t){const e=sd.getTouch(t),i=this.getLocal(e,!0),{preventDefault:s}=this.config.touch;(!0===s||"auto"===s&&ld(this.findPath(i)))&&t.preventDefault(),this.multiTouchStart(t),this.usePointer||(this.touchTimer&&(window.clearTimeout(this.touchTimer),this.touchTimer=0),this.useTouch=!0,this.pointerDown(sd.convertTouch(t,i)))}onTouchMove(t){if(this.multiTouchMove(t),this.usePointer||this.preventWindowPointer(t))return;const e=sd.getTouch(t);this.pointerMove(sd.convertTouch(t,this.getLocal(e)))}onTouchEnd(t){if(this.multiTouchEnd(),this.usePointer||this.preventWindowPointer(t))return;this.touchTimer&&clearTimeout(this.touchTimer),this.touchTimer=setTimeout((()=>{this.useTouch=!1}),500);const e=sd.getTouch(t);this.pointerUp(sd.convertTouch(t,this.getLocal(e)))}onTouchCancel(){this.usePointer||this.pointerCancel()}multiTouchStart(t){this.useMultiTouch=t.touches.length>1,this.touches=this.useMultiTouch?this.getTouches(t.touches):void 0,this.useMultiTouch&&this.pointerCancel()}multiTouchMove(t){if(this.useMultiTouch&&t.touches.length>1){const e=this.getTouches(t.touches),i=this.getKeepTouchList(this.touches,e);i.length>1&&(this.multiTouch(wl.getBase(t),i),this.touches=e)}}multiTouchEnd(){this.touches=null,this.useMultiTouch=!1,this.transformEnd()}getKeepTouchList(t,e){let i;const s=[];return t.forEach((t=>{i=e.find((e=>e.identifier===t.identifier)),i&&s.push({from:this.getLocal(t),to:this.getLocal(i)})})),s}getLocalTouchs(t){return t.map((t=>this.getLocal(t)))}onWheel(t){this.preventDefaultWheel(t);const{wheel:e}=this.config;if(e.disabled)return;const i=e.getScale?e.getScale(t,e):nd.getScale(t,e),s=this.getLocal(t),n=wl.getBase(t);1!==i?this.zoom(ad(s,i,n)):this.move(od(s,e.getMove?e.getMove(t,e):nd.getMove(t,e),n))}onGesturestart(t){this.useMultiTouch||(this.preventDefaultWheel(t),this.lastGestureScale=1,this.lastGestureRotation=0)}onGesturechange(t){if(this.useMultiTouch)return;this.preventDefaultWheel(t);const e=this.getLocal(t),i=wl.getBase(t),s=t.scale/this.lastGestureScale,n=t.rotation-this.lastGestureRotation;let{rotateSpeed:r}=this.config.wheel;r=h.within(r,0,1),this.zoom(ad(e,s*s,i)),this.rotate(hd(e,n/Math.PI*180*(r/4+.1),i)),this.lastGestureScale=t.scale,this.lastGestureRotation=t.rotation}onGestureend(t){this.useMultiTouch||(this.preventDefaultWheel(t),this.transformEnd())}setCursor(t){super.setCursor(t);const e=[];this.eachCursor(t,e),"object"==typeof e[e.length-1]&&e.push("default"),this.canvas.view.style.cursor=e.map((t=>"object"==typeof t?`url(${t.url}) ${t.x||0} ${t.y||0}`:t)).join(",")}eachCursor(t,e,i=0){if(i++,t instanceof Array)t.forEach((t=>this.eachCursor(t,e,i)));else{const s="string"==typeof t&&Ul.get(t);s&&i<2?this.eachCursor(s,e,i):e.push(t)}}destroy(){this.view&&(super.destroy(),this.view=null,this.touches=null)}}function cd(t,e){let i;const{rows:s,decorationY:n,decorationHeight:r}=t.__.__textDrawData;for(let t=0,o=s.length;t<o;t++)i=s[t],i.text?e.fillText(i.text,i.x,i.y):i.data&&i.data.forEach((t=>{e.fillText(t.char,t.x,i.y)})),n&&e.fillRect(i.x,i.y+n,i.width,r)}function ud(t,e,i){const{strokeAlign:s}=e.__,n="string"!=typeof t;switch(s){case"center":i.setStroke(n?void 0:t,e.__.strokeWidth,e.__),n?gd(t,!0,e,i):pd(e,i);break;case"inside":_d("inside",t,n,e,i);break;case"outside":_d("outside",t,n,e,i)}}function _d(t,e,i,s,n){const{__strokeWidth:r,__font:o}=s.__,a=n.getSameCanvas(!0,!0);a.setStroke(i?void 0:e,2*r,s.__),a.font=o,i?gd(e,!0,s,a):pd(s,a),a.blendMode="outside"===t?"destination-out":"destination-in",cd(s,a),a.blendMode="normal",s.__worldFlipped?n.copyWorldByReset(a,s.__nowWorld):n.copyWorldToInner(a,s.__nowWorld,s.__layout.renderBounds),a.recycle(s.__nowWorld)}function pd(t,e){let i;const{rows:s,decorationY:n,decorationHeight:r}=t.__.__textDrawData;for(let t=0,o=s.length;t<o;t++)i=s[t],i.text?e.strokeText(i.text,i.x,i.y):i.data&&i.data.forEach((t=>{e.strokeText(t.char,t.x,i.y)})),n&&e.strokeRect(i.x,i.y+n,i.width,r)}function gd(t,e,i,s){let n;for(let r=0,o=t.length;r<o;r++)n=t[r],n.image&&Ha.checkImage(i,s,n,!1)||n.style&&(s.strokeStyle=n.style,n.blendMode?(s.saveBlendMode(n.blendMode),e?pd(i,s):s.stroke(),s.restoreBlendMode()):e?pd(i,s):s.stroke())}const{getSpread:fd,getOuterOf:yd,getByMove:vd,getIntersectData:md}=rt;let wd;function xd(t,e,i){if("object"!=typeof e||!1===e.visible||0===e.opacity)return;const{boxBounds:s}=i.__layout;switch(e.type){case"solid":let{type:n,blendMode:r,color:o,opacity:a}=e;return{type:n,blendMode:r,style:Na.string(o,a)};case"image":return Ha.image(i,t,e,s,!wd||!wd[e.url]);case"linear":return ja.linearGradient(e,s);case"radial":return ja.radialGradient(e,s);case"angular":return ja.conicGradient(e,s);default:return void 0!==e.r?{type:"solid",style:Na.string(e)}:void 0}}const bd={compute:function(t,e){const i=e.__,s=[];let n,r=i.__input[t];r instanceof Array||(r=[r]),wd=Ha.recycleImage(t,i);for(let i,n=0,o=r.length;n<o;n++)i=xd(t,r[n],e),i&&s.push(i);i["_"+t]=s.length?s:void 0,s.length&&s[0].image&&(n=s[0].image.hasOpacityPixel),"fill"===t?i.__pixelFill=n:i.__pixelStroke=n},fill:function(t,e,i){i.fillStyle=t,e.__.__font?cd(e,i):e.__.windingRule?i.fill(e.__.windingRule):i.fill()},fills:function(t,e,i){let s;const{windingRule:n,__font:r}=e.__;for(let o=0,a=t.length;o<a;o++)s=t[o],s.image&&Ha.checkImage(e,i,s,!r)||s.style&&(i.fillStyle=s.style,s.transform?(i.save(),i.transform(s.transform),s.blendMode&&(i.blendMode=s.blendMode),r?cd(e,i):n?i.fill(n):i.fill(),i.restore()):s.blendMode?(i.saveBlendMode(s.blendMode),r?cd(e,i):n?i.fill(n):i.fill(),i.restoreBlendMode()):r?cd(e,i):n?i.fill(n):i.fill())},fillText:cd,stroke:function(t,e,i){const s=e.__,{__strokeWidth:n,strokeAlign:r,__font:o}=s;if(n)if(o)ud(t,e,i);else switch(r){case"center":i.setStroke(t,n,s),i.stroke();break;case"inside":i.save(),i.setStroke(t,2*n,s),s.windingRule?i.clip(s.windingRule):i.clip(),i.stroke(),i.restore();break;case"outside":const r=i.getSameCanvas(!0,!0);r.setStroke(t,2*n,s),e.__drawRenderPath(r),r.stroke(),s.windingRule?r.clip(s.windingRule):r.clip(),r.clearWorld(e.__layout.renderBounds),e.__worldFlipped?i.copyWorldByReset(r,e.__nowWorld):i.copyWorldToInner(r,e.__nowWorld,e.__layout.renderBounds),r.recycle(e.__nowWorld)}},strokes:function(t,e,i){const s=e.__,{__strokeWidth:n,strokeAlign:r,__font:o}=s;if(n)if(o)ud(t,e,i);else switch(r){case"center":i.setStroke(void 0,n,s),gd(t,!1,e,i);break;case"inside":i.save(),i.setStroke(void 0,2*n,s),s.windingRule?i.clip(s.windingRule):i.clip(),gd(t,!1,e,i),i.restore();break;case"outside":const{renderBounds:r}=e.__layout,o=i.getSameCanvas(!0,!0);e.__drawRenderPath(o),o.setStroke(void 0,2*n,s),gd(t,!1,e,o),s.windingRule?o.clip(s.windingRule):o.clip(),o.clearWorld(r),e.__worldFlipped?i.copyWorldByReset(o,e.__nowWorld):i.copyWorldToInner(o,e.__nowWorld,r),o.recycle(e.__nowWorld)}},strokeText:ud,drawTextStroke:pd,shape:function(t,e,i){const s=e.getSameCanvas(),n=t.__nowWorld;let r,o,a,h,{scaleX:l,scaleY:d}=n;if(l<0&&(l=-l),d<0&&(d=-d),e.bounds.includes(n))h=s,r=a=n;else{const{renderShapeSpread:s}=t.__layout,c=md(s?fd(e.bounds,l===d?s*l:[s*d,s*l]):e.bounds,n);o=e.bounds.getFitMatrix(c);let{a:u,d:_}=o;if(o.a<1&&(h=e.getSameCanvas(),t.__renderShape(h,i),l*=u,d*=_),a=yd(n,o),r=vd(a,-o.e,-o.f),i.matrix){const{matrix:t}=i;o.multiply(t),u*=t.scaleX,_*=t.scaleY}i=Object.assign(Object.assign({},i),{matrix:o.withScale(u,_)})}return t.__renderShape(s,i),{canvas:s,matrix:o,bounds:r,worldCanvas:h,shapeBounds:a,scaleX:l,scaleY:d}}};let Ed={};const{get:Bd,rotateOfOuter:Pd,translate:Rd,scaleOfOuter:Cd,scale:Td,rotate:kd}=b;function Ld(t,e,i,s,n,r,o){const a=Bd();Rd(a,e.x+i,e.y+s),Td(a,n,r),o&&Pd(a,{x:e.x+e.width/2,y:e.y+e.height/2},o),t.transform=a}function Sd(t,e,i,s,n,r,o){const a=Bd();Rd(a,e.x+i,e.y+s),n&&Td(a,n,r),o&&kd(a,o),t.transform=a}function Od(t,e,i,s,n,r,o,a,h,l){const d=Bd();if(h)if("center"===l)Pd(d,{x:i/2,y:s/2},h);else switch(kd(d,h),h){case 90:Rd(d,s,0);break;case 180:Rd(d,i,s);break;case 270:Rd(d,0,i)}Ed.x=e.x+n,Ed.y=e.y+r,Rd(d,Ed.x,Ed.y),o&&Cd(d,Ed,o,a),t.transform=d}const{get:Dd,translate:Md}=b,Id=new lt,Ad={},Wd={};function Fd(t,e,i,s){const{blendMode:n,sync:r}=i;n&&(t.blendMode=n),r&&(t.sync=r),t.data=zd(i,s,e)}function zd(t,e,i){let{width:s,height:n}=i;t.padding&&(e=Id.set(e).shrink(t.padding)),"strench"===t.mode&&(t.mode="stretch");const{opacity:r,mode:o,align:a,offset:l,scale:d,size:c,rotation:u,repeat:_}=t,p=e.width===s&&e.height===n,g={mode:o},f="center"!==a&&(u||0)%180==90,y=f?n:s,v=f?s:n;let m,w,x=0,b=0;if(o&&"cover"!==o&&"fit"!==o)(d||c)&&(h.getScaleData(d,c,i,Wd),m=Wd.scaleX,w=Wd.scaleY);else if(!p||u){const t=e.width/y,i=e.height/v;m=w="fit"===o?Math.min(t,i):Math.max(t,i),x+=(e.width-s*m)/2,b+=(e.height-n*w)/2}if(a){const t={x:x,y:b,width:y,height:v};m&&(t.width*=m,t.height*=w),vt.toPoint(a,t,e,Ad,!0),x+=Ad.x,b+=Ad.y}switch(l&&(x+=l.x,b+=l.y),o){case"stretch":p||(s=e.width,n=e.height);break;case"normal":case"clip":(x||b||m||u)&&Sd(g,e,x,b,m,w,u);break;case"repeat":(!p||m||u)&&Od(g,e,s,n,x,b,m,w,u,a),_||(g.repeat="repeat");break;default:m&&Ld(g,e,x,b,m,w,u)}return g.transform||(e.x||e.y)&&(g.transform=Dd(),Md(g.transform,e.x,e.y)),m&&"stretch"!==o&&(g.scaleX=m,g.scaleY=w),g.width=s,g.height=n,r&&(g.opacity=r),_&&(g.repeat="string"==typeof _?"x"===_?"repeat-x":"repeat-y":"repeat"),g}let Nd,Ud=new lt;const{isSame:Yd}=rt;function Xd(t,e,i,s,n,r){if("fill"===e&&!t.__.__naturalWidth){const e=t.__;if(e.__naturalWidth=s.width/e.pixelRatio,e.__naturalHeight=s.height/e.pixelRatio,e.__autoSide)return t.forceUpdate("width"),t.__proxyData&&(t.setProxyAttr("width",e.width),t.setProxyAttr("height",e.height)),!1}return n.data||Fd(n,s,i,r),!0}function Hd(t,e){Gd(t,Nr.LOAD,e)}function jd(t,e){Gd(t,Nr.LOADED,e)}function Vd(t,e,i){e.error=i,t.forceUpdate("surface"),Gd(t,Nr.ERROR,e)}function Gd(t,e,i){t.hasEvent(e)&&t.emitEvent(new Nr(e,i))}function Kd(t,e){const{leafer:i}=t;i&&i.viewReady&&(i.renderer.ignore=e)}const{get:qd,scale:Zd,copy:Qd}=b,{ceil:Jd,abs:$d}=Math;function tc(t,i,s){let{scaleX:n,scaleY:r}=_n.patternLocked?t.__world:t.__nowWorld;const o=n+"-"+r+"-"+s;if(i.patternId===o||t.destroyed)return!1;{n=$d(n),r=$d(r);const{image:t,data:a}=i;let h,l,{width:d,height:c,scaleX:u,scaleY:_,opacity:p,transform:g,repeat:f}=a;u&&(l=qd(),Qd(l,g),Zd(l,1/u,1/_),n*=u,r*=_),n*=s,r*=s,d*=n,c*=r;const y=d*c;if(!f&&y>e.image.maxCacheSize)return!1;let v=e.image.maxPatternSize;if(!t.isSVG){const e=t.width*t.height;v>e&&(v=e)}y>v&&(h=Math.sqrt(y/v)),h&&(n/=h,r/=h,d/=h,c/=h),u&&(n/=u,r/=_),(g||1!==n||1!==r)&&(l||(l=qd(),g&&Qd(l,g)),Zd(l,1/n,1/r));const m=t.getCanvas(Jd(d)||1,Jd(c)||1,p),w=t.getPattern(m,f||e.origin.noRepeat||"no-repeat",l,i);return i.style=w,i.patternId=o,!0}}const{abs:ec}=Math;const ic={image:function(t,e,i,s,n){let r,o;const a=_n.get(i);return Nd&&i===Nd.paint&&Yd(s,Nd.boxBounds)?r=Nd.leafPaint:(r={type:i.type,image:a},Nd=a.use>1?{leafPaint:r,paint:i,boxBounds:Ud.set(s)}:null),(n||a.loading)&&(o={image:a,attrName:e,attrValue:i}),a.ready?(Xd(t,e,i,a,r,s),n&&(Hd(t,o),jd(t,o))):a.error?n&&Vd(t,o,a.error):(n&&(Kd(t,!0),Hd(t,o)),r.loadId=a.load((()=>{Kd(t,!1),t.destroyed||(Xd(t,e,i,a,r,s)&&(a.hasOpacityPixel&&(t.__layout.hitCanvasChanged=!0),t.forceUpdate("surface")),jd(t,o)),r.loadId=null}),(e=>{Kd(t,!1),Vd(t,o,e),r.loadId=null}))),r},checkImage:function(t,i,s,n){const{scaleX:r,scaleY:o}=_n.patternLocked?t.__world:t.__nowWorld,{pixelRatio:a}=i;if(!s.data||s.patternId===r+"-"+o+"-"+a&&!Ga.running)return!1;{const{data:h}=s;if(n)if(h.repeat)n=!1;else{let{width:t,height:i}=h;t*=ec(r)*a,i*=ec(o)*a,h.scaleX&&(t*=h.scaleX,i*=h.scaleY),n=t*i>e.image.maxCacheSize||Ga.running}return n?(i.save(),t.windingRule?i.clip(t.windingRule):i.clip(),s.blendMode&&(i.blendMode=s.blendMode),h.opacity&&(i.opacity*=h.opacity),h.transform&&i.transform(h.transform),i.drawImage(s.image.view,0,0,h.width,h.height),i.restore(),!0):(!s.style||s.sync||Ga.running?tc(t,s,a):s.patternTask||(s.patternTask=_n.patternTasker.add((()=>zt(this,void 0,void 0,(function*(){s.patternTask=null,i.bounds.hit(t.__nowWorld)&&tc(t,s,a),t.forceUpdate("surface")}))),300)),!1)}},createPattern:tc,recycleImage:function(t,e){const i=e["_"+t];if(i instanceof Array){let s,n,r,o;for(let a=0,h=i.length;a<h;a++)s=i[a].image,o=s&&s.url,o&&(n||(n={}),n[o]=!0,_n.recycle(s),s.loading&&(r||(r=e.__input&&e.__input[t]||[],r instanceof Array||(r=[r])),s.unload(i[a].loadId,!r.some((t=>t.url===o)))));return n}return null},createData:Fd,getPatternData:zd,fillOrFitMode:Ld,clipMode:Sd,repeatMode:Od},{toPoint:sc}=gt,nc={},rc={};function oc(t,e,i){if(e){let s;for(let n=0,r=e.length;n<r;n++)s=e[n],"string"==typeof s?t.addColorStop(n/(r-1),Na.string(s,i)):t.addColorStop(s.offset,Na.string(s.color,i))}}const{getAngle:ac,getDistance:hc}=D,{get:lc,rotateOfOuter:dc,scaleOfOuter:cc}=b,{toPoint:uc}=gt,_c={},pc={};function gc(t,e,i,s,n){let r;const{width:o,height:a}=t;if(o!==a||s){const t=ac(e,i);r=lc(),n?(cc(r,e,o/a*(s||1),1),dc(r,e,t+90)):(cc(r,e,1,o/a*(s||1)),dc(r,e,t))}return r}const{getDistance:fc}=D,{toPoint:yc}=gt,vc={},mc={};const wc={linearGradient:function(t,i){let{from:s,to:n,type:r,blendMode:o,opacity:a}=t;sc(s||"top",i,nc),sc(n||"bottom",i,rc);const h=e.canvas.createLinearGradient(nc.x,nc.y,rc.x,rc.y);oc(h,t.stops,a);const l={type:r,style:h};return o&&(l.blendMode=o),l},radialGradient:function(t,i){let{from:s,to:n,type:r,opacity:o,blendMode:a,stretch:h}=t;uc(s||"center",i,_c),uc(n||"bottom",i,pc);const l=e.canvas.createRadialGradient(_c.x,_c.y,0,_c.x,_c.y,hc(_c,pc));oc(l,t.stops,o);const d={type:r,style:l},c=gc(i,_c,pc,h,!0);return c&&(d.transform=c),a&&(d.blendMode=a),d},conicGradient:function(t,i){let{from:s,to:n,type:r,opacity:o,blendMode:a,stretch:h}=t;yc(s||"center",i,vc),yc(n||"bottom",i,mc);const l=e.conicGradientSupport?e.canvas.createConicGradient(0,vc.x,vc.y):e.canvas.createRadialGradient(vc.x,vc.y,0,vc.x,vc.y,fc(vc,mc));oc(l,t.stops,o);const d={type:r,style:l},c=gc(i,vc,mc,h||1,e.conicGradientRotate90);return c&&(d.transform=c),a&&(d.blendMode=a),d},getTransform:gc},{copy:xc,toOffsetOutBounds:bc}=rt,Ec={},Bc={};function Pc(t,i,s,n){const{bounds:r,shapeBounds:o}=n;if(e.fullImageShadow){if(xc(Ec,t.bounds),Ec.x+=i.x-o.x,Ec.y+=i.y-o.y,s){const{matrix:t}=n;Ec.x-=(r.x+(t?t.e:0)+r.width/2)*(s-1),Ec.y-=(r.y+(t?t.f:0)+r.height/2)*(s-1),Ec.width*=s,Ec.height*=s}t.copyWorld(n.canvas,t.bounds,Ec)}else s&&(xc(Ec,i),Ec.x-=i.width/2*(s-1),Ec.y-=i.height/2*(s-1),Ec.width*=s,Ec.height*=s),t.copyWorld(n.canvas,o,s?Ec:i)}const{toOffsetOutBounds:Rc}=rt,Cc={};const Tc={shadow:function(t,e,i){let s,n;const{__nowWorld:r,__layout:o}=t,{shadow:a}=t.__,{worldCanvas:h,bounds:l,shapeBounds:d,scaleX:c,scaleY:u}=i,_=e.getSameCanvas(),p=a.length-1;bc(l,Bc),a.forEach(((a,g)=>{_.setWorldShadow(Bc.offsetX+a.x*c,Bc.offsetY+a.y*u,a.blur*c,a.color),n=a.spread?1+2*a.spread/(o.boxBounds.width+2*(o.strokeBoxSpread||0)):0,Pc(_,Bc,n,i),s=l,a.box&&(_.restore(),_.save(),h&&(_.copyWorld(_,l,r,"copy"),s=r),h?_.copyWorld(h,r,r,"destination-out"):_.copyWorld(i.canvas,d,l,"destination-out")),t.__worldFlipped?e.copyWorldByReset(_,s,r,a.blendMode):e.copyWorldToInner(_,s,o.renderBounds,a.blendMode),p&&g<p&&_.clearWorld(s,!0)})),_.recycle(s)},innerShadow:function(t,e,i){let s,n;const{__nowWorld:r,__layout:o}=t,{innerShadow:a}=t.__,{worldCanvas:h,bounds:l,shapeBounds:d,scaleX:c,scaleY:u}=i,_=e.getSameCanvas(),p=a.length-1;Rc(l,Cc),a.forEach(((a,g)=>{_.save(),_.setWorldShadow(Cc.offsetX+a.x*c,Cc.offsetY+a.y*u,a.blur*c),n=a.spread?1-2*a.spread/(o.boxBounds.width+2*(o.strokeBoxSpread||0)):0,Pc(_,Cc,n,i),_.restore(),h?(_.copyWorld(_,l,r,"copy"),_.copyWorld(h,r,r,"source-out"),s=r):(_.copyWorld(i.canvas,d,l,"source-out"),s=l),_.fillWorld(s,a.color,"source-in"),t.__worldFlipped?e.copyWorldByReset(_,s,r,a.blendMode):e.copyWorldToInner(_,s,o.renderBounds,a.blendMode),p&&g<p&&_.clearWorld(s,!0)})),_.recycle(s)},blur:function(t,e,i){const{blur:s}=t.__;i.setWorldBlur(s*t.__nowWorld.a),i.copyWorldToInner(e,t.__nowWorld,t.__layout.renderBounds),i.filter="none"},backgroundBlur:function(t,e,i){}},{excludeRenderBounds:kc}=xr;function Lc(t,e,i,s,n,r){switch(e){case"alpha":!function(t,e,i,s){const n=t.__nowWorld;i.resetTransform(),i.opacity=1,i.useMask(s,n),s.recycle(n),Oc(t,e,i,1)}(t,i,s,n);break;case"opacity-path":Oc(t,i,s,r);break;case"path":i.restore()}}function Sc(t){return t.getSameCanvas(!1,!0)}function Oc(t,e,i,s){const n=t.__nowWorld;e.resetTransform(),e.opacity=s,e.copyWorld(i,n),i.recycle(n)}t.Group.prototype.__renderMask=function(t,e){let i,s,n,r,o;const{children:a}=this;for(let h=0,l=a.length;h<l;h++)i=a[h],i.__.mask&&(o&&(Lc(this,o,t,n,s,r),s=n=null),"path"===i.__.mask?(i.opacity<1?(o="opacity-path",r=i.opacity,n||(n=Sc(t))):(o="path",t.save()),i.__clip(n||t,e)):(o="alpha",s||(s=Sc(t)),n||(n=Sc(t)),i.__render(s,e)),"clipping"!==i.__.mask)||kc(i,e)||i.__render(n||t,e);Lc(this,o,t,n,s,r)};const Dc=">)]}%!?,.:;'\"》）」〉』〗】〕｝┐＞’”！？，、。：；‰",Mc=Dc+"_#~&*+\\=|≮≯≈≠＝…",Ic=new RegExp([[19968,40959],[13312,19903],[131072,173791],[173824,177983],[177984,178207],[178208,183983],[183984,191471],[196608,201551],[201552,205743],[11904,12031],[12032,12255],[12272,12287],[12288,12351],[12736,12783],[12800,13055],[13056,13311],[63744,64255],[65072,65103],[127488,127743],[194560,195103]].map((([t,e])=>`[\\u${t.toString(16)}-\\u${e.toString(16)}]`)).join("|"));function Ac(t){const e={};return t.split("").forEach((t=>e[t]=!0)),e}const Wc=Ac("ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz"),Fc=Ac("{[(<'\"《（「〈『〖【〔｛┌＜‘“＝¥￥＄€£￡¢￠"),zc=Ac(Dc),Nc=Ac(Mc),Uc=Ac("- —／～｜┆·");var Yc;!function(t){t[t.Letter=0]="Letter",t[t.Single=1]="Single",t[t.Before=2]="Before",t[t.After=3]="After",t[t.Symbol=4]="Symbol",t[t.Break=5]="Break"}(Yc||(Yc={}));const{Letter:Xc,Single:Hc,Before:jc,After:Vc,Symbol:Gc,Break:Kc}=Yc;function qc(t){return Wc[t]?Xc:Uc[t]?Kc:Fc[t]?jc:zc[t]?Vc:Nc[t]?Gc:Ic.test(t)?Hc:Xc}const Zc={trimRight(t){const{words:e}=t;let i,s=0,n=e.length;for(let r=n-1;r>-1&&(i=e[r].data[0]," "===i.char);r--)s++,t.width-=i.width;s&&e.splice(n-s,s)}};function Qc(t,e,i){switch(e){case"title":return i?t.toUpperCase():t;case"upper":return t.toUpperCase();case"lower":return t.toLowerCase();default:return t}}const{trimRight:Jc}=Zc,{Letter:$c,Single:tu,Before:eu,After:iu,Symbol:su,Break:nu}=Yc;let ru,ou,au,hu,lu,du,cu,uu,_u,pu,gu,fu,yu,vu,mu,wu,xu,bu=[];function Eu(t,e){_u&&!uu&&(uu=_u),ru.data.push({char:t,width:e}),au+=e}function Bu(){hu+=au,ru.width=au,ou.words.push(ru),ru={data:[]},au=0}function Pu(){vu&&(mu.paraNumber++,ou.paraStart=!0,vu=!1),_u&&(ou.startCharSize=uu,ou.endCharSize=_u,uu=0),ou.width=hu,wu.width?Jc(ou):xu&&Ru(),bu.push(ou),ou={words:[]},hu=0}function Ru(){hu>(mu.maxWidth||0)&&(mu.maxWidth=hu)}const Cu=0,Tu=1,ku=2;const{top:Lu,right:Su,bottom:Ou,left:Du}=t.Direction4;function Mu(t,e,i){const{bounds:s,rows:n}=t;s[e]+=i;for(let t=0;t<n.length;t++)n[t][e]+=i}const Iu={getDrawData:function(t,i){"string"!=typeof t&&(t=String(t));let s=0,n=0,r=i.__getInput("width")||0,o=i.__getInput("height")||0;const{textDecoration:a,__font:h,__padding:l}=i;l&&(r?(s=l[Du],r-=l[Su]+l[Du]):i.autoSizeAlign||(s=l[Du]),o?(n=l[Lu],o-=l[Lu]+l[Ou]):i.autoSizeAlign||(n=l[Lu]));const d={bounds:{x:s,y:n,width:r,height:o},rows:[],paraNumber:0,font:e.canvas.font=h};return function(t,i,s){mu=t,bu=t.rows,wu=t.bounds,xu=!wu.width&&!s.autoSizeAlign;const{__letterSpacing:n,paraIndent:r,textCase:o}=s,{canvas:a}=e,{width:h,height:l}=wu;if(h||l||n||"none"!==o){const t="none"!==s.textWrap,e="break"===s.textWrap;vu=!0,gu=null,uu=cu=_u=au=hu=0,ru={data:[]},ou={words:[]};for(let s=0,l=i.length;s<l;s++)du=i[s],"\n"===du?(au&&Bu(),ou.paraEnd=!0,Pu(),vu=!0):(pu=qc(du),pu===$c&&"none"!==o&&(du=Qc(du,o,!au)),cu=a.measureText(du).width,n&&(n<0&&(_u=cu),cu+=n),fu=pu===tu&&(gu===tu||gu===$c)||gu===tu&&pu!==iu,yu=!(pu!==eu&&pu!==tu||gu!==su&&gu!==iu),lu=vu&&r?h-r:h,t&&h&&hu+au+cu>lu&&(e?(au&&Bu(),hu&&Pu()):(yu||(yu=pu===$c&&gu==iu),fu||yu||pu===nu||pu===eu||pu===tu||au+cu>lu?(au&&Bu(),hu&&Pu()):hu&&Pu()))," "===du&&!0!==vu&&hu+au===0||(pu===nu?(" "===du&&au&&Bu(),Eu(du,cu),Bu()):fu||yu?(au&&Bu(),Eu(du,cu)):Eu(du,cu)),gu=pu);au&&Bu(),hu&&Pu(),bu.length>0&&(bu[bu.length-1].paraEnd=!0)}else i.split("\n").forEach((t=>{mu.paraNumber++,hu=a.measureText(t).width,bu.push({x:r||0,text:t,width:hu,paraStart:!0}),xu&&Ru()}))}(d,t,i),l&&function(t,e,i,s,n){if(!s&&i.autoSizeAlign)switch(i.textAlign){case"left":Mu(e,"x",t[Du]);break;case"right":Mu(e,"x",-t[Su])}if(!n&&i.autoSizeAlign)switch(i.verticalAlign){case"top":Mu(e,"y",t[Lu]);break;case"bottom":Mu(e,"y",-t[Ou])}}(l,d,i,r,o),function(t,e){const{rows:i,bounds:s}=t,{__lineHeight:n,__baseLine:r,__letterSpacing:o,__clipText:a,textAlign:h,verticalAlign:l,paraSpacing:d,autoSizeAlign:c}=e;let{x:u,y:_,width:p,height:g}=s,f=n*i.length+(d?d*(t.paraNumber-1):0),y=r;if(a&&f>g)f=Math.max(g,n),t.overflow=i.length;else if(g||c)switch(l){case"middle":_+=(g-f)/2;break;case"bottom":_+=g-f}y+=_;let v,m,w,x=p||c?p:t.maxWidth;for(let r=0,l=i.length;r<l;r++){if(v=i[r],v.x=u,v.width<p||v.width>p&&!a)switch(h){case"center":v.x+=(x-v.width)/2;break;case"right":v.x+=x-v.width}v.paraStart&&d&&r>0&&(y+=d),v.y=y,y+=n,t.overflow>r&&y>f&&(v.isOverflow=!0,t.overflow=r+1),m=v.x,w=v.width,o<0&&(v.width<0?(w=-v.width+e.fontSize+o,m-=w,w+=e.fontSize):w-=o),m<s.x&&(s.x=m),w>s.width&&(s.width=w),a&&p&&p<w&&(v.isOverflow=!0,t.overflow||(t.overflow=i.length))}s.y=_,s.height=f}(d,i),function(t,e,i,s){const{rows:n}=t,{textAlign:r,paraIndent:o,letterSpacing:a}=e;let h,l,d,c,u;n.forEach((t=>{t.words&&(d=o&&t.paraStart?o:0,l=i&&"justify"===r&&t.words.length>1?(i-t.width-d)/(t.words.length-1):0,c=a||t.isOverflow?Cu:l>.01?Tu:ku,t.isOverflow&&!a&&(t.textMode=!0),c===ku?(t.x+=d,function(t){t.text="",t.words.forEach((e=>{e.data.forEach((e=>{t.text+=e.char}))}))}(t)):(t.x+=d,h=t.x,t.data=[],t.words.forEach((e=>{c===Tu?(u={char:"",x:h},h=function(t,e,i){return t.forEach((t=>{i.char+=t.char,e+=t.width})),e}(e.data,h,u),(t.isOverflow||" "!==u.char)&&t.data.push(u)):h=function(t,e,i,s){return t.forEach((t=>{(s||" "!==t.char)&&(t.x=e,i.push(t)),e+=t.width})),e}(e.data,h,t.data,t.isOverflow),!t.paraEnd&&l&&(h+=l,t.width+=l)}))),t.words=null)}))}(d,i,r),d.overflow&&function(t,i,s,n){if(!n)return;const{rows:r,overflow:o}=t;let{textOverflow:a}=i;if(r.splice(o),a&&"show"!==a){let t,h;"hide"===a?a="":"ellipsis"===a&&(a="...");const l=a?e.canvas.measureText(a).width:0,d=s+n-l;("none"===i.textWrap?r:[r[o-1]]).forEach((e=>{if(e.isOverflow&&e.data){let i=e.data.length-1;for(let s=i;s>-1&&(t=e.data[s],h=t.x+t.width,!(s===i&&h<d));s--){if(h<d&&" "!==t.char){e.data.splice(s+1),e.width-=t.width;break}e.width-=t.width}e.width+=l,e.data.push({char:a,x:h}),e.textMode&&function(t){t.text="",t.data.forEach((e=>{t.text+=e.char})),t.data=null}(e)}}))}}(d,i,s,r),"none"!==a&&function(t,e){const{fontSize:i}=e;switch(t.decorationHeight=i/11,e.textDecoration){case"under":t.decorationY=.15*i;break;case"delete":t.decorationY=.35*-i}}(d,i),d}};const Au={string:function(t,e){const i="number"==typeof e&&1!==e;if("string"==typeof t){if(!i||!Na.object)return t;t=Na.object(t)}let s=void 0===t.a?1:t.a;i&&(s*=e);const n=t.r+","+t.g+","+t.b;return 1===s?"rgb("+n+")":"rgba("+n+","+s+")"}},{setPoint:Wu,addPoint:Fu,toBounds:zu}=Y;const Nu={export(t,s,n){this.running=!0;const r=hn.fileType(s),o=s.includes(".");return n=hn.getExportOptions(n),function(t){Uu||(Uu=new un);return new Promise((e=>{Uu.add((()=>zt(this,void 0,void 0,(function*(){return yield t(e)}))),{parallel:!1})}))}((a=>new Promise((l=>{const d=t=>{a(t),l(),this.running=!1},{toURL:c}=e,{download:u}=e.origin;if("json"===r)return o&&u(c(JSON.stringify(t.toJSON(n.json)),"text"),s),d({data:!!o||t.toJSON(n.json)});if("svg"===r)return o&&u(c(t.toSVG(),"svg"),s),d({data:!!o||t.toSVG()});const{leafer:_}=t;_?(Yu(t),_.waitViewCompleted((()=>zt(this,void 0,void 0,(function*(){let e,r,o=1,a=1;const{worldTransform:l,isLeafer:c,isFrame:u}=t,{slice:p,trim:g,onCanvas:f}=n,y=void 0===n.smooth?_.config.smooth:n.smooth,v=n.contextSettings||_.config.contextSettings,m=n.screenshot||t.isApp,w=c&&m&&void 0===n.fill?t.fill:n.fill,x=hn.isOpaqueImage(s)||w,b=new N;if(m)e=!0===m?c?_.canvas.bounds:t.worldRenderBounds:m;else{let i=n.relative||(c?"inner":"local");switch(o=l.scaleX,a=l.scaleY,i){case"inner":b.set(l);break;case"local":b.set(l).divide(t.localTransform),o/=t.scaleX,a/=t.scaleY;break;case"world":o=1,a=1;break;case"page":i=t.leafer;default:b.set(l).divide(t.getTransform(i));const e=i.worldTransform;o/=o/e.scaleX,a/=a/e.scaleY}e=t.getBounds("render",i)}const E={scaleX:1,scaleY:1};h.getScaleData(n.scale,n.size,e,E);let B=n.pixelRatio||1;t.isApp&&(E.scaleX*=B,E.scaleY*=B,B=t.app.pixelRatio);const{x:P,y:R,width:C,height:T}=new lt(e).scale(E.scaleX,E.scaleY),k={matrix:b.scale(1/E.scaleX,1/E.scaleY).invert().translate(-P,-R).withScale(1/o*E.scaleX,1/a*E.scaleY)};let L,S=i.canvas({width:Math.round(C),height:Math.round(T),pixelRatio:B,smooth:y,contextSettings:v});if(p&&(L=t,L.__worldOpacity=0,t=_,k.bounds=S.bounds),S.save(),u&&void 0!==w){const e=t.get("fill");t.fill="",t.__render(S,k),t.fill=e}else t.__render(S,k);if(S.restore(),L&&L.__updateWorldOpacity(),g){r=function(t){const{width:e,height:i}=t.view,{data:s}=t.context.getImageData(0,0,e,i);let n,r,o,a=0;for(let t=0;t<s.length;t+=4)0!==s[t+3]&&(n=a%e,r=(a-n)/e,o?Fu(o,n,r):Wu(o={},n,r)),a++;const h=new lt;return zu(o,h),h.scale(1/t.pixelRatio).ceil()}(S);const t=S,{width:e,height:s}=r,n={x:0,y:0,width:e,height:s,pixelRatio:B};S=i.canvas(n),S.copyWorld(t,r,n)}x&&S.fillWorld(S.bounds,w||"#FFFFFF","destination-over"),f&&f(S);const O="canvas"===s?S:yield S.export(s,n);d({data:O,width:S.pixelWidth,height:S.pixelHeight,renderBounds:e,trimBounds:r})}))))):d({data:!1})}))))}};let Uu;function Yu(t){t.__.__needComputePaint&&t.__.__computePaint(),t.isBranch&&t.children.forEach((t=>Yu(t)))}const Xu=Kt.prototype,Hu=wt.get("@leafer-ui/export");return Xu.export=function(t,e){const{quality:i,blob:s}=hn.getExportOptions(e);return t.includes(".")?this.saveAs(t,i):s?this.toBlob(t,i):this.toDataURL(t,i)},Xu.toBlob=function(t,i){return new Promise((s=>{e.origin.canvasToBolb(this.view,t,i).then((t=>{s(t)})).catch((t=>{Hu.error(t),s(null)}))}))},Xu.toDataURL=function(t,i){return e.origin.canvasToDataURL(this.view,t,i)},Xu.saveAs=function(t,i){return new Promise((s=>{e.origin.canvasSaveAs(this.view,t,i).then((()=>{s(!0)})).catch((t=>{Hu.error(t),s(!1)}))}))},Object.assign(za,Iu),Object.assign(Na,Au),Object.assign(Xa,bd),Object.assign(Ha,ic),Object.assign(ja,wc),Object.assign(Va,Tc),Object.assign(Ga,Nu),Object.assign(i,{interaction:(t,e,i,s)=>new dd(t,e,i,s),hitCanvas:(t,e)=>new aa(t,e),hitCanvasManager:()=>new Yl}),da(),t.AlignHelper=vt,t.AroundHelper=gt,t.AutoBounds=ct,t.BezierHelper=Ee,t.Bounds=lt,t.BoundsHelper=rt,t.BoxData=ih,t.BranchHelper=Er,t.BranchRender=Ro,t.CanvasData=gh,t.CanvasManager=Dt,t.ChildEvent=Fr,t.ColorConvert=Na,t.Creator=i,t.Cursor=Ul,t.DataHelper=Mt,t.Debug=wt,t.Effect=Va,t.EllipseData=ah,t.EllipseHelper=Oe,t.Event=Wr,t.EventCreator=St,t.Eventer=Gr,t.Export=Ga,t.FileHelper=hn,t.FrameData=nh,t.GroupData=eh,t.HitCanvasManager=Yl,t.ImageData=ph,t.ImageEvent=Nr,t.ImageManager=_n,t.IncrementId=s,t.Interaction=dd,t.InteractionBase=Nl,t.InteractionHelper=wl,t.Keyboard=al,t.LayoutEvent=Xr,t.Layouter=Ba,t.LeafBounds=Eo,t.LeafBoundsHelper=xr,t.LeafData=At,t.LeafDataProxy=ao,t.LeafEventer=no,t.LeafHelper=_r,t.LeafLayout=Ar,t.LeafLevelList=ra,t.LeafList=na,t.LeafMatrix=go,t.LeafRender=Bo,t.LeaferCanvas=aa,t.LeaferCanvasBase=Kt,t.LeaferData=sh,t.LeaferEvent=jr,t.LeaferImage=yn,t.LeaferTypeCreator=gl,t.LineData=rh,t.MathHelper=h,t.Matrix=N,t.MatrixHelper=b,t.MultiTouchHelper=Ol,t.MyDragEvent=ul,t.MyImage=tl,t.MyPointerEvent=dl,t.NeedConvertToCanvasCommandMap=$t,t.OneRadian=l,t.PI2=d,t.PI_2=c,t.Paint=Xa,t.PaintGradient=ja,t.PaintImage=Ha,t.PathArrow=Ya,t.PathBounds=qs,t.PathCommandDataHelper=zi,t.PathCommandMap=Qt,t.PathConvert=fi,t.PathCorner=nn,t.PathCreator=is,t.PathData=dh,t.PathDrawer=ys,t.PathHelper=qt,t.PathNumberCommandLengthMap=se,t.PathNumberCommandMap=ie,t.PenData=ch,t.Platform=e,t.Point=F,t.PointHelper=D,t.PointerButton=hl,t.PolygonData=hh,t.PropertyEvent=zr,t.RectData=oh,t.RectHelper=ne,t.RectRender=mh,t.RenderEvent=Hr,t.Renderer=Ra,t.ResizeEvent=Ur,t.Run=Bt,t.Selector=Ia,t.StarData=lh,t.State=Ka,t.StringNumberMap=mt,t.TaskItem=cn,t.TaskProcessor=un,t.TextConvert=za,t.TextData=_h,t.Transition=qa,t.TwoPointBoundsHelper=Y,t.UIBounds=fh,t.UICreator=Tt,t.UIData=th,t.UIEvent=ll,t.UIRender=yh,t.UnitConvert=Ua,t.WaitHelper=Cr,t.WatchEvent=Yr,t.Watcher=ua,t.addInteractionWindow=_l,t.affectRenderBoundsType=An,t.affectStrokeBoundsType=Dn,t.attr=xn,t.autoLayoutType=Pn,t.boundsType=Tn,t.canvasPatch=an,t.canvasSizeAttrs=Gt,t.cursorType=jn,t.dataProcessor=Vn,t.dataType=En,t.decorateLeafAttr=wn,t.defineDataProcessor=Gn,t.defineKey=vn,t.defineLeafAttr=bn,t.doBoundsType=Ln,t.doStrokeType=Mn,t.effectType=Aa,t.emptyData={},t.eraserType=Xn,t.getBoundsData=_,t.getDescriptor=mn,t.getMatrixData=p,t.getPointData=u,t.hitType=Hn,t.isNull=function(t){return null==t},t.layoutProcessor=function(t){return(e,i)=>{vn(e,"__LayoutProcessor",{get:()=>t})}},t.maskType=Yn,t.naturalBoundsType=kn,t.needPlugin=Rt,t.opacityType=Fn,t.pathInputType=Sn,t.pathType=On,t.pen=rn,t.positionType=Bn,t.registerUI=er,t.registerUIEvent=ir,t.resizeType=Wa,t.rewrite=Qn,t.rewriteAble=Jn,t.rotationType=Cn,t.scaleType=Rn,t.sortType=Un,t.strokeType=In,t.surfaceType=Wn,t.tempBounds=dt,t.tempMatrix=U,t.tempPoint=z,t.useCanvas=da,t.useModule=tr,t.version="1.0.9",t.visibleType=zn,t.zoomLayerType=Fa,t}({});
