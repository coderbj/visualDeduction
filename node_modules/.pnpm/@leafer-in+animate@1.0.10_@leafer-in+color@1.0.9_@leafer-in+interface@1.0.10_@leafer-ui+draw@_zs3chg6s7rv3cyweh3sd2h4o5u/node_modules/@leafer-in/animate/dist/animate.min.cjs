"use strict";var e=require("@leafer-ui/draw");function t(e,t,i,s){var r,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(n<3?r(o):n>3?r(t,i,o):r(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o}"function"==typeof SuppressedError&&SuppressedError;const{cos:i,sin:s,pow:r,sqrt:n,abs:o,ceil:a,floor:l,round:h,PI:u}=Math,d=5*u,c=1.70158,m=2.5949095,F=7.5625,p=2.75;function f(e){return t=>r(t,e)}function g(e){return t=>1-r(1-t,e)}function y(e){return t=>t<.5?.5*r(2*t,e):1-.5*r(2-2*t,e)}function b(e){return e<1/p?F*e*e:e<2/p?F*(e-=1.5/p)*e+.75:e<2.5/p?F*(e-=2.25/p)*e+.9375:F*(e-=2.625/p)*e+.984375}function A(e,t,i,s){const r={};return n=>{const a=~~(1e4*n),l=r[a];if(l)return l;let h,u,d,c=n;for(let t=0;t<8&&(h=1-c,d=E(c,e,i)-n,u=3*h*h*e+6*h*c*(i-e)+3*c*c*(1-i),!(o(u)<1e-6));t++)c-=d/u;return r[a]=E(c,t,s)}}function E(e,t,i){const s=1-e;return 3*s*s*e*t+3*s*e*e*i+e*e*e}const D={get(e){const{list:t}=D;return"string"==typeof e?t[e||"ease"]:"object"==typeof e?t[e.name].apply(t,e.value instanceof Array?e.value:[e.value]):t.ease},register(e,t){D.list[e]=t},list:{linear:e=>e,ease:A(.25,.1,.25,1),"ease-in":A(.42,0,1,1),"ease-out":A(0,0,.58,1),"ease-in-out":A(.42,0,.58,1),"sine-in":e=>1-i(e*u*.5),"sine-out":e=>s(e*u*.5),"sine-in-out":e=>.5*(1-i(e*u)),"quad-in":f(2),"quad-out":g(2),"quad-in-out":y(2),"cubic-in":f(3),"cubic-out":g(3),"cubic-in-out":y(3),"quart-in":f(4),"quart-out":g(4),"quart-in-out":y(4),"quint-in":f(5),"quint-out":g(5),"quint-in-out":y(5),"expo-in":e=>e?r(2,10*e-10):0,"expo-out":e=>1===e?1:1-r(2,10*-e),"expo-in-out":e=>0===e||1===e?e:e<.5?.5*r(2,2*e*10-10):.5*(2-r(2,10-2*e*10)),"circ-in":e=>1-n(1-r(e,2)),"circ-out":e=>n(1-r(e-1,2)),"circ-in-out":e=>e<.5?.5*(1-n(1-r(2*e,2))):.5*(n(1-r(2-2*e,2))+1),"back-in":e=>((c+1)*e-c)*e*e,"back-out":e=>(e-=1)*e*((c+1)*e+c)+1,"back-in-out":e=>e<.5?(e*=2)*e*((m+1)*e-m)*.5:.5*((e=2*e-2)*e*((m+1)*e+m)+2),"elastic-in":e=>0===e||1===e?e:-r(2,10*(e-1))*s((e-1.1)*d),"elastic-out":e=>0===e||1===e?e:r(2,-10*e)*s((e-.1)*d)+1,"elastic-in-out":e=>0===e||1===e?e:e<.5?-r(2,10*((e*=2)-1))*s((e-1.1)*d)*.5:r(2,10*(1-(e*=2)))*s((e-1.1)*d)*.5+1,"bounce-in":e=>1-b(1-e),"bounce-out":b,"bounce-in-out":e=>e<.5?.5*(1-b(1-2*e)):.5*(1+b(2*e-1)),"cubic-bezier":A,steps:function(e,t="floor"){return i=>("floor"===t?l(i*e):"ceil"===t?a(i*e):h(i*e))/e}}};function v(e){return(t,i)=>{Object.defineProperty(t,i,{get(){const t=this.config&&this.config[i];return void 0===t?e:t},set(e){this.config||(this.config={}),this.config[i]=e}})}}class T{}T.CREATED="created",T.PLAY="play",T.PAUSE="pause",T.STOP="stop",T.SEEK="seek",T.UPDATE="update",T.COMPLETED="completed";exports.Animate=class extends e.Eventer{get endingStyle(){return"from"===this.realEnding?this.fromStyle:this.toStyle}get started(){return!!this.requestAnimateTime}get completed(){return this.time>=this.duration&&!this.started}get frame(){return this.frames[this.nowIndex]}get frameTotalTime(){return this.frame.totalTime||this.frame.duration||0}get realEnding(){let e;const{ending:t,reverse:i,loop:s}=this;return"from"===t?e=0:"to"===t?e=1:(e=i?0:1,s&&"number"==typeof s&&(e+=s-1)),e%2?"to":"from"}constructor(e,t,i,s){super(),this.init(e,t,i,s)}init(e,t,i,s){switch(this.target=e,(s||this.isTemp)&&(this.isTemp=s),typeof i){case"number":this.config={duration:i};break;case"string":this.config={easing:i};break;case"object":this.config=i,i.event&&(this.event=i.event)}if(!t)return;this.keyframes=t instanceof Array?t:[t];const{easing:r,attrs:n}=this;this.easingFn=D.get(r),(n||this.attrsMap)&&(this.attrsMap=n?n.reduce(((e,t)=>(e[t]=!0,e)),{}):void 0),this.frames=[],this.create(),this.autoplay&&(this.timer=setTimeout((()=>{this.timer=0,this.play()}),0))}play(){this.destroyed||(this.running=!0,this.started?this.timer||this.requestAnimate():(this.clearTimer(),this.start()),this.emit(T.PLAY,this))}pause(){this.destroyed||(this.running=!1,this.clearTimer(),this.emit(T.PAUSE,this))}stop(){this.destroyed||(this.end(),this.complete(),this.emit(T.STOP,this))}seek(t){this.destroyed||("object"==typeof t&&(t=e.UnitConvert.number(t,this.duration)),t&&(t/=this.speed),(!this.started||t<this.time)&&this.start(!0),this.time=t,this.animate(0,!0),this.clearTimer((()=>this.requestAnimate())),this.emit(T.SEEK,this))}kill(){this.destroy(!0)}create(){const{target:e,frames:t,keyframes:i,config:s}=this,{length:r}=i,n=!(r>1)||this.join;let o,a,l,h,u=0,d=0;r>1&&(this.fromStyle={},this.toStyle={});for(let s=0;s<r;s++){if(a=i[s],h=a.style||a,o||(o=n?e:h),l={style:h,beforeStyle:{}},a.style){const{duration:e,autoDuration:t,delay:i,autoDelay:s,easing:r}=a;e?(l.duration=e,u+=e,i&&(l.totalTime=e+i)):t&&(l.autoDuration=t,d+=t),i?(l.delay=i,u+=i):s&&(l.autoDelay=s,d+=s),r&&(l.easingFn=D.get(r))}if(l.autoDuration||void 0!==l.duration||(r>1?s>0||n?d++:l.duration=0:l.duration=this.duration),r>1)this.setBefore(l,h,o);else{for(let t in h)l.beforeStyle[t]=e[t];this.fromStyle=l.beforeStyle,this.toStyle=l.style}o=h,t.push(l)}d?((this.duration<=u||!s||!s.duration)&&this.changeDuration(u+.2*d),this.allocateTime((this.duration-u)/d)):u&&this.changeDuration(u),this.emit(T.CREATED,this)}changeDuration(e){const{config:t}=this;this.config=t?Object.assign(Object.assign({},t),{duration:e}):{duration:e}}setBefore(e,t,i){const{fromStyle:s,toStyle:r,target:n}=this;for(let o in t)void 0===s[o]&&(s[o]=r[o]=t===i?i[o]:n[o]),e.beforeStyle[o]=void 0===i[o]?r[o]:i[o],r[o]=t[o]}allocateTime(e){let t,{frames:i}=this,{length:s}=i;for(let r=0;r<s;r++)t=i[r],void 0===t.duration&&(t.duration=t.autoDuration?e*t.autoDuration:e),t.totalTime||(t.autoDelay&&(t.delay=t.autoDelay*e),t.delay&&(t.totalTime=t.duration,t.totalTime+=t.delay))}requestAnimate(){this.requestAnimateTime=Date.now(),e.Platform.requestRender(this.animate.bind(this))}animate(e,t){if(!t){if(!this.running)return;this.time+=(Date.now()-this.requestAnimateTime)/1e3}const{duration:i}=this,s=this.time*this.speed;if(s<i){for(;s-this.playedTotalTime>this.frameTotalTime;)this.transition(1),this.nowReverse?this.reverseNextFrame():this.nextFrame();const e=this.nowReverse?0:this.frame.delay||0,t=s-this.playedTotalTime-e,i=this.frame.duration;if(t>i)this.transition(1);else if(t>=0){const e=i?t/i:1;this.transition(this.frame.easingFn?this.frame.easingFn(e):this.easingFn(e))}}else this.end();if(!t)if(s<i)this.requestAnimate();else{const{loop:e,loopDelay:t,swing:i}=this;if((!1!==e||i)&&(this.looped?this.looped++:this.looped=1,"number"!=typeof e||e&&!(this.looped>=e)))return i&&(this.nowReverse=!this.nowReverse),void(t?this.timer=setTimeout((()=>{this.timer=0,this.begin()}),t/this.speed*1e3):this.begin());this.complete()}}start(e){this.requestAnimateTime=1;const{reverse:t}=this;if((t||this.nowReverse)&&(this.nowReverse=t),this.looped&&(this.looped=0),e)this.begin(!0);else{const{delay:e}=this;e?this.timer=setTimeout((()=>{this.timer=0,this.begin()}),e/this.speed*1e3):this.begin()}}begin(e){this.playedTotalTime=this.time=0,this.nowReverse?this.setTo():this.setFrom(),e||this.requestAnimate()}end(){this.nowReverse?this.setFrom():this.setTo()}complete(){this.requestAnimateTime=0,this.running=!1;const{realEnding:e}=this;"from"===e?this.setFrom():"to"===e&&this.setTo(),this.clearTimer(),this.emit(T.COMPLETED,this)}setFrom(){this.nowIndex=0,this.setStyle(this.fromStyle)}setTo(){this.nowIndex=this.frames.length-1,this.setStyle(this.toStyle)}nextFrame(){this.nowIndex+1>=this.frames.length||(this.playedTotalTime+=this.frameTotalTime,this.nowIndex++)}reverseNextFrame(){this.nowIndex-1<0||(this.playedTotalTime+=this.frameTotalTime,this.nowIndex--)}transition(t){const{style:i,beforeStyle:s}=this.frame,r=this.nowReverse?i:s,n=this.nowReverse?s:i;if(0===t)this.setStyle(r);else if(1===t)this.setStyle(n);else{const{attrsMap:s,target:o}=this;let a,l,h,{betweenStyle:u}=this.frame;u||(u=this.frame.betweenStyle={});for(let d in i)s&&!s[d]||(a=r[d],l=n[d],h=e.Transition.list[d]||e.Transition.value,a!==l&&(u[d]=h(a,l,t,o)));this.setStyle(u)}this.emit(T.UPDATE,this)}setStyle(e){this.target.set(e,this.isTemp)}clearTimer(e){this.timer&&(clearTimeout(this.timer),this.timer=0,e&&e())}destroy(e){this.destroyed||(super.destroy(),e&&!this.completed?this.stop():this.pause(),this.target=this.config=this.frames=null,this.destroyed=!0)}},t([v("ease")],exports.Animate.prototype,"easing",void 0),t([v(0)],exports.Animate.prototype,"delay",void 0),t([v(.2)],exports.Animate.prototype,"duration",void 0),t([v("auto")],exports.Animate.prototype,"ending",void 0),t([v(!1)],exports.Animate.prototype,"reverse",void 0),t([v(!1)],exports.Animate.prototype,"swing",void 0),t([v(!1)],exports.Animate.prototype,"loop",void 0),t([v(0)],exports.Animate.prototype,"loopDelay",void 0),t([v(1)],exports.Animate.prototype,"speed",void 0),t([v(!0)],exports.Animate.prototype,"autoplay",void 0),t([v()],exports.Animate.prototype,"join",void 0),t([v()],exports.Animate.prototype,"attrs",void 0),exports.Animate=t([e.useModule(e.LeafEventer)],exports.Animate);const k={transparent:"FFF0",aliceblue:"F0F8FF",antiquewhite:"FAEBD7",aqua:"0FF",aquamarine:"7FFFD4",azure:"F0FFFF",beige:"F5F5DC",bisque:"FFE4C4",black:"0",blanchedalmond:"FFEBCD",blue:"00F",blueviolet:"8A2BE2",brown:"A52A2A",burlywood:"DEB887",cadetblue:"5F9EA0",chartreuse:"7FFF00",chocolate:"D2691E",coral:"FF7F50",cornflowerblue:"6495ED",cornsilk:"FFF8DC",crimson:"DC143C",cyan:"0FF",darkblue:"00008B",darkcyan:"008B8B",darkgoldenrod:"B8860B",darkgray:"A9",darkgreen:"006400",darkgrey:"A9",darkkhaki:"BDB76B",darkmagenta:"8B008B",darkolivegreen:"556B2F",darkorange:"FF8C00",darkorchid:"9932CC",darkred:"8B0000",darksalmon:"E9967A",darkseagreen:"8FBC8F",darkslateblue:"483D8B",darkslategray:"2F4F4F",darkslategrey:"2F4F4F",darkturquoise:"00CED1",darkviolet:"9400D3",deeppink:"FF1493",deepskyblue:"00BFFF",dimgray:"69",dimgrey:"69",dodgerblue:"1E90FF",firebrick:"B22222",floralwhite:"FFFAF0",forestgreen:"228B22",fuchsia:"F0F",gainsboro:"DC",ghostwhite:"F8F8FF",gold:"FFD700",goldenrod:"DAA520",gray:"80",green:"008000",greenyellow:"ADFF2F",grey:"80",honeydew:"F0FFF0",hotpink:"FF69B4",indianred:"CD5C5C",indigo:"4B0082",ivory:"FFFFF0",khaki:"F0E68C",lavender:"E6E6FA",lavenderblush:"FFF0F5",lawngreen:"7CFC00",lemonchiffon:"FFFACD",lightblue:"ADD8E6",lightcoral:"F08080",lightcyan:"E0FFFF",lightgoldenrodyellow:"FAFAD2",lightgray:"D3",lightgreen:"90EE90",lightgrey:"D3",lightpink:"FFB6C1",lightsalmon:"FFA07A",lightseagreen:"20B2AA",lightskyblue:"87CEFA",lightslategray:"789",lightslategrey:"789",lightsteelblue:"B0C4DE",lightyellow:"FFFFE0",lime:"00FF00",limegreen:"32CD32",linen:"FAF0E6",magenta:"FF00FF",maroon:"800000",mediumaquamarine:"66CDAA",mediumblue:"0000CD",mediumorchid:"BA55D3",mediumpurple:"9370DB",mediumseagreen:"3CB371",mediumslateblue:"7B68EE",mediumspringgreen:"00FA9A",mediumturquoise:"48D1CC",mediumvioletred:"C71585",midnightblue:"191970",mintcream:"F5FFFA",mistyrose:"FFE4E1",moccasin:"FFE4B5",navajowhite:"FFDEAD",navy:"000080",oldlace:"FDF5E6",olive:"808000",olivedrab:"6B8E23",orange:"FFA500",orangered:"FF4500",orchid:"DA70D6",palegoldenrod:"EEE8AA",palegreen:"98FB98",paleturquoise:"AFEEEE",palevioletred:"D87093",papayawhip:"FFEFD5",peachpuff:"FFDAB9",peru:"CD853F",pink:"FFC0CB",plum:"DDA0DD",powderblue:"B0E0E6",purple:"800080",rebeccapurple:"639",red:"F00",rosybrown:"BC8F8F",royalblue:"4169E1",saddlebrown:"8B4513",salmon:"FA8072",sandybrown:"F4A460",seagreen:"2E8B57",seashell:"FFF5EE",sienna:"A0522D",silver:"C0",skyblue:"87CEEB",slateblue:"6A5ACD",slategray:"708090",slategrey:"708090",snow:"FFFAFA",springgreen:"00FF7F",steelblue:"4682B4",tan:"D2B48C",teal:"008080",thistle:"D8BFD8",tomato:"FF6347",turquoise:"40E0D0",violet:"EE82EE",wheat:"F5DEB3",white:"F",whitesmoke:"F5",yellow:"FF0",yellowgreen:"9ACD32"},w=/^rgb\((\d+),\s*(\d+),\s*(\d+)/i,C=/^rgba\((\d+),\s*(\d+),\s*(\d+),\s*(\d*\.?\d+)/i,B=/^hsl\((\d+),\s*(\d+)%\s*,\s*(\d+)%/i,x=/^hsla\((\d+),\s*(\d+)%\s*,\s*(\d+)%\s*,\s*(\d*\.?\d+)/i,S=parseInt,q=parseFloat,{round:j}=Math;let O={},R=0;function P(e){let t,i,s,r=1;switch(e.length){case 9:t=S(e.slice(1,3),16),i=S(e.slice(3,5),16),s=S(e.slice(5,7),16),r=S(e.slice(7,9),16)/255;break;case 7:t=S(e.slice(1,3),16),i=S(e.slice(3,5),16),s=S(e.slice(5,7),16);break;case 5:t=S(e[1]+e[1],16),i=S(e[2]+e[2],16),s=S(e[3]+e[3],16),r=S(e[4]+e[4],16)/255;break;case 4:t=S(e[1]+e[1],16),i=S(e[2]+e[2],16),s=S(e[3]+e[3],16);break;case 3:t=i=s=S(e[1]+e[2],16);break;case 2:t=i=s=S(e[1]+e[1],16)}return{r:t,g:i,b:s,a:r}}const _=1/6,M=.5,I=2/3,L=1/3;function U(e,t,i){return i<0?i++:i>1&&i--,i<_?e+6*(t-e)*i:i<M?t:i<I?e+(t-e)*(I-i)*6:e}function N(e,t,i,s=1){let r,n,o;if(e/=360,i/=100,0===(t/=100))r=n=o=i;else{let s=i<.5?i*(1+t):i+t-i*t,a=2*i-s;r=U(a,s,e+L),n=U(a,s,e),o=U(a,s,e-L)}return{r:j(255*r),g:j(255*n),b:j(255*o),a:s}}e.ColorConvert.object=function(e,t){let i,s=void 0!==t&&1!==t;if("string"==typeof e){const t=O[e];if(t)i=Object.assign({},t);else{switch(e[0]){case"#":i=P(e);break;case"R":case"r":"("===e[4]&&C.test(e)?i=function(e){const t=C.exec(e);return{r:S(t[1]),g:S(t[2]),b:S(t[3]),a:q(t[4])}}(e):"("===e[3]&&w.test(e)&&(i=function(e){const t=w.exec(e);return{r:S(t[1]),g:S(t[2]),b:S(t[3]),a:1}}(e));break;case"H":case"h":"("===e[4]&&x.test(e)?i=function(e){const t=x.exec(e);return N(q(t[1]),q(t[2]),q(t[3]),q(t[4]))}(e):"("===e[3]&&B.test(e)&&(i=function(e){const t=B.exec(e);return N(q(t[1]),q(t[2]),q(t[3]),1)}(e))}if(!i){const t=k[e.toLowerCase()];t&&(i=P("#"+t))}i&&(R++,R>1e4&&(O={},R=0),O[e]=Object.assign({},i))}}else"object"==typeof e&&(void 0===e.a&&(e.a=1),s&&(e=Object.assign({},e)),i=e);return i||(i={r:255,g:255,b:255,a:1}),s&&(i.a*=t),i};const{round:z}=Math,{fourNumber:H}=e.MathHelper,K={fill:Q,stroke:Q,cornerRadius:(e,t,i)=>"number"==typeof e&&"number"==typeof t?G(e,t,i):(e=H(e),t=H(t),e.map(((e,s)=>G(e,t[s],i)))),shadow:V,innerShadow:V},Y={value:function(e,t,i){return"number"==typeof e&&"number"==typeof t?e+(t-e)*i:t},number:G,color:J};function G(e,t,i,s){e||(e=0),t||(t=0);const r=e+(t-e)*i;return s?z(r):r}function J(t,i,s){t=e.ColorConvert.object(t),i=e.ColorConvert.object(i);const r=G(t.r,i.r,s,1)+","+G(t.g,i.g,s,1)+","+G(t.b,i.b,s,1),n=G(t.a,i.a,s);return 1===n?"rgb("+r+")":"rgba("+r+","+n+")"}function Q(e,t,i){return"string"==typeof e&&"string"==typeof t?J(e,t,i):t}function V(e,t,i){return e instanceof Array||t instanceof Array?t:(t=t||{},{x:G((e=e||{}).x,t.x,i),y:G(e.y,t.y,i),blur:G(e.blur,t.blur,i),spread:G(e.spread,t.spread,i),color:J(e.color||"#FFFFFF00",t.color||"#FFFFFF00",i),visible:t.visible,blendMode:t.blendMode,box:t.box||e.box})}e.State.canAnimate=!0,Object.assign(e.Transition,Y),Object.assign(e.Transition.list,K);const W=e.UI.prototype;var X;e.decorateLeafAttr(X,(t=>e.attr({set(e){this.__setAttr(t,e),this.leafer&&(e?this.animate(e,void 0,"animation"):this.killAnimate("animation"))}})))(W,"animation"),e.dataType()(W,"animationOut"),e.dataType(!0)(W,"transition"),e.dataType()(W,"transitionOut"),W.animate=function(e,t,i,s){return void 0===e?this.__animate:("object"==typeof e&&(e.keyframes?(t=e,e=e.keyframes):e.style&&(t=e,e=e.style)),this.killAnimate(i),this.__animate=new exports.Animate(this,e,t,s))},W.killAnimate=function(e){const t=this.__animate;t&&(t.kill(),this.__animate=null)},W.__runAnimation=function(e,t){this.animate("in"===e?this.animation:this.animationOut),t&&this.__animate.on(T.COMPLETED,t)},exports.AnimateEasing=D,exports.AnimateEvent=T;
