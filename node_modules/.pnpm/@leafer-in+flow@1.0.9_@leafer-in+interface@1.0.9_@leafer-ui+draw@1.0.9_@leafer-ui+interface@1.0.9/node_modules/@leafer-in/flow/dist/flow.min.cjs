"use strict";var t=require("@leafer-ui/draw");const{M:e,L:o,C:i,Q:n,Z:s,N:h,D:a,X:r,G:c,F:l,O:_,P:u,U:p}=t.PathCommandMap,d={scale(t,d,g){if(!t)return;let w,y=0,x=t.length;for(;y<x;)switch(w=t[y],w){case e:case o:f(t,d,g,y,1),y+=3;break;case i:f(t,d,g,y,3),y+=7;break;case n:f(t,d,g,y,2),y+=5;break;case s:y+=1;break;case h:f(t,d,g,y,2),y+=5;break;case a:f(t,d,g,y,2),y+=9;break;case r:f(t,d,g,y,2),y+=6;break;case c:f(t,d,g,y,2),y+=9;break;case l:f(t,d,g,y,2),y+=5;break;case _:t[y]=c,t.splice(y+4,0,t[y+3],0),f(t,d,g,y,2),y+=9,x+=2;break;case u:t[y]=l,t.splice(y+4,0,t[y+3]),f(t,d,g,y,2),y+=5,x+=1;break;case p:f(t,d,g,y,2),y+=6}},scalePoints(t,e,o,i,n){for(let s=n?i+1:0,h=n?s+2*n:t.length;s<h;s+=2)t[s]*=e,t[s+1]*=o}},{scalePoints:f}=d,g=t.MatrixHelper.get(),{topLeft:w,top:y,topRight:x,right:b,bottom:G,left:B}=t.Direction9;function R(t,e,o){t.pathInputed?z(t,e,o):(1!==e&&(t.width*=e),1!==o&&(t.height*=o))}function m(t,e,o){const{app:i}=t,n=i&&i.editor;let s=e;if(n.editing){const i=t.__layout;let{width:h,height:a}=i.boxBounds;switch(h*=o-e,a*=e-o,n.resizeDirection){case y:case G:s=o,i.affectScaleOrRotation?t.moveInner(-h/2,0):t.x-=h/2;break;case B:case b:i.affectScaleOrRotation?t.moveInner(0,-a/2):t.y-=a/2;break;case w:case x:i.affectScaleOrRotation?t.moveInner(0,-a):t.y-=a}}t.fontSize*=s;const h=t.__;h.__autoWidth||(t.width*=s),h.__autoHeight||(t.height*=s)}function z(t,e,o){d.scale(t.__.path,e,o),t.path=t.__.path}function A(t,e,o){const{points:i}=t;"object"==typeof i[0]?i.forEach((t=>{t.x*=e,t.y*=o})):d.scalePoints(i,e,o),t.points=i}function k(t,e,o){const{children:i}=t;for(let t=0;t<i.length;t++)g.a=e,g.d=o,i[t].transform(g,!0)}const F=t.Leaf.prototype;function v(t,e,o,i){var n,s=arguments.length,h=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)h=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(h=(s<3?n(h):s>3?n(e,o,h):n(e,o))||h);return s>3&&h&&Object.defineProperty(e,o,h),h}F.scaleResize=function(t,e=t,o){const i=this;o||i.editConfig&&"scale"===i.editConfig.editSize?(i.scaleX*=t,i.scaleY*=e):(t<0&&(i.scaleX*=-1,t=-t),e<0&&(i.scaleY*=-1,e=-e),this.__scaleResize(t,e))},F.__scaleResize=function(t,e){R(this,t,e)},F.resizeWidth=function(t){const e=t/this.getBounds("box","local").width;this.scaleOf(this.__layout.boxBounds,e,this.__.lockRatio?e:1,!0)},F.resizeHeight=function(t){const e=t/this.getBounds("box","local").height;this.scaleOf(this.__layout.boxBounds,this.__.lockRatio?e:1,e,!0)},t.Text.prototype.__scaleResize=function(t,e){this.__.resizeFontSize||this.editConfig&&"font-size"===this.editConfig.editSize?m(this,t,e):R(this,t,e)},t.Path.prototype.__scaleResize=function(t,e){z(this,t,e)},t.Line.prototype.__scaleResize=function(t,e){this.pathInputed?z(this,t,e):this.points?A(this,t,e):this.width*=t},t.Polygon.prototype.__scaleResize=function(t,e){this.pathInputed?z(this,t,e):this.points?A(this,t,e):R(this,t,e)},t.Group.prototype.__scaleResize=function(t,e){k(this,t,e)},t.Box.prototype.__scaleResize=function(t,e){this.__.__autoSize&&this.children.length?k(this,t,e):(R(this,t,e),this.__.resizeChildren&&k(this,t,e))},"function"==typeof SuppressedError&&SuppressedError;class S extends t.BoxData{}exports.Flow=class extends t.Box{get __tag(){return"Flow"}constructor(t){super(t),this.__hasAutoLayout=!0}},v([t.dataProcessor(S)],exports.Flow.prototype,"__",void 0),v([t.autoLayoutType("x")],exports.Flow.prototype,"flow",void 0),exports.Flow=v([t.registerUI()],exports.Flow);const P={},H={"top-left":"from",top:"center","top-right":"to",right:"to","bottom-right":"to",bottom:"center","bottom-left":"from",left:"from",center:"center","baseline-left":"from","baseline-center":"center","baseline-right":"to"},X={"top-left":"from",top:"from","top-right":"from",right:"center","bottom-right":"to",bottom:"to","bottom-left":"to",left:"center",center:"center","baseline-left":"to","baseline-center":"to","baseline-right":"to"};function C(e,o,i){const n=e.__,{contentBounds:s}=e.__layout;t.AlignHelper.toPoint(i,o,s,P),o.x=n.__autoWidth?s.x:P.x,o.y=n.__autoHeight?s.y:P.y}const{move:T}=t.PointHelper;function Y(t,e,o,i,n,s){const{children:h}=t;let a,r,{x:c,start:l}=e,_=i;c+=o;for(let t=0,o=e.count;t<o;t++)a=h[s?l-t:l+t],a.__.inFlow&&0!==a.__.visible?(r=a.__flowBounds,"from"!==n&&(_=i+(e.height-r.height)/("center"===n?2:1)),T(a,c-r.x,_-r.y),c+=r.width+e.gap):o++}function W(t,e,o){const i="width"===o?"height":"width";t[o]=Math.max(t[o],e[o]),t[i]+=t.count?e[i]+t.gap:e[i],t.list.push(e),t.count++}const I={};function L(t,e){const{gap:o,flowAlign:i,flowWrap:n,__autoWidth:s,__autoHeight:h}=t.__,a=n&&(e?!s:!h);return"object"==typeof o?(I.xGap=o.x||0,I.yGap=o.y||0):I.xGap=I.yGap=o,I.isAutoXGap="string"==typeof I.xGap&&!s,I.isAutoYGap="string"==typeof I.yGap&&!h,I.complex=a||"top-left"!==i||t.__hasGrow||I.isAutoXGap||I.isAutoYGap,I.wrap=a,I.complex&&(I.isFitXGap="fit"===I.xGap&&!s,I.isFitYGap="fit"===I.yGap&&!h,"object"==typeof i?(I.contentAlign=i.content||"top-left",I.rowXAlign=i.x||"from",I.rowYAlign=i.y||"from"):(I.contentAlign=i,I.rowXAlign=H[i],I.rowYAlign=X[i])),I}function O(t,e){return{x:0,y:0,width:0,height:0,gap:e,start:t,count:0,grow:0}}function M(t,e,o,i){const{count:n}=t;n>1&&(o>t[e]||i)&&(t.gap=(o-t[e])/(n-1),t[e]=o)}function j(t,e){return"box"===e?t.__local:t.__layout.localStrokeBounds}const{within:D}=t.MathHelper;function E(t,e,o,i){let n,s,h,a=0,r=e.hasRangeSize&&[],{grow:c,start:l}=e;const _=e.width<o?(o-e.width)/c:0,{children:u}=t;_&&(e.width=o);for(let t=0,o=e.count;t<o;t++)n=u[i?l-t:l+t],n.__.inFlow&&0!==n.__.visible?(s=n.__widthGrow)&&(h=U(n,n.__flowBounds,_*s),h?(a+=h,c-=s):r&&(n.__.widthRange?r.unshift(n):r.push(n))):o++;a&&function(t,e,o){let i,n,s,h;t.forEach((t=>{i=t.__widthGrow,n=e/o*i,h=U(t,s=t.__flowBounds,s.width+n),e-=n-h,o-=i}))}(r,a,c)}function U(t,e,o){const{widthRange:i,lockRatio:n}=t.__,s=i?D(o,i):o,h=s/e.width;return t.scaleResize(h,n?h:1),e.width=s,o-s}const{within:N}=t.MathHelper;function q(t,e,o,i){let n,s,h,a=0,r=e.hasRangeSize&&[],{grow:c,start:l}=e;const _=e.height<o?(o-e.height)/c:0,{children:u}=t;_&&(e.height=o);for(let t=0,o=e.count;t<o;t++)n=u[i?l-t:l+t],n.__.inFlow&&0!==n.__.visible?(s=n.__heightGrow)&&(h=Q(n,n.__flowBounds,_*s),h?(a+=h,c-=s):r&&(n.__.heightRange?r.unshift(n):r.push(n))):o++;a&&function(t,e,o){let i,n,s,h;t.forEach((t=>{i=t.__heightGrow,n=e/o*i,h=Q(t,s=t.__flowBounds,s.height+n),e-=n-h,o-=i}))}(r,a,c)}function Q(t,e,o){const{heightRange:i,lockRatio:n}=t.__,s=i?N(o,i):o,h=s/e.height;return t.scaleResize(n?h:1,h),e.height=s,o-s}const{move:Z}=t.PointHelper;function J(t,e){const o="width",{children:i,itemBox:n}=t,s=L(t,!0),{complex:h,wrap:a,xGap:r,yGap:c,isAutoXGap:l,isFitXGap:_}=s;if(!i.length)return;const u=a&&{x:0,y:0,width:0,height:0,gap:0,count:0,list:[]},p=l?0:r;let d,f,g,w,y,{x:x,y:b,width:G,height:B}=t.__layout.contentBounds;for(let s=0,r=i.length;s<r;s++)d=i[w=e?r-1-s:s],d.__.inFlow&&0!==d.__.visible&&(f=j(d,n),h?(d.__flowBounds=f,y||(y=O(w,p)),a&&y.count&&y.width+f.width>G&&(y.grow?E(t,y,G,e):l&&M(y,o,G,_),W(u,y,o),y=O(w,p)),g=f.width,d.__widthGrow&&(y.grow+=d.__widthGrow,g=0,d.__.widthRange&&(y.hasRangeSize=!0)),d.__heightGrow&&Q(d,f,B),y.width+=y.count?g+p:g,y.height=Math.max(y.height,f.height),y.count++):(Z(d,x-f.x,b-f.y),x+=f.width+p));if(h){const{isAutoYGap:i,isFitYGap:n,contentAlign:h,rowXAlign:r,rowYAlign:p}=s;y.count&&(y.grow?E(t,y,G,e):l&&M(y,o,G,_),a&&W(u,y,o)),a?(i?M(u,"height",B,n):u.gap=c,function(t,e,o,i){C(t,e,o);const{list:n}=e;if(n.length>1&&(i||(i=H[o]),"from"!==i)){let t;for(let o=0,s=n.length;o<s;o++)t=n[o],t.x=e.width-t.width,"center"===i&&(t.x/=2)}}(t,u,h,r),function(t,e,o,i){const{list:n}=e,s="reverse"===t.__.flowWrap;let h,{x:a,y:r}=e;for(let c=0,l=n.length;c<l;c++)h=n[s?l-1-c:c],Y(t,h,a,r,o,i),r+=h.height+e.gap}(t,u,p,e)):(C(t,y,h),Y(t,y,0,y.y,p,e))}}const{move:K}=t.PointHelper;function V(t,e,o,i,n,s){const{children:h}=t;let a,r,{y:c,start:l}=e,_=o;c+=i;for(let t=0,i=e.count;t<i;t++)a=h[s?l-t:l+t],a.__.inFlow&&0!==a.__.visible?(r=a.__flowBounds,"from"!==n&&(_=o+(e.width-r.width)/("center"===n?2:1)),K(a,_-r.x,c-r.y),c+=r.height+e.gap):i++}const{move:$}=t.PointHelper;function tt(t,e){const o="height",{children:i,itemBox:n}=t,s=L(t,!1),{complex:h,wrap:a,xGap:r,yGap:c,isAutoYGap:l,isFitYGap:_}=s;if(!i.length)return;const u=a&&{x:0,y:0,width:0,height:0,gap:0,count:0,list:[]},p=l?0:c;let d,f,g,w,y,{x:x,y:b,width:G,height:B}=t.__layout.contentBounds;for(let s=0,r=i.length;s<r;s++)d=i[w=e?r-1-s:s],d.__.inFlow&&0!==d.__.visible&&(f=j(d,n),h?(d.__flowBounds=f,y||(y=O(w,p)),a&&y.count&&y.height+f.height>B&&(y.grow&&q(t,y,B,e),l&&M(y,o,B,_),W(u,y,o),y=O(w,p)),g=f.height,d.__heightGrow&&(y.grow+=d.__heightGrow,g=0,d.__.heightRange&&(y.hasRangeSize=!0)),d.__widthGrow&&U(d,f,G),y.height+=y.count?g+p:g,y.width=Math.max(y.width,f.width),y.count++):($(d,x-f.x,b-f.y),b+=f.height+p));if(h){const{isAutoXGap:i,isFitXGap:n,contentAlign:h,rowXAlign:c,rowYAlign:p}=s;y.count&&(y.grow&&q(t,y,B,e),l&&M(y,o,B,_),a&&W(u,y,o)),a?(i?M(u,"width",G,n):u.gap=r,function(t,e,o,i){C(t,e,o);const{list:n}=e;if(n.length>1&&(i||(i=X[o]),"from"!==i)){let t;for(let o=0,s=n.length;o<s;o++)t=n[o],t.y=e.height-t.height,"center"===i&&(t.y/=2)}}(t,u,h,p),function(t,e,o,i){const{list:n}=e,s="reverse"===t.__.flowWrap;let h,{x:a,y:r}=e;for(let c=0,l=n.length;c<l;c++)h=n[s?l-1-c:c],V(t,h,a,r,o,i),a+=h.width+e.gap}(t,u,c,e)):(C(t,y,h),V(t,y,y.x,0,c,e))}}function et(e){return t.decorateLeafAttr(e,(e=>t.attr({set(o){const i="number"==typeof o?o:0;"autoWidth"===e?this.__widthGrow=i:this.__heightGrow=i,!i||this.parent&&this.parent.__hasGrow||this.waitParent((()=>{this.parent.__hasGrow=!0})),this.__setAttr(e,o)&&t.doBoundsType(this)}})))}const ot=t.UI.prototype,it=t.Box.prototype,{__updateBoxBounds:nt}=t.Group.prototype;t.autoLayoutType(!1)(ot,"flow"),t.boundsType(0)(ot,"gap"),t.boundsType("top-left")(ot,"flowAlign"),t.boundsType(!1)(ot,"flowWrap"),t.boundsType("box")(ot,"itemBox"),t.boundsType(!0)(ot,"inFlow"),et()(ot,"autoWidth"),et()(ot,"autoHeight"),t.boundsType()(ot,"lockRatio"),t.boundsType()(ot,"autoBox"),t.boundsType()(ot,"widthRange"),t.boundsType()(ot,"heightRange");const{copyAndSpread:st}=t.BoundsHelper;it.__updateFlowLayout=function(){const{leaferIsCreated:t,flow:e}=this;switch(t&&(this.leafer.created=!1),e){case"x":case!0:J(this);break;case"y":tt(this);break;case"x-reverse":J(this,!0);break;case"y-reverse":tt(this,!0)}t&&(this.leafer.created=!0)},it.__updateContentBounds=function(){const{padding:t}=this.__,e=this.__layout,o=e.contentBounds===e.boxBounds;t?(o&&e.shrinkContent(),st(e.contentBounds,e.boxBounds,t,!0)):o||e.shrinkContentCancel()},it.__updateBoxBounds=function(t){const e=this.__;if(this.children.length){const{flow:o}=e;if(e.__autoSide){o&&!t?this.__updateRectBoxBounds():nt.call(this);const{boxBounds:i}=this.__layout;e.__autoSize||(e.__autoWidth?(o||(i.width+=i.x,i.x=0),i.height=e.height,i.y=0):(o||(i.height+=i.y,i.y=0),i.width=e.width,i.x=0)),o&&t&&e.padding&&st(i,i,e.padding,!1,e.__autoSize?null:e.__autoWidth?"width":"height"),this.__updateNaturalSize()}else this.__updateRectBoxBounds();o&&this.__updateContentBounds()}else this.__updateRectBoxBounds()},exports.PathScaler=d,exports.scaleResize=R,exports.scaleResizeFontSize=m,exports.scaleResizeGroup=k,exports.scaleResizePath=z,exports.scaleResizePoints=A;
